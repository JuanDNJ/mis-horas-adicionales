var e=()=>void 0,t=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)==55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},n=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let a=e[n++];t[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){let a=e[n++],o=e[n++],s=e[n++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let a=e[n++],o=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join(``)},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`,get ENCODED_VALS(){return this.ENCODED_VALS_BASE+`+/=`},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+`-_.`},HAS_NATIVE_SUPPORT:typeof atob==`function`,encodeByteArray(e,t){if(!Array.isArray(e))throw Error(`encodeByteArray takes an array as a parameter`);this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],a=t+1<e.length,o=a?e[t+1]:0,s=t+2<e.length,c=s?e[t+2]:0,l=i>>2,u=(i&3)<<4|o>>4,d=(o&15)<<2|c>>6,f=c&63;s||(f=64,a||(d=64)),r.push(n[l],n[u],n[d],n[f])}return r.join(``)},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):n(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let a=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;let s=t<e.length?n[e.charAt(t)]:64;++t;let c=t<e.length?n[e.charAt(t)]:64;if(++t,a==null||o==null||s==null||c==null)throw new i;let l=a<<2|o>>4;if(r.push(l),s!==64){let e=o<<4&240|s>>2;if(r.push(e),c!==64){let e=s<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},i=class extends Error{constructor(){super(...arguments),this.name=`DecodeBase64StringError`}},a=function(e){let n=t(e);return r.encodeByteArray(n,!0)},o=function(e){return a(e).replace(/\./g,``)},s=function(e){try{return r.decodeString(e,!0)}catch(e){console.error(`base64Decode failed: `,e)}return null};function c(){if(typeof self<`u`)return self;if(typeof window<`u`)return window;if(typeof global<`u`)return global;throw Error(`Unable to locate global object.`)}var l=()=>c().__FIREBASE_DEFAULTS__,u=()=>{if(typeof process>`u`)return;let e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},d=()=>{if(typeof document>`u`)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=e&&s(e[1]);return t&&JSON.parse(t)},f=()=>{try{return e()||l()||u()||d()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},p=e=>f()?.emulatorHosts?.[e],ee=e=>{let t=p(e);if(!t)return;let n=t.lastIndexOf(`:`);if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return t[0]===`[`?[t.substring(1,n-1),r]:[t.substring(0,n),r]},m=()=>f()?.config,h=e=>f()?.[`_${e}`],te=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e==`function`&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};function ne(e){try{return(e.startsWith(`http://`)||e.startsWith(`https://`)?new URL(e).hostname:e).endsWith(`.cloudworkstations.dev`)}catch{return!1}}async function re(e){return(await fetch(e,{credentials:`include`})).ok}function ie(e,t){if(e.uid)throw Error(`The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.`);let n={alg:`none`,type:`JWT`},r=t||`demo-project`,i=e.iat||0,a=e.sub||e.user_id;if(!a)throw Error(`mockUserToken must contain 'sub' or 'user_id' field!`);let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:`custom`,identities:{}},...e};return[o(JSON.stringify(n)),o(JSON.stringify(s)),``].join(`.`)}var ae={};function oe(){let e={prod:[],emulator:[]};for(let t of Object.keys(ae))ae[t]?e.emulator.push(t):e.prod.push(t);return e}function se(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement(`div`),t.setAttribute(`id`,e),n=!0),{created:n,element:t}}var ce=!1;function le(e,t){if(typeof window>`u`||typeof document>`u`||!ne(window.location.host)||ae[e]===t||ae[e]||ce)return;ae[e]=t;function n(e){return`__firebase__banner__${e}`}let r=`__firebase__banner`,i=oe().prod.length>0;function a(){let e=document.getElementById(r);e&&e.remove()}function o(e){e.style.display=`flex`,e.style.background=`#7faaf0`,e.style.position=`fixed`,e.style.bottom=`5px`,e.style.left=`5px`,e.style.padding=`.5em`,e.style.borderRadius=`5px`,e.style.alignItems=`center`}function s(e,t){e.setAttribute(`width`,`24`),e.setAttribute(`id`,t),e.setAttribute(`height`,`24`),e.setAttribute(`viewBox`,`0 0 24 24`),e.setAttribute(`fill`,`none`),e.style.marginLeft=`-6px`}function c(){let e=document.createElement(`span`);return e.style.cursor=`pointer`,e.style.marginLeft=`16px`,e.style.fontSize=`24px`,e.innerHTML=` &times;`,e.onclick=()=>{ce=!0,a()},e}function l(e,t){e.setAttribute(`id`,t),e.innerText=`Learn more`,e.href=`https://firebase.google.com/docs/studio/preview-apps#preview-backend`,e.setAttribute(`target`,`__blank`),e.style.paddingLeft=`5px`,e.style.textDecoration=`underline`}function u(){let e=se(r),t=n(`text`),a=document.getElementById(t)||document.createElement(`span`),u=n(`learnmore`),d=document.getElementById(u)||document.createElement(`a`),f=n(`preprendIcon`),p=document.getElementById(f)||document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);if(e.created){let t=e.element;o(t),l(d,u);let n=c();s(p,f),t.append(p,a,d,n),document.body.appendChild(t)}i?(a.innerText=`Preview backend disconnected.`,p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText=`Preview backend running in this workspace.`),a.setAttribute(`id`,t)}document.readyState===`loading`?window.addEventListener(`DOMContentLoaded`,u):u()}function g(){return typeof navigator<`u`&&typeof navigator.userAgent==`string`?navigator.userAgent:``}function _(){return typeof window<`u`&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function ue(){let e=f()?.forceEnvironment;if(e===`node`)return!0;if(e===`browser`)return!1;try{return Object.prototype.toString.call(global.process)===`[object process]`}catch{return!1}}function de(){return typeof navigator<`u`&&navigator.userAgent===`Cloudflare-Workers`}function fe(){let e=typeof chrome==`object`?chrome.runtime:typeof browser==`object`?browser.runtime:void 0;return typeof e==`object`&&e.id!==void 0}function pe(){return typeof navigator==`object`&&navigator.product===`ReactNative`}function me(){let e=g();return e.indexOf(`MSIE `)>=0||e.indexOf(`Trident/`)>=0}function he(){return!ue()&&!!navigator.userAgent&&navigator.userAgent.includes(`Safari`)&&!navigator.userAgent.includes(`Chrome`)}function ge(){try{return typeof indexedDB==`object`}catch{return!1}}function _e(){return new Promise((e,t)=>{try{let n=!0,r=`validate-browser-context-for-indexeddb-analytics-module`,i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||``)}}catch(e){t(e)}})}function ve(){return!(typeof navigator>`u`||!navigator.cookieEnabled)}var ye=`FirebaseError`,be=class e extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=ye,Object.setPrototypeOf(this,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xe.prototype.create)}},xe=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?Se(i,n):`Error`;return new be(r,`${this.serviceName}: ${a} (${r}).`,n)}};function Se(e,t){return e.replace(Ce,(e,n)=>{let r=t[n];return r==null?`<${n}?>`:String(r)})}var Ce=/\{\$([^}]+)}/g;function we(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Te(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],a=t[i];if(Ee(n)&&Ee(a)){if(!Te(n,a))return!1}else if(n!==a)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function Ee(e){return typeof e==`object`&&!!e}function De(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+`=`+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+`=`+encodeURIComponent(r));return t.length?`&`+t.join(`&`):``}function Oe(e){let t={};return e.replace(/^\?/,``).split(`&`).forEach(e=>{if(e){let[n,r]=e.split(`=`);t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function ke(e){let t=e.indexOf(`?`);if(!t)return``;let n=e.indexOf(`#`,t);return e.substring(t,n>0?n:void 0)}function Ae(e,t){let n=new je(e,t);return n.subscribe.bind(n)}var je=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(e===void 0&&t===void 0&&n===void 0)throw Error(`Missing Observer.`);r=Me(e,[`next`,`error`,`complete`])?e:{next:e,error:t,complete:n},r.next===void 0&&(r.next=Ne),r.error===void 0&&(r.error=Ne),r.complete===void 0&&(r.complete=Ne);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],--this.observerCount,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(e){typeof console<`u`&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Me(e,t){if(typeof e!=`object`||!e)return!1;for(let n of t)if(n in e&&typeof e[n]==`function`)return!0;return!1}function Ne(){}var Pe=1e3,Fe=2,Ie=14400*1e3,Le=.5;function v(e,t=Pe,n=Fe){let r=t*n**+e,i=Math.round(Le*r*(Math.random()-.5)*2);return Math.min(Ie,r+i)}function y(e){return e&&e._delegate?e._delegate:e}var Re=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode=`LAZY`,this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}},ze=`[DEFAULT]`,Be=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new te;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}else if(n)return null;else throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(He(e))try{this.getOrInitializeService({instanceIdentifier:ze})}catch{}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=ze){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>`INTERNAL`in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>`_delete`in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ze){return this.instances.has(e)}getOptions(e=ze){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Ve(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ze){return this.component?this.component.multipleInstances?e:ze:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!==`EXPLICIT`}};function Ve(e){return e===ze?void 0:e}function He(e){return e.instantiationMode===`EAGER`}var Ue=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Be(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}},We=[],b;(function(e){e[e.DEBUG=0]=`DEBUG`,e[e.VERBOSE=1]=`VERBOSE`,e[e.INFO=2]=`INFO`,e[e.WARN=3]=`WARN`,e[e.ERROR=4]=`ERROR`,e[e.SILENT=5]=`SILENT`})(b||={});var Ge={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},Ke=b.INFO,qe={[b.DEBUG]:`log`,[b.VERBOSE]:`log`,[b.INFO]:`info`,[b.WARN]:`warn`,[b.ERROR]:`error`},Je=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=qe[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Ye=class{constructor(e){this.name=e,this._logLevel=Ke,this._logHandler=Je,this._userLogHandler=null,We.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e==`string`?Ge[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!=`function`)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}},Xe=(e,t)=>t.some(t=>e instanceof t),Ze,Qe;function $e(){return Ze||=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]}function et(){return Qe||=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]}var tt=new WeakMap,nt=new WeakMap,rt=new WeakMap,x=new WeakMap,it=new WeakMap;function at(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`success`,i),e.removeEventListener(`error`,a)},i=()=>{t(dt(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener(`success`,i),e.addEventListener(`error`,a)});return t.then(t=>{t instanceof IDBCursor&&tt.set(t,e)}).catch(()=>{}),it.set(t,e),t}function ot(e){if(nt.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`complete`,i),e.removeEventListener(`error`,a),e.removeEventListener(`abort`,a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException(`AbortError`,`AbortError`)),r()};e.addEventListener(`complete`,i),e.addEventListener(`error`,a),e.addEventListener(`abort`,a)});nt.set(e,t)}var st={get(e,t,n){if(e instanceof IDBTransaction){if(t===`done`)return nt.get(e);if(t===`objectStoreNames`)return e.objectStoreNames||rt.get(e);if(t===`store`)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return dt(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t===`done`||t===`store`)?!0:t in e}};function ct(e){st=e(st)}function lt(e){return e===IDBDatabase.prototype.transaction&&!(`objectStoreNames`in IDBTransaction.prototype)?function(t,...n){let r=e.call(ft(this),t,...n);return rt.set(r,t.sort?t.sort():[t]),dt(r)}:et().includes(e)?function(...t){return e.apply(ft(this),t),dt(tt.get(this))}:function(...t){return dt(e.apply(ft(this),t))}}function ut(e){return typeof e==`function`?lt(e):(e instanceof IDBTransaction&&ot(e),Xe(e,$e())?new Proxy(e,st):e)}function dt(e){if(e instanceof IDBRequest)return at(e);if(x.has(e))return x.get(e);let t=ut(e);return t!==e&&(x.set(e,t),it.set(t,e)),t}var ft=e=>it.get(e);function pt(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){let o=indexedDB.open(e,t),s=dt(o);return r&&o.addEventListener(`upgradeneeded`,e=>{r(dt(o.result),e.oldVersion,e.newVersion,dt(o.transaction),e)}),n&&o.addEventListener(`blocked`,e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener(`close`,()=>a()),i&&e.addEventListener(`versionchange`,e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}var mt=[`get`,`getKey`,`getAll`,`getAllKeys`,`count`],ht=[`put`,`add`,`delete`,`clear`],gt=new Map;function _t(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t==`string`))return;if(gt.get(t))return gt.get(t);let n=t.replace(/FromIndex$/,``),r=t!==n,i=ht.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||mt.includes(n)))return;let a=async function(e,...t){let a=this.transaction(e,i?`readwrite`:`readonly`),o=a.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&a.done]))[0]};return gt.set(t,a),a}ct(e=>({...e,get:(t,n,r)=>_t(t,n)||e.get(t,n,r),has:(t,n)=>!!_t(t,n)||e.has(t,n)}));var vt=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(yt(e)){let t=e.getImmediate();return`${t.library}/${t.version}`}else return null}).filter(e=>e).join(` `)}};function yt(e){return e.getComponent()?.type===`VERSION`}var bt=`@firebase/app`,xt=`0.14.7`,St=new Ye(`@firebase/app`),Ct=`@firebase/app-compat`,wt=`@firebase/analytics-compat`,Tt=`@firebase/analytics`,Et=`@firebase/app-check-compat`,Dt=`@firebase/app-check`,Ot=`@firebase/auth`,kt=`@firebase/auth-compat`,At=`@firebase/database`,jt=`@firebase/data-connect`,Mt=`@firebase/database-compat`,Nt=`@firebase/functions`,Pt=`@firebase/functions-compat`,Ft=`@firebase/installations`,It=`@firebase/installations-compat`,Lt=`@firebase/messaging`,Rt=`@firebase/messaging-compat`,zt=`@firebase/performance`,Bt=`@firebase/performance-compat`,Vt=`@firebase/remote-config`,Ht=`@firebase/remote-config-compat`,Ut=`@firebase/storage`,Wt=`@firebase/storage-compat`,Gt=`@firebase/firestore`,Kt=`@firebase/ai`,qt=`@firebase/firestore-compat`,S=`firebase`,Jt=`12.8.0`,Yt=`[DEFAULT]`,Xt={[bt]:`fire-core`,[Ct]:`fire-core-compat`,[Tt]:`fire-analytics`,[wt]:`fire-analytics-compat`,[Dt]:`fire-app-check`,[Et]:`fire-app-check-compat`,[Ot]:`fire-auth`,[kt]:`fire-auth-compat`,[At]:`fire-rtdb`,[jt]:`fire-data-connect`,[Mt]:`fire-rtdb-compat`,[Nt]:`fire-fn`,[Pt]:`fire-fn-compat`,[Ft]:`fire-iid`,[It]:`fire-iid-compat`,[Lt]:`fire-fcm`,[Rt]:`fire-fcm-compat`,[zt]:`fire-perf`,[Bt]:`fire-perf-compat`,[Vt]:`fire-rc`,[Ht]:`fire-rc-compat`,[Ut]:`fire-gcs`,[Wt]:`fire-gcs-compat`,[Gt]:`fire-fst`,[qt]:`fire-fst-compat`,[Kt]:`fire-vertex`,"fire-js":`fire-js`,[S]:`fire-js-all`},Zt=new Map,Qt=new Map,$t=new Map;function en(e,t){try{e.container.addComponent(t)}catch(n){St.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function tn(e){let t=e.name;if($t.has(t))return St.debug(`There were multiple attempts to register component ${t}.`),!1;$t.set(t,e);for(let t of Zt.values())en(t,e);for(let t of Qt.values())en(t,e);return!0}function nn(e,t){let n=e.container.getProvider(`heartbeat`).getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function C(e){return e==null?!1:e.settings!==void 0}var rn=new xe(`app`,`Firebase`,{"no-app":`No Firebase App '{$appName}' has been created - call initializeApp() first`,"bad-app-name":`Illegal App name: '{$appName}'`,"duplicate-app":`Firebase App named '{$appName}' already exists with different options or config`,"app-deleted":`Firebase App named '{$appName}' already deleted`,"server-app-deleted":`Firebase Server App has been deleted`,"no-options":`Need to provide options, when not being deployed to hosting via source.`,"invalid-app-argument":`firebase.{$appName}() takes either no argument or a Firebase App instance.`,"invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":`Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.`,"idb-get":`Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.`,"idb-set":`Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.`,"idb-delete":`Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.`,"finalization-registry-not-supported":`FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.`,"invalid-server-app-environment":`FirebaseServerApp is not for use in browser environments.`}),an=class{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Re(`app`,()=>this,`PUBLIC`))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw rn.create(`app-deleted`,{appName:this._name})}},on=Jt;function sn(e,t={}){let n=e;typeof t!=`object`&&(t={name:t});let r={name:Yt,automaticDataCollectionEnabled:!0,...t},i=r.name;if(typeof i!=`string`||!i)throw rn.create(`bad-app-name`,{appName:String(i)});if(n||=m(),!n)throw rn.create(`no-options`);let a=Zt.get(i);if(a){if(Te(n,a.options)&&Te(r,a.config))return a;throw rn.create(`duplicate-app`,{appName:i})}let o=new Ue(i);for(let e of $t.values())o.addComponent(e);let s=new an(n,r,o);return Zt.set(i,s),s}function cn(e=Yt){let t=Zt.get(e);if(!t&&e===`[DEFAULT]`&&m())return sn();if(!t)throw rn.create(`no-app`,{appName:e});return t}function ln(e,t,n){let r=Xt[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push(`and`),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),St.warn(e.join(` `));return}tn(new Re(`${r}-version`,()=>({library:r,version:t}),`VERSION`))}var un=`firebase-heartbeat-database`,dn=1,fn=`firebase-heartbeat-store`,pn=null;function mn(){return pn||=pt(un,dn,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(fn)}catch(e){console.warn(e)}}}}).catch(e=>{throw rn.create(`idb-open`,{originalErrorMessage:e.message})}),pn}async function hn(e){try{let t=(await mn()).transaction(fn),n=await t.objectStore(fn).get(_n(e));return await t.done,n}catch(e){if(e instanceof be)St.warn(e.message);else{let t=rn.create(`idb-get`,{originalErrorMessage:e?.message});St.warn(t.message)}}}async function gn(e,t){try{let n=(await mn()).transaction(fn,`readwrite`);await n.objectStore(fn).put(t,_n(e)),await n.done}catch(e){if(e instanceof be)St.warn(e.message);else{let t=rn.create(`idb-set`,{originalErrorMessage:e?.message});St.warn(t.message)}}}function _n(e){return`${e.name}!${e.options.appId}`}var vn=1024,yn=30,bn=class{constructor(e){this.container=e,this._heartbeatsCache=null,this._storage=new w(this.container.getProvider(`app`).getImmediate()),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider(`platform-logger`).getImmediate().getPlatformInfoString(),t=xn();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>yn){let e=wn(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){St.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return``;let e=xn(),{heartbeatsToSend:t,unsentEntries:n}=Sn(this._heartbeatsCache.heartbeats),r=o(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return St.warn(e),``}}};function xn(){return new Date().toISOString().substring(0,10)}function Sn(e,t=vn){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Cn(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Cn(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var w=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ge()?_e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let e=await hn(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return gn(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return gn(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}else return}};function Cn(e){return o(JSON.stringify({version:2,heartbeats:e})).length}function wn(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}function Tn(e){tn(new Re(`platform-logger`,e=>new vt(e),`PRIVATE`)),tn(new Re(`heartbeat`,e=>new bn(e),`PRIVATE`)),ln(bt,xt,e),ln(bt,xt,`esm2020`),ln(`fire-js`,``)}Tn(``),ln(`firebase`,`12.8.0`,`app`);function En(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Dn=En,On=new xe(`auth`,`Firebase`,En()),kn=new Ye(`@firebase/auth`);function An(e,...t){kn.logLevel<=b.WARN&&kn.warn(`Auth (${on}): ${e}`,...t)}function jn(e,...t){kn.logLevel<=b.ERROR&&kn.error(`Auth (${on}): ${e}`,...t)}function T(e,...t){throw In(e,...t)}function Mn(e,...t){return In(e,...t)}function Nn(e,t,n){return new xe(`auth`,`Firebase`,{...Dn(),[t]:n}).create(t,{appName:e.name})}function Pn(e){return Nn(e,`operation-not-supported-in-this-environment`,`Operations that alter the current user are not supported in conjunction with FirebaseServerApp`)}function Fn(e,t,n){let r=n;if(!(t instanceof r))throw r.name!==t.constructor.name&&T(e,`argument-error`),Nn(e,`argument-error`,`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function In(e,...t){if(typeof e!=`string`){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return On.create(e,...t)}function E(e,t,...n){if(!e)throw In(t,...n)}function Ln(e){let t=`INTERNAL ASSERTION FAILED: `+e;throw jn(t),Error(t)}function Rn(e,t){e||Ln(t)}function zn(){return typeof self<`u`&&self.location?.href||``}function Bn(){return Vn()===`http:`||Vn()===`https:`}function Vn(){return typeof self<`u`&&self.location?.protocol||null}function Hn(){return typeof navigator<`u`&&navigator&&`onLine`in navigator&&typeof navigator.onLine==`boolean`&&(Bn()||fe()||`connection`in navigator)?navigator.onLine:!0}function Un(){if(typeof navigator>`u`)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}var Wn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rn(t>e,`Short delay should be less than long delay!`),this.isMobile=_()||pe()}get(){return Hn()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Gn(e,t){Rn(e.emulator,`Emulator should always be set here`);let{url:n}=e.emulator;return t?`${n}${t.startsWith(`/`)?t.slice(1):t}`:n}var Kn=class{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<`u`&&`fetch`in self)return self.fetch;if(typeof globalThis<`u`&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<`u`)return fetch;Ln(`Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill`)}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<`u`&&`Headers`in self)return self.Headers;if(typeof globalThis<`u`&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<`u`)return Headers;Ln(`Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill`)}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<`u`&&`Response`in self)return self.Response;if(typeof globalThis<`u`&&globalThis.Response)return globalThis.Response;if(typeof Response<`u`)return Response;Ln(`Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill`)}},qn={CREDENTIAL_MISMATCH:`custom-token-mismatch`,MISSING_CUSTOM_TOKEN:`internal-error`,INVALID_IDENTIFIER:`invalid-email`,MISSING_CONTINUE_URI:`internal-error`,INVALID_PASSWORD:`wrong-password`,MISSING_PASSWORD:`missing-password`,INVALID_LOGIN_CREDENTIALS:`invalid-credential`,EMAIL_EXISTS:`email-already-in-use`,PASSWORD_LOGIN_DISABLED:`operation-not-allowed`,INVALID_IDP_RESPONSE:`invalid-credential`,INVALID_PENDING_TOKEN:`invalid-credential`,FEDERATED_USER_ID_ALREADY_LINKED:`credential-already-in-use`,MISSING_REQ_TYPE:`internal-error`,EMAIL_NOT_FOUND:`user-not-found`,RESET_PASSWORD_EXCEED_LIMIT:`too-many-requests`,EXPIRED_OOB_CODE:`expired-action-code`,INVALID_OOB_CODE:`invalid-action-code`,MISSING_OOB_CODE:`internal-error`,CREDENTIAL_TOO_OLD_LOGIN_AGAIN:`requires-recent-login`,INVALID_ID_TOKEN:`invalid-user-token`,TOKEN_EXPIRED:`user-token-expired`,USER_NOT_FOUND:`user-token-expired`,TOO_MANY_ATTEMPTS_TRY_LATER:`too-many-requests`,PASSWORD_DOES_NOT_MEET_REQUIREMENTS:`password-does-not-meet-requirements`,INVALID_CODE:`invalid-verification-code`,INVALID_SESSION_INFO:`invalid-verification-id`,INVALID_TEMPORARY_PROOF:`invalid-credential`,MISSING_SESSION_INFO:`missing-verification-id`,SESSION_EXPIRED:`code-expired`,MISSING_ANDROID_PACKAGE_NAME:`missing-android-pkg-name`,UNAUTHORIZED_DOMAIN:`unauthorized-continue-uri`,INVALID_OAUTH_CLIENT_ID:`invalid-oauth-client-id`,ADMIN_ONLY_OPERATION:`admin-restricted-operation`,INVALID_MFA_PENDING_CREDENTIAL:`invalid-multi-factor-session`,MFA_ENROLLMENT_NOT_FOUND:`multi-factor-info-not-found`,MISSING_MFA_ENROLLMENT_ID:`missing-multi-factor-info`,MISSING_MFA_PENDING_CREDENTIAL:`missing-multi-factor-session`,SECOND_FACTOR_EXISTS:`second-factor-already-in-use`,SECOND_FACTOR_LIMIT_EXCEEDED:`maximum-second-factor-count-exceeded`,BLOCKING_FUNCTION_ERROR_RESPONSE:`internal-error`,RECAPTCHA_NOT_ENABLED:`recaptcha-not-enabled`,MISSING_RECAPTCHA_TOKEN:`missing-recaptcha-token`,INVALID_RECAPTCHA_TOKEN:`invalid-recaptcha-token`,INVALID_RECAPTCHA_ACTION:`invalid-recaptcha-action`,MISSING_CLIENT_TYPE:`missing-client-type`,MISSING_RECAPTCHA_VERSION:`missing-recaptcha-version`,INVALID_RECAPTCHA_VERSION:`invalid-recaptcha-version`,INVALID_REQ_TYPE:`invalid-req-type`},Jn=[`/v1/accounts:signInWithCustomToken`,`/v1/accounts:signInWithEmailLink`,`/v1/accounts:signInWithIdp`,`/v1/accounts:signInWithPassword`,`/v1/accounts:signInWithPhoneNumber`,`/v1/token`],Yn=new Wn(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function O(e,t,n,r,i={}){return Xn(e,i,async()=>{let i={},a={};r&&(t===`GET`?a=r:i={body:JSON.stringify(r)});let o=De({key:e.config.apiKey,...a}).slice(1),s=await e._getAdditionalHeaders();s[`Content-Type`]=`application/json`,e.languageCode&&(s[`X-Firebase-Locale`]=e.languageCode);let c={method:t,headers:s,...i};return de()||(c.referrerPolicy=`no-referrer`),e.emulatorConfig&&ne(e.emulatorConfig.host)&&(c.credentials=`include`),Kn.fetch()(await Zn(e,e.config.apiHost,n,o),c)})}async function Xn(e,t,n){e._canInitEmulator=!1;let r={...qn,...t};try{let t=new $n(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let a=await i.json();if(`needConfirmation`in a)throw er(e,`account-exists-with-different-credential`,a);if(i.ok&&!(`errorMessage`in a))return a;{let[t,n]=(i.ok?a.errorMessage:a.error.message).split(` : `);if(t===`FEDERATED_USER_ID_ALREADY_LINKED`)throw er(e,`credential-already-in-use`,a);if(t===`EMAIL_EXISTS`)throw er(e,`email-already-in-use`,a);if(t===`USER_DISABLED`)throw er(e,`user-disabled`,a);let o=r[t]||t.toLowerCase().replace(/[_\s]+/g,`-`);if(n)throw Nn(e,o,n);T(e,o)}}catch(t){if(t instanceof be)throw t;T(e,`network-request-failed`,{message:String(t)})}}async function k(e,t,n,r,i={}){let a=await O(e,t,n,r,i);return`mfaPendingCredential`in a&&T(e,`multi-factor-auth-required`,{_serverResponse:a}),a}async function Zn(e,t,n,r){let i=`${t}${n}?${r}`,a=e,o=a.config.emulator?Gn(e.config,i):`${e.config.apiScheme}://${i}`;return Jn.includes(n)&&(await a._persistenceManagerAvailable,a._getPersistenceType()===`COOKIE`)?a._getPersistence()._getFinalTarget(o).toString():o}function Qn(e){switch(e){case`ENFORCE`:return`ENFORCE`;case`AUDIT`:return`AUDIT`;case`OFF`:return`OFF`;default:return`ENFORCEMENT_STATE_UNSPECIFIED`}}var $n=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Mn(this.auth,`network-request-failed`)),Yn.get())})}};function er(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=Mn(e,t,r);return i.customData._tokenResponse=n,i}function tr(e){return e!==void 0&&e.enterprise!==void 0}var nr=class{constructor(e){if(this.siteKey=``,this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw Error(`recaptchaKey undefined`);this.siteKey=e.recaptchaKey.split(`/`)[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Qn(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)===`ENFORCE`||this.getProviderEnforcementState(e)===`AUDIT`}isAnyProviderEnabled(){return this.isProviderEnabled(`EMAIL_PASSWORD_PROVIDER`)||this.isProviderEnabled(`PHONE_PROVIDER`)}};async function rr(e,t){return O(e,`GET`,`/v2/recaptchaConfig`,D(e,t))}async function ir(e,t){return O(e,`POST`,`/v1/accounts:delete`,t)}async function ar(e,t){return O(e,`POST`,`/v1/accounts:lookup`,t)}function or(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function sr(e,t=!1){let n=y(e),r=await n.getIdToken(t),i=lr(r);E(i&&i.exp&&i.auth_time&&i.iat,n.auth,`internal-error`);let a=typeof i.firebase==`object`?i.firebase:void 0,o=a?.sign_in_provider;return{claims:i,token:r,authTime:or(cr(i.auth_time)),issuedAtTime:or(cr(i.iat)),expirationTime:or(cr(i.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}function cr(e){return Number(e)*1e3}function lr(e){let[t,n,r]=e.split(`.`);if(t===void 0||n===void 0||r===void 0)return jn(`JWT malformed, contained fewer than 3 sections`),null;try{let e=s(n);return e?JSON.parse(e):(jn(`Failed to decode base64 JWT payload`),null)}catch(e){return jn(`Caught error parsing JWT payload as JSON`,e?.toString()),null}}function ur(e){let t=lr(e);return E(t,`internal-error`),E(t.exp!==void 0,`internal-error`),E(t.iat!==void 0,`internal-error`),Number(t.exp)-Number(t.iat)}async function dr(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof be&&fr(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function fr({code:e}){return e===`auth/user-disabled`||e===`auth/user-token-expired`}var pr=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;let e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code===`auth/network-request-failed`&&this.schedule(!0);return}this.schedule()}},mr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=or(this.lastLoginAt),this.creationTime=or(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function hr(e){let t=e.auth,n=await dr(e,ar(t,{idToken:await e.getIdToken()}));E(n?.users.length,t,`internal-error`);let r=n.users[0];e._notifyReloadListener(r);let i=r.providerUserInfo?.length?vr(r.providerUserInfo):[],a=_r(e.providerData,i),o=e.isAnonymous,s=!(e.email&&r.passwordHash)&&!a?.length,c=o?s:!1,l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new mr(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(e,l)}async function gr(e){let t=y(e);await hr(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function _r(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function vr(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||``,displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function yr(e,t){let n=await Xn(e,{},async()=>{let n=De({grant_type:`refresh_token`,refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,a=await Zn(e,r,`/v1/token`,`key=${i}`),o=await e._getAdditionalHeaders();o[`Content-Type`]=`application/x-www-form-urlencoded`;let s={method:`POST`,headers:o,body:n};return e.emulatorConfig&&ne(e.emulatorConfig.host)&&(s.credentials=`include`),Kn.fetch()(a,s)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function br(e,t){return O(e,`POST`,`/v2/accounts:revokeToken`,D(e,t))}var xr=class e{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){E(e.idToken,`internal-error`),E(e.idToken!==void 0,`internal-error`),E(e.refreshToken!==void 0,`internal-error`);let t=`expiresIn`in e&&e.expiresIn!==void 0?Number(e.expiresIn):ur(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){E(e.length!==0,`internal-error`);let t=ur(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(E(this.refreshToken,e,`user-token-expired`),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await yr(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(t,n){let{refreshToken:r,accessToken:i,expirationTime:a}=n,o=new e;return r&&(E(typeof r==`string`,`internal-error`,{appName:t}),o.refreshToken=r),i&&(E(typeof i==`string`,`internal-error`,{appName:t}),o.accessToken=i),a&&(E(typeof a==`number`,`internal-error`,{appName:t}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new e,this.toJSON())}_performRefresh(){return Ln(`not implemented`)}};function Sr(e,t){E(typeof e==`string`||e===void 0,`internal-error`,{appName:t})}var Cr=class e{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId=`firebase`,this.proactiveRefresh=new pr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new mr(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await dr(this,this.stsTokenManager.getToken(this.auth,e));return E(t,this.auth,`internal-error`),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return sr(this,e)}reload(){return gr(this)}_assign(e){this!==e&&(E(this.uid===e.uid,this.auth,`internal-error`),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(t){let n=new e({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){E(!this.reloadListener,this.auth,`internal-error`),this.reloadListener=e,this.reloadUserInfo&&=(this._notifyReloadListener(this.reloadUserInfo),null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await hr(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(C(this.auth.app))return Promise.reject(Pn(this.auth));let e=await this.getIdToken();return await dr(this,ir(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||``}static _fromJSON(t,n){let r=n.displayName??void 0,i=n.email??void 0,a=n.phoneNumber??void 0,o=n.photoURL??void 0,s=n.tenantId??void 0,c=n._redirectEventId??void 0,l=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:d,emailVerified:f,isAnonymous:p,providerData:ee,stsTokenManager:m}=n;E(d&&m,t,`internal-error`);let h=xr.fromJSON(this.name,m);E(typeof d==`string`,t,`internal-error`),Sr(r,t.name),Sr(i,t.name),E(typeof f==`boolean`,t,`internal-error`),E(typeof p==`boolean`,t,`internal-error`),Sr(a,t.name),Sr(o,t.name),Sr(s,t.name),Sr(c,t.name),Sr(l,t.name),Sr(u,t.name);let te=new e({uid:d,auth:t,email:i,emailVerified:f,displayName:r,isAnonymous:p,photoURL:o,phoneNumber:a,tenantId:s,stsTokenManager:h,createdAt:l,lastLoginAt:u});return ee&&Array.isArray(ee)&&(te.providerData=ee.map(e=>({...e}))),c&&(te._redirectEventId=c),te}static async _fromIdTokenResponse(t,n,r=!1){let i=new xr;i.updateFromServerResponse(n);let a=new e({uid:n.localId,auth:t,stsTokenManager:i,isAnonymous:r});return await hr(a),a}static async _fromGetAccountInfoResponse(t,n,r){let i=n.users[0];E(i.localId!==void 0,`internal-error`);let a=i.providerUserInfo===void 0?[]:vr(i.providerUserInfo),o=!(i.email&&i.passwordHash)&&!a?.length,s=new xr;s.updateFromIdToken(r);let c=new e({uid:i.localId,auth:t,stsTokenManager:s,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new mr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!a?.length};return Object.assign(c,l),c}},wr=new Map;function Tr(e){Rn(e instanceof Function,`Expected a class definition`);let t=wr.get(e);return t?(Rn(t instanceof e,`Instance stored in cache mismatched with class`),t):(t=new e,wr.set(e,t),t)}var Er=class{constructor(){this.type=`NONE`,this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}};Er.type=`NONE`;var Dr=Er;function Or(e,t,n){return`firebase:${e}:${t}:${n}`}var kr=class e{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:r,name:i}=this.auth;this.fullUserKey=Or(this.userKey,r.apiKey,i),this.fullPersistenceKey=Or(`persistence`,r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e==`string`){let t=await ar(this.auth,{idToken:e}).catch(()=>void 0);return t?Cr._fromGetAccountInfoResponse(this.auth,t,e):null}return Cr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,r=`authUser`){if(!n.length)return new e(Tr(Dr),t,r);let i=(await Promise.all(n.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),a=i[0]||Tr(Dr),o=Or(r,t.config.apiKey,t.name),s=null;for(let e of n)try{let n=await e._get(o);if(n){let r;if(typeof n==`string`){let e=await ar(t,{idToken:n}).catch(()=>void 0);if(!e)break;r=await Cr._fromGetAccountInfoResponse(t,e,n)}else r=Cr._fromJSON(t,n);e!==a&&(s=r),a=e;break}}catch{}let c=i.filter(e=>e._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new e(a,t,r):(a=c[0],s&&await a._set(o,s.toJSON()),await Promise.all(n.map(async e=>{if(e!==a)try{await e._remove(o)}catch{}})),new e(a,t,r))}};function Ar(e){let t=e.toLowerCase();if(t.includes(`opera/`)||t.includes(`opr/`)||t.includes(`opios/`))return`Opera`;if(Pr(t))return`IEMobile`;if(t.includes(`msie`)||t.includes(`trident/`))return`IE`;if(t.includes(`edge/`))return`Edge`;if(jr(t))return`Firefox`;if(t.includes(`silk/`))return`Silk`;if(Ir(t))return`Blackberry`;if(Lr(t))return`Webos`;if(Mr(t))return`Safari`;if((t.includes(`chrome/`)||Nr(t))&&!t.includes(`edge/`))return`Chrome`;if(Fr(t))return`Android`;{let t=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(t?.length===2)return t[1]}return`Other`}function jr(e=g()){return/firefox\//i.test(e)}function Mr(e=g()){let t=e.toLowerCase();return t.includes(`safari/`)&&!t.includes(`chrome/`)&&!t.includes(`crios/`)&&!t.includes(`android`)}function Nr(e=g()){return/crios\//i.test(e)}function Pr(e=g()){return/iemobile/i.test(e)}function Fr(e=g()){return/android/i.test(e)}function Ir(e=g()){return/blackberry/i.test(e)}function Lr(e=g()){return/webos/i.test(e)}function Rr(e=g()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function zr(e=g()){return Rr(e)&&!!window.navigator?.standalone}function Br(){return me()&&document.documentMode===10}function Vr(e=g()){return Rr(e)||Fr(e)||Lr(e)||Ir(e)||/windows phone/i.test(e)||Pr(e)}function Hr(e,t=[]){let n;switch(e){case`Browser`:n=Ar(g());break;case`Worker`:n=`${Ar(g())}-${e}`;break;default:n=e}let r=t.length?t.join(`,`):`FirebaseCore-web`;return`${n}/JsCore/${on}/${r}`}var Ur=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{n(e(t))}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(let e of t)try{e()}catch{}throw this.auth._errorFactory.create(`login-blocked`,{originalMessage:e?.message})}}};async function Wr(e,t={}){return O(e,`GET`,`/v2/passwordPolicy`,D(e,t))}var Gr=6,Kr=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Gr,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState===`ENFORCEMENT_STATE_UNSPECIFIED`&&(this.enforcementState=`OFF`),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join(``)??``,this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&=t.meetsMinPasswordLength??!0,t.isValid&&=t.meetsMaxPasswordLength??!0,t.isValid&&=t.containsLowercaseLetter??!0,t.isValid&&=t.containsUppercaseLetter??!0,t.isValid&&=t.containsNumericCharacter??!0,t.isValid&&=t.containsNonAlphanumericCharacter??!0,t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>=`a`&&n<=`z`,n>=`A`&&n<=`Z`,n>=`0`&&n<=`9`,this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||=t),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||=n),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||=r),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||=i)}},qr=class{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yr(this),this.idTokenSubscription=new Yr(this),this.beforeStateQueue=new Ur(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=On,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Tr(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await kr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await ar(this,{idToken:e}),n=await Cr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn(`FirebaseServerApp could not login user with provided authIdToken: `,e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(C(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,a=await this.tryRedirectSignIn(e);(!t||t===i)&&a?.user&&(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return E(this._popupRedirectResolver,this,`argument-error`),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await hr(e)}catch(e){if(e?.code!==`auth/network-request-failed`)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Un()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(C(this.app))return Promise.reject(Pn(this));let t=e?y(e):null;return t&&E(t.auth.config.apiKey===this.config.apiKey,this,`invalid-user-token`),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&E(this.tenantId===e.tenantId,this,`tenant-id-mismatch`),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return C(this.app)?Promise.reject(Pn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return C(this.app)?Promise.reject(Pn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Tr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion===this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?t.validatePassword(e):Promise.reject(this._errorFactory.create(`unsupported-password-policy-schema-version`,{}))}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new Kr(await Wr(this));this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new xe(`auth`,`Firebase`,e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:`apple.com`,tokenType:`ACCESS_TOKEN`,token:e,idToken:await this.currentUser.getIdToken()};this.tenantId!=null&&(t.tenantId=this.tenantId),await br(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&Tr(e)||this._popupRedirectResolver;E(t,this,`argument-error`),this.redirectPersistenceManager=await kr.create(this,[Tr(t._redirectPersistence)],`redirectUser`),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i=typeof t==`function`?t:t.next.bind(t),a=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(E(o,this,`internal-error`),o.then(()=>{a||i(this.currentUser)}),typeof t==`function`){let i=e.addObserver(t,n,r);return()=>{a=!0,i()}}else{let n=e.addObserver(t);return()=>{a=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return E(this.persistenceManager,this,`internal-error`),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e[`X-Firebase-gmpid`]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e[`X-Firebase-Client`]=t);let n=await this._getAppCheckToken();return n&&(e[`X-Firebase-AppCheck`]=n),e}async _getAppCheckToken(){if(C(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&An(`Error while retrieving App Check token: ${e.error}`),e?.token}};function Jr(e){return y(e)}var Yr=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ae(e=>this.observer=e)}get next(){return E(this.observer,this.auth,`internal-error`),this.observer.next.bind(this.observer)}},Xr={async loadJS(){throw Error(`Unable to load external scripts`)},recaptchaV2Script:``,recaptchaEnterpriseScript:``,gapiScript:``};function Zr(e){Xr=e}function Qr(e){return Xr.loadJS(e)}function $r(){return Xr.recaptchaEnterpriseScript}function ei(){return Xr.gapiScript}function ti(e){return`__${e}${Math.floor(Math.random()*1e6)}`}var ni=class{constructor(){this.enterprise=new ri}ready(e){e()}execute(e,t){return Promise.resolve(`token`)}render(e,t){return``}},ri=class{ready(e){e()}execute(e,t){return Promise.resolve(`token`)}render(e,t){return``}},ii=`recaptcha-enterprise`,ai=`NO_RECAPTCHA`,oi=class{constructor(e){this.type=ii,this.auth=Jr(e)}async verify(e=`verify`,t=!1){async function n(e){if(!t){if(e.tenantId==null&&e._agentRecaptchaConfig!=null)return e._agentRecaptchaConfig.siteKey;if(e.tenantId!=null&&e._tenantRecaptchaConfigs[e.tenantId]!==void 0)return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{rr(e,{clientType:`CLIENT_TYPE_WEB`,version:`RECAPTCHA_ENTERPRISE`}).then(r=>{if(r.recaptchaKey===void 0)n(Error(`recaptcha Enterprise site key undefined`));else{let n=new nr(r);return e.tenantId==null?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;tr(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(ai)})}):r(Error(`No reCAPTCHA enterprise script loaded.`))}return this.auth.settings.appVerificationDisabledForTesting?new ni().execute(`siteKey`,{action:`verify`}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&tr(window.grecaptcha))r(n,e,i);else{if(typeof window>`u`){i(Error(`RecaptchaVerifier is only supported in browser`));return}let t=$r();t.length!==0&&(t+=n),Qr(t).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}};async function si(e,t,n,r=!1,i=!1){let a=new oi(e),o;if(i)o=ai;else try{o=await a.verify(n)}catch{o=await a.verify(n,!0)}let s={...t};if(n===`mfaSmsEnrollment`||n===`mfaSmsSignIn`){if(`phoneEnrollmentInfo`in s){let e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:`CLIENT_TYPE_WEB`,recaptchaVersion:`RECAPTCHA_ENTERPRISE`}})}else if(`phoneSignInInfo`in s){let e=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:`CLIENT_TYPE_WEB`,recaptchaVersion:`RECAPTCHA_ENTERPRISE`}})}return s}return r?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:`CLIENT_TYPE_WEB`}),Object.assign(s,{recaptchaVersion:`RECAPTCHA_ENTERPRISE`}),s}async function ci(e,t,n,r,i){return i===`EMAIL_PASSWORD_PROVIDER`?e._getRecaptchaConfig()?.isProviderEnabled(`EMAIL_PASSWORD_PROVIDER`)?r(e,await si(e,t,n,n===`getOobCode`)):r(e,t).catch(async i=>i.code===`auth/missing-recaptcha-token`?(console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`),r(e,await si(e,t,n,n===`getOobCode`))):Promise.reject(i)):i===`PHONE_PROVIDER`?e._getRecaptchaConfig()?.isProviderEnabled(`PHONE_PROVIDER`)?r(e,await si(e,t,n)).catch(async i=>e._getRecaptchaConfig()?.getProviderEnforcementState(`PHONE_PROVIDER`)===`AUDIT`&&(i.code===`auth/missing-recaptcha-token`||i.code===`auth/invalid-app-credential`)?(console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`),r(e,await si(e,t,n,!1,!0))):Promise.reject(i)):r(e,await si(e,t,n,!1,!0)):Promise.reject(i+` provider is not supported.`)}async function li(e){let t=Jr(e),n=new nr(await rr(t,{clientType:`CLIENT_TYPE_WEB`,version:`RECAPTCHA_ENTERPRISE`}));t.tenantId==null?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new oi(t).verify()}function ui(e,t){let n=nn(e,`auth`);if(n.isInitialized()){let e=n.getImmediate();if(Te(n.getOptions(),t??{}))return e;T(e,`already-initialized`)}return n.initialize({options:t})}function di(e,t){let n=t?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Tr);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t?.popupRedirectResolver)}function fi(e,t,n){let r=Jr(e);E(/^https?:\/\//.test(t),r,`invalid-emulator-scheme`);let i=!!n?.disableWarnings,a=pi(t),{host:o,port:s}=mi(t),c=s===null?``:`:${s}`,l={url:`${a}//${o}${c}/`},u=Object.freeze({host:o,port:s,protocol:a.replace(`:`,``),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){E(r.config.emulator&&r.emulatorConfig,r,`emulator-config-failed`),E(Te(l,r.config.emulator)&&Te(u,r.emulatorConfig),r,`emulator-config-failed`);return}r.config.emulator=l,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,ne(o)?(re(`${a}//${o}${c}`),le(`Auth`,!0)):i||gi()}function pi(e){let t=e.indexOf(`:`);return t<0?``:e.substr(0,t+1)}function mi(e){let t=pi(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:``,port:null};let r=n[2].split(`@`).pop()||``,i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:hi(r.substr(e.length+1))}}else{let[e,t]=r.split(`:`);return{host:e,port:hi(t)}}}function hi(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function gi(){function e(){let e=document.createElement(`p`),t=e.style;e.innerText=`Running in emulator mode. Do not use with production credentials.`,t.position=`fixed`,t.width=`100%`,t.backgroundColor=`#ffffff`,t.border=`.1em solid #000000`,t.color=`#b50000`,t.bottom=`0px`,t.left=`0px`,t.margin=`0px`,t.zIndex=`10000`,t.textAlign=`center`,e.classList.add(`firebase-emulator-warning`),document.body.appendChild(e)}typeof console<`u`&&typeof console.info==`function`&&console.info(`WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.`),typeof window<`u`&&typeof document<`u`&&(document.readyState===`loading`?window.addEventListener(`DOMContentLoaded`,e):e())}var _i=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ln(`not implemented`)}_getIdTokenResponse(e){return Ln(`not implemented`)}_linkToIdToken(e,t){return Ln(`not implemented`)}_getReauthenticationResolver(e){return Ln(`not implemented`)}};async function vi(e,t){return O(e,`POST`,`/v1/accounts:signUp`,t)}async function yi(e,t){return k(e,`POST`,`/v1/accounts:signInWithPassword`,D(e,t))}async function bi(e,t){return k(e,`POST`,`/v1/accounts:signInWithEmailLink`,D(e,t))}async function xi(e,t){return k(e,`POST`,`/v1/accounts:signInWithEmailLink`,D(e,t))}var Si=class e extends _i{constructor(e,t,n,r=null){super(`password`,n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(t,n){return new e(t,n,`password`)}static _fromEmailAndCode(t,n,r=null){return new e(t,n,`emailLink`,r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e==`string`?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod===`password`)return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod===`emailLink`)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case`password`:return ci(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:`CLIENT_TYPE_WEB`},`signInWithPassword`,yi,`EMAIL_PASSWORD_PROVIDER`);case`emailLink`:return bi(e,{email:this._email,oobCode:this._password});default:T(e,`internal-error`)}}async _linkToIdToken(e,t){switch(this.signInMethod){case`password`:return ci(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:`CLIENT_TYPE_WEB`},`signUpPassword`,vi,`EMAIL_PASSWORD_PROVIDER`);case`emailLink`:return xi(e,{idToken:t,email:this._email,oobCode:this._password});default:T(e,`internal-error`)}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};async function Ci(e,t){return k(e,`POST`,`/v1/accounts:signInWithIdp`,D(e,t))}var wi=`http://localhost`,Ti=class e extends _i{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){let n=new e(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(n.idToken=t.idToken),t.accessToken&&(n.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(n.nonce=t.nonce),t.pendingToken&&(n.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(n.accessToken=t.oauthToken,n.secret=t.oauthTokenSecret):T(`argument-error`),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){let{providerId:n,signInMethod:r,...i}=typeof t==`string`?JSON.parse(t):t;if(!n||!r)return null;let a=new e(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return Ci(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,Ci(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Ci(e,t)}buildRequest(){let e={requestUri:wi,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=De(t)}return e}};async function Ei(e,t){return O(e,`POST`,`/v1/accounts:sendVerificationCode`,D(e,t))}async function Di(e,t){return k(e,`POST`,`/v1/accounts:signInWithPhoneNumber`,D(e,t))}async function Oi(e,t){let n=await k(e,`POST`,`/v1/accounts:signInWithPhoneNumber`,D(e,t));if(n.temporaryProof)throw er(e,`account-exists-with-different-credential`,n);return n}var ki={USER_NOT_FOUND:`user-not-found`};async function Ai(e,t){return k(e,`POST`,`/v1/accounts:signInWithPhoneNumber`,D(e,{...t,operation:`REAUTH`}),ki)}var ji=class e extends _i{constructor(e){super(`phone`,`phone`),this.params=e}static _fromVerification(t,n){return new e({verificationId:t,verificationCode:n})}static _fromTokenResponse(t,n){return new e({phoneNumber:t,temporaryProof:n})}_getIdTokenResponse(e){return Di(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return Oi(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return Ai(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(t){typeof t==`string`&&(t=JSON.parse(t));let{verificationId:n,verificationCode:r,phoneNumber:i,temporaryProof:a}=t;return!r&&!n&&!i&&!a?null:new e({verificationId:n,verificationCode:r,phoneNumber:i,temporaryProof:a})}};function Mi(e){switch(e){case`recoverEmail`:return`RECOVER_EMAIL`;case`resetPassword`:return`PASSWORD_RESET`;case`signIn`:return`EMAIL_SIGNIN`;case`verifyEmail`:return`VERIFY_EMAIL`;case`verifyAndChangeEmail`:return`VERIFY_AND_CHANGE_EMAIL`;case`revertSecondFactorAddition`:return`REVERT_SECOND_FACTOR_ADDITION`;default:return null}}function Ni(e){let t=Oe(ke(e)).link,n=t?Oe(ke(t)).deep_link_id:null,r=Oe(ke(e)).deep_link_id;return(r?Oe(ke(r)).link:null)||r||n||t||e}var Pi=class e{constructor(e){let t=Oe(ke(e)),n=t.apiKey??null,r=t.oobCode??null,i=Mi(t.mode??null);E(n&&r&&i,`argument-error`),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(t){let n=Ni(t);try{return new e(n)}catch{return null}}},Fi=class e{constructor(){this.providerId=e.PROVIDER_ID}static credential(e,t){return Si._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=Pi.parseLink(t);return E(n,`argument-error`),Si._fromEmailAndCode(e,n.code,n.tenantId)}};Fi.PROVIDER_ID=`password`,Fi.EMAIL_PASSWORD_SIGN_IN_METHOD=`password`,Fi.EMAIL_LINK_SIGN_IN_METHOD=`emailLink`;var Ii=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}},Li=class extends Ii{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}},Ri=class e extends Li{constructor(){super(`facebook.com`)}static credential(t){return Ti._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!(`oauthAccessToken`in t)||!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch{return null}}};Ri.FACEBOOK_SIGN_IN_METHOD=`facebook.com`,Ri.PROVIDER_ID=`facebook.com`;var zi=class e extends Li{constructor(){super(`google.com`),this.addScope(`profile`)}static credential(t,n){return Ti._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return e.credential(n,r)}catch{return null}}};zi.GOOGLE_SIGN_IN_METHOD=`google.com`,zi.PROVIDER_ID=`google.com`;var Bi=class e extends Li{constructor(){super(`github.com`)}static credential(t){return Ti._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!(`oauthAccessToken`in t)||!t.oauthAccessToken)return null;try{return e.credential(t.oauthAccessToken)}catch{return null}}};Bi.GITHUB_SIGN_IN_METHOD=`github.com`,Bi.PROVIDER_ID=`github.com`;var Vi=class e extends Li{constructor(){super(`twitter.com`)}static credential(t,n){return Ti._fromParams({providerId:e.PROVIDER_ID,signInMethod:e.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:n})}static credentialFromResult(t){return e.credentialFromTaggedObject(t)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return e.credential(n,r)}catch{return null}}};Vi.TWITTER_SIGN_IN_METHOD=`twitter.com`,Vi.PROVIDER_ID=`twitter.com`;var Hi=class e{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(t,n,r,i=!1){return new e({user:await Cr._fromIdTokenResponse(t,r,i),providerId:Ui(r),_tokenResponse:r,operationType:n})}static async _forOperation(t,n,r){return await t._updateTokensIfNecessary(r,!0),new e({user:t,providerId:Ui(r),_tokenResponse:r,operationType:n})}};function Ui(e){return e.providerId?e.providerId:`phoneNumber`in e?`phone`:null}var Wi=class e extends be{constructor(t,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,e.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(t,n,r,i){return new e(t,n,r,i)}};function Gi(e,t,n,r){return(t===`reauthenticate`?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{throw n.code===`auth/multi-factor-auth-required`?Wi._fromErrorAndOperation(e,n,t,r):n})}async function Ki(e,t,n=!1){let r=await dr(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Hi._forOperation(e,`link`,r)}async function qi(e,t,n=!1){let{auth:r}=e;if(C(r.app))return Promise.reject(Pn(r));let i=`reauthenticate`;try{let a=await dr(e,Gi(r,i,t,e),n);E(a.idToken,r,`internal-error`);let o=lr(a.idToken);E(o,r,`internal-error`);let{sub:s}=o;return E(e.uid===s,r,`user-mismatch`),Hi._forOperation(e,i,a)}catch(e){throw e?.code===`auth/user-not-found`&&T(r,`user-mismatch`),e}}async function Ji(e,t,n=!1){if(C(e.app))return Promise.reject(Pn(e));let r=`signIn`,i=await Gi(e,r,t),a=await Hi._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}function Yi(e,t,n,r){return y(e).onIdTokenChanged(t,n,r)}function Xi(e,t,n){return y(e).beforeAuthStateChanged(t,n)}function Zi(e,t,n,r){return y(e).onAuthStateChanged(t,n,r)}function Qi(e){return y(e).signOut()}function $i(e,t){return O(e,`POST`,`/v2/accounts/mfaEnrollment:start`,D(e,t))}function ea(e,t){return O(e,`POST`,`/v2/accounts/mfaEnrollment:finalize`,D(e,t))}function ta(e,t){return O(e,`POST`,`/v2/accounts/mfaEnrollment:start`,D(e,t))}function na(e,t){return O(e,`POST`,`/v2/accounts/mfaEnrollment:finalize`,D(e,t))}var ra=`__sak`,ia=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ra,`1`),this.storage.removeItem(ra),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}},aa=1e3,oa=10,sa=class extends ia{constructor(){super(()=>window.localStorage,`LOCAL`),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});return}let n=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(n);!t&&this.localCache[n]===e||this.notifyListeners(n,e)},i=this.storage.getItem(n);Br()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,oa):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent(`storage`,{key:e,oldValue:t,newValue:n}),!0)})},aa)}stopPolling(){this.pollTimer&&=(clearInterval(this.pollTimer),null)}attachListener(){window.addEventListener(`storage`,this.boundEventHandler)}detachListener(){window.removeEventListener(`storage`,this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}};sa.type=`LOCAL`;var ca=sa,la=1e3;function ua(e){let t=e.replace(/[\\^$.*+?()[\]{}|]/g,`\\$&`),n=RegExp(`${t}=([^;]+)`);return document.cookie.match(n)?.[1]??null}function da(e){return`${window.location.protocol===`http:`?`__dev_`:`__HOST-`}FIREBASE_${e.split(`:`)[3]}`}var fa=class{constructor(){this.type=`COOKIE`,this.listenerUnsubscribes=new Map}_getFinalTarget(e){let t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set(`finalTarget`,e),t}async _isAvailable(){return typeof isSecureContext==`boolean`&&!isSecureContext||typeof navigator>`u`||typeof document>`u`?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;let t=da(e);return window.cookieStore?(await window.cookieStore.get(t))?.value:ua(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;let t=da(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch(`/__cookies__`,{method:`DELETE`}).catch(()=>void 0)}_addListener(e,t){if(!this._isAvailable())return;let n=da(e);if(window.cookieStore){let e=(e=>{let r=e.changed.find(e=>e.name===n);r&&t(r.value),e.deleted.find(e=>e.name===n)&&t(null)});return this.listenerUnsubscribes.set(t,()=>window.cookieStore.removeEventListener(`change`,e)),window.cookieStore.addEventListener(`change`,e)}let r=ua(n),i=setInterval(()=>{let e=ua(n);e!==r&&(t(e),r=e)},la);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){let n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}};fa.type=`COOKIE`;var pa=class extends ia{constructor(){super(()=>window.sessionStorage,`SESSION`)}_addListener(e,t){}_removeListener(e,t){}};pa.type=`SESSION`;var ma=pa;function ha(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}}))}var ga=class e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let n=this.receivers.find(e=>e.isListeningto(t));if(n)return n;let r=new e(t);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:n,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!a?.size)return;t.ports[0].postMessage({status:`ack`,eventId:n,eventType:r});let o=await ha(Array.from(a).map(async e=>e(t.origin,i)));t.ports[0].postMessage({status:`done`,eventId:n,eventType:r,response:o})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener(`message`,this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener(`message`,this.boundEventHandler)}};ga.receivers=[];function _a(e=``,t=10){let n=``;for(let e=0;e<t;e++)n+=Math.floor(Math.random()*10);return e+n}var va=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener(`message`,e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r=typeof MessageChannel<`u`?new MessageChannel:null;if(!r)throw Error(`connection_unavailable`);let i,a;return new Promise((o,s)=>{let c=_a(``,20);r.port1.start();let l=setTimeout(()=>{s(Error(`unsupported_event`))},n);a={messageChannel:r,onMessage(e){let t=e;if(t.data.eventId===c)switch(t.data.status){case`ack`:clearTimeout(l),i=setTimeout(()=>{s(Error(`timeout`))},3e3);break;case`done`:clearTimeout(i),o(t.data.response);break;default:clearTimeout(l),clearTimeout(i),s(Error(`invalid_response`));break}}},this.handlers.add(a),r.port1.addEventListener(`message`,a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}};function ya(){return window}function ba(e){ya().location.href=e}function xa(){return ya().WorkerGlobalScope!==void 0&&typeof ya().importScripts==`function`}async function Sa(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ca(){return navigator?.serviceWorker?.controller||null}function wa(){return xa()?self:null}var Ta=`firebaseLocalStorageDb`,Ea=1,Da=`firebaseLocalStorage`,Oa=`fbase_key`,ka=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener(`success`,()=>{e(this.request.result)}),this.request.addEventListener(`error`,()=>{t(this.request.error)})})}};function Aa(e,t){return e.transaction([Da],t?`readwrite`:`readonly`).objectStore(Da)}function ja(){return new ka(indexedDB.deleteDatabase(Ta)).toPromise()}function Ma(){let e=indexedDB.open(Ta,Ea);return new Promise((t,n)=>{e.addEventListener(`error`,()=>{n(e.error)}),e.addEventListener(`upgradeneeded`,()=>{let t=e.result;try{t.createObjectStore(Da,{keyPath:Oa})}catch(e){n(e)}}),e.addEventListener(`success`,async()=>{let n=e.result;n.objectStoreNames.contains(Da)?t(n):(n.close(),await ja(),t(await Ma()))})})}async function Na(e,t,n){return new ka(Aa(e,!0).put({[Oa]:t,value:n})).toPromise()}async function Pa(e,t){let n=await new ka(Aa(e,!1).get(t)).toPromise();return n===void 0?null:n.value}function Fa(e,t){return new ka(Aa(e,!0).delete(t)).toPromise()}var Ia=800,La=3,Ra=class{constructor(){this.type=`LOCAL`,this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||=await Ma(),this.db}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(t++>La)throw e;this.db&&=(this.db.close(),void 0)}}async initializeServiceWorkerMessaging(){return xa()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ga._getInstance(wa()),this.receiver._subscribe(`keyChanged`,async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe(`ping`,async(e,t)=>[`keyChanged`])}async initializeSender(){if(this.activeServiceWorker=await Sa(),!this.activeServiceWorker)return;this.sender=new va(this.activeServiceWorker);let e=await this.sender._send(`ping`,{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes(`keyChanged`)&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ca()!==this.activeServiceWorker))try{await this.sender._send(`keyChanged`,{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await Ma();return await Na(e,ra,`1`),await Fa(e,ra),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Na(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>Pa(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Fa(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new ka(Aa(e,!1).getAll()).toPromise());if(!e||this.pendingWrites!==0)return[];let t=[],n=new Set;if(e.length!==0)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Ia)}stopPolling(){this.pollTimer&&=(clearInterval(this.pollTimer),null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}};Ra.type=`LOCAL`;var za=Ra;function Ba(e,t){return O(e,`POST`,`/v2/accounts/mfaSignIn:start`,D(e,t))}function Va(e,t){return O(e,`POST`,`/v2/accounts/mfaSignIn:finalize`,D(e,t))}function Ha(e,t){return O(e,`POST`,`/v2/accounts/mfaSignIn:finalize`,D(e,t))}ti(`rcb`),new Wn(3e4,6e4);var Ua=`recaptcha`;async function Wa(e,t,n){if(!e._getRecaptchaConfig())try{await li(e)}catch{console.log(`Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.`)}try{let r;if(r=typeof t==`string`?{phoneNumber:t}:t,`session`in r){let t=r.session;if(`phoneNumber`in r)return E(t.type===`enroll`,e,`internal-error`),(await ci(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:`CLIENT_TYPE_WEB`}},`mfaSmsEnrollment`,async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===ai?(E(n?.type===Ua,e,`argument-error`),$i(e,await Ga(e,t,n))):$i(e,t),`PHONE_PROVIDER`).catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo;{E(t.type===`signin`,e,`internal-error`);let i=r.multiFactorHint?.uid||r.multiFactorUid;return E(i,e,`missing-multi-factor-info`),(await ci(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:`CLIENT_TYPE_WEB`}},`mfaSmsSignIn`,async(e,t)=>t.phoneSignInInfo.captchaResponse===ai?(E(n?.type===Ua,e,`argument-error`),Ba(e,await Ga(e,t,n))):Ba(e,t),`PHONE_PROVIDER`).catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}else return(await ci(e,{phoneNumber:r.phoneNumber,clientType:`CLIENT_TYPE_WEB`},`sendVerificationCode`,async(e,t)=>t.captchaResponse===ai?(E(n?.type===Ua,e,`argument-error`),Ei(e,await Ga(e,t,n))):Ei(e,t),`PHONE_PROVIDER`).catch(e=>Promise.reject(e))).sessionInfo}finally{n?._reset()}}async function Ga(e,t,n){E(n.type===Ua,e,`argument-error`);let r=await n.verify();E(typeof r==`string`,e,`argument-error`);let i={...t};if(`phoneEnrollmentInfo`in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,a=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:a}}),i}else if(`phoneSignInInfo`in i){let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}else return Object.assign(i,{recaptchaToken:r}),i}var Ka=class e{constructor(t){this.providerId=e.PROVIDER_ID,this.auth=Jr(t)}verifyPhoneNumber(e,t){return Wa(this.auth,e,y(t))}static credential(e,t){return ji._fromVerification(e,t)}static credentialFromResult(t){let n=t;return e.credentialFromTaggedObject(n)}static credentialFromError(t){return e.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?ji._fromTokenResponse(t,n):null}};Ka.PROVIDER_ID=`phone`,Ka.PHONE_SIGN_IN_METHOD=`phone`;function qa(e,t){return t?Tr(t):(E(e._popupRedirectResolver,e,`argument-error`),e._popupRedirectResolver)}var Ja=class extends _i{constructor(e){super(`custom`,`custom`),this.params=e}_getIdTokenResponse(e){return Ci(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ci(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ci(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function Ya(e){return Ji(e.auth,new Ja(e),e.bypassAuthState)}function Xa(e){let{auth:t,user:n}=e;return E(n,t,`internal-error`),qi(n,new Ja(e),e.bypassAuthState)}async function Za(e){let{auth:t,user:n}=e;return E(n,t,`internal-error`),Ki(n,new Ja(e),e.bypassAuthState)}var Qa=class{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:a,type:o}=e;if(a){this.reject(a);return}let s={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(s))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case`signInViaPopup`:case`signInViaRedirect`:return Ya;case`linkViaPopup`:case`linkViaRedirect`:return Za;case`reauthViaPopup`:case`reauthViaRedirect`:return Xa;default:T(this.auth,`internal-error`)}}resolve(e){Rn(this.pendingPromise,`Pending promise was never set`),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rn(this.pendingPromise,`Pending promise was never set`),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}},$a=new Wn(2e3,1e4);async function eo(e,t,n){if(C(e.app))return Promise.reject(Mn(e,`operation-not-supported-in-this-environment`));let r=Jr(e);return Fn(e,t,Ii),new to(r,`signInViaPopup`,t,qa(r,n)).executeNotNull()}var to=class e extends Qa{constructor(t,n,r,i,a){super(t,n,i,a),this.provider=r,this.authWindow=null,this.pollId=null,e.currentPopupAction&&e.currentPopupAction.cancel(),e.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return E(e,this.auth,`internal-error`),e}async onExecution(){Rn(this.filter.length===1,`Popup operations only handle one event`);let e=_a();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Mn(this.auth,`web-storage-unsupported`))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Mn(this.auth,`cancelled-popup-request`))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Mn(this.auth,`popup-closed-by-user`))},8e3);return}this.pollId=window.setTimeout(e,$a.get())};e()}};to.currentPopupAction=null;var no=`pendingRedirect`,ro=new Map,io=class extends Qa{constructor(e,t,n=!1){super(e,[`signInViaRedirect`,`linkViaRedirect`,`reauthViaRedirect`,`unknown`],t,void 0,n),this.eventId=null}async execute(){let e=ro.get(this.auth._key());if(!e){try{let t=await ao(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ro.set(this.auth._key(),e)}return this.bypassAuthState||ro.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type===`signInViaRedirect`)return super.onAuthEvent(e);if(e.type===`unknown`){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function ao(e,t){let n=co(t),r=so(e);if(!await r._isAvailable())return!1;let i=await r._get(n)===`true`;return await r._remove(n),i}function oo(e,t){ro.set(e._key(),t)}function so(e){return Tr(e._redirectPersistence)}function co(e){return Or(no,e.config.apiKey,e.name)}async function lo(e,t,n=!1){if(C(e.app))return Promise.reject(Pn(e));let r=Jr(e),i=await new io(r,qa(r,t),n).execute();return i&&!n&&(delete i.user._redirectEventId,await r._persistUserIfCurrent(i.user),await r._setRedirectUser(null,t)),i}var uo=600*1e3,fo=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ho(e)?t:(this.hasHandledPotentialRedirect=!0,t||=(this.queuedRedirectEvent=e,!0),t)}sendToConsumer(e,t){if(e.error&&!mo(e)){let n=e.error.code?.split(`auth/`)[1]||`internal-error`;t.onError(Mn(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=uo&&this.cachedEventUids.clear(),this.cachedEventUids.has(po(e))}saveEventToCache(e){this.cachedEventUids.add(po(e)),this.lastProcessedEventTime=Date.now()}};function po(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join(`-`)}function mo({type:e,error:t}){return e===`unknown`&&t?.code===`auth/no-auth-event`}function ho(e){switch(e.type){case`signInViaRedirect`:case`linkViaRedirect`:case`reauthViaRedirect`:return!0;case`unknown`:return mo(e);default:return!1}}async function go(e,t={}){return O(e,`GET`,`/v1/projects`,t)}var _o=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vo=/^https?/;async function yo(e){if(e.config.emulator)return;let{authorizedDomains:t}=await go(e);for(let e of t)try{if(bo(e))return}catch{}T(e,`unauthorized-domain`)}function bo(e){let t=zn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith(`chrome-extension://`)){let i=new URL(e);return i.hostname===``&&r===``?n===`chrome-extension:`&&e.replace(`chrome-extension://`,``)===t.replace(`chrome-extension://`,``):n===`chrome-extension:`&&i.hostname===r}if(!vo.test(n))return!1;if(_o.test(e))return r===e;let i=e.replace(/\./g,`\\.`);return RegExp(`^(.+\\.`+i+`|`+i+`)$`,`i`).test(r)}var xo=new Wn(3e4,6e4);function So(){let e=ya().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}function Co(e){return new Promise((t,n)=>{function r(){So(),gapi.load(`gapi.iframes`,{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{So(),n(Mn(e,`network-request-failed`))},timeout:xo.get()})}if(ya().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(ya().gapi?.load)r();else{let t=ti(`iframefcb`);return ya()[t]=()=>{gapi.load?r():n(Mn(e,`network-request-failed`))},Qr(`${ei()}?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw wo=null,e})}var wo=null;function To(e){return wo||=Co(e),wo}var Eo=new Wn(5e3,15e3),Do=`__/auth/iframe`,Oo=`emulator/auth/iframe`,ko={style:{position:`absolute`,top:`-100px`,width:`1px`,height:`1px`},"aria-hidden":`true`,tabindex:`-1`},Ao=new Map([[`identitytoolkit.googleapis.com`,`p`],[`staging-identitytoolkit.sandbox.googleapis.com`,`s`],[`test-identitytoolkit.sandbox.googleapis.com`,`t`]]);function jo(e){let t=e.config;E(t.authDomain,e,`auth-domain-config-required`);let n=t.emulator?Gn(t,Oo):`https://${e.config.authDomain}/${Do}`,r={apiKey:t.apiKey,appName:e.name,v:on},i=Ao.get(e.config.apiHost);i&&(r.eid=i);let a=e._getFrameworks();return a.length&&(r.fw=a.join(`,`)),`${n}?${De(r).slice(1)}`}async function Mo(e){let t=await To(e),n=ya().gapi;return E(n,e,`internal-error`),t.open({where:document.body,url:jo(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ko,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=Mn(e,`network-request-failed`),a=ya().setTimeout(()=>{r(i)},Eo.get());function o(){ya().clearTimeout(a),n(t)}t.ping(o).then(o,()=>{r(i)})}))}var No={location:`yes`,resizable:`yes`,statusbar:`yes`,toolbar:`no`},Po=500,Fo=600,Io=`_blank`,Lo=`http://localhost`,Ro=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function zo(e,t,n,r=Po,i=Fo){let a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),s=``,c={...No,width:r.toString(),height:i.toString(),top:a,left:o},l=g().toLowerCase();n&&(s=Nr(l)?Io:n),jr(l)&&(t||=Lo,c.scrollbars=`yes`);let u=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,``);if(zr(l)&&s!==`_self`)return Bo(t||``,s),new Ro(null);let d=window.open(t||``,s,u);E(d,e,`popup-blocked`);try{d.focus()}catch{}return new Ro(d)}function Bo(e,t){let n=document.createElement(`a`);n.href=e,n.target=t;let r=document.createEvent(`MouseEvent`);r.initMouseEvent(`click`,!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}var Vo=`__/auth/handler`,Ho=`emulator/auth/handler`,Uo=`fac`;async function Wo(e,t,n,r,i,a){E(e.config.authDomain,e,`auth-domain-config-required`),E(e.config.apiKey,e,`invalid-api-key`);let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:on,eventId:i};if(t instanceof Ii){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||``,we(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(let[e,t]of Object.entries(a||{}))o[e]=t}if(t instanceof Li){let e=t.getScopes().filter(e=>e!==``);e.length>0&&(o.scopes=e.join(`,`))}e.tenantId&&(o.tid=e.tenantId);let s=o;for(let e of Object.keys(s))s[e]===void 0&&delete s[e];let c=await e._getAppCheckToken(),l=c?`#${Uo}=${encodeURIComponent(c)}`:``;return`${Go(e)}?${De(s).slice(1)}${l}`}function Go({config:e}){return e.emulator?Gn(e,Ho):`https://${e.authDomain}/${Vo}`}var Ko=`webStorageSupport`,qo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ma,this._completeRedirectFn=lo,this._overrideRedirectResult=oo}async _openPopup(e,t,n,r){return Rn(this.eventManagers[e._key()]?.manager,`_initialize() not called before _openPopup()`),zo(e,await Wo(e,t,n,zn(),r),_a())}async _openRedirect(e,t,n,r){return await this._originValidation(e),ba(await Wo(e,t,n,zn(),r)),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Rn(n,`If manager is not set, promise should be`),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await Mo(e),n=new fo(e);return t.register(`authEvent`,t=>(E(t?.authEvent,e,`invalid-auth-event`),{status:n.onEvent(t.authEvent)?`ACK`:`ERROR`}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ko,{type:Ko},n=>{let r=n?.[0]?.[Ko];r!==void 0&&t(!!r),T(e,`internal-error`)},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vr()||Mr()||Rr()}},Jo=class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case`enroll`:return this._finalizeEnroll(e,t.credential,n);case`signin`:return this._finalizeSignIn(e,t.credential);default:return Ln(`unexpected MultiFactorSessionType`)}}},Yo=class e extends Jo{constructor(e){super(`phone`),this.credential=e}static _fromCredential(t){return new e(t)}_finalizeEnroll(e,t,n){return ea(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return Va(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},Xo=class{constructor(){}static assertion(e){return Yo._fromCredential(e)}};Xo.FACTOR_ID=`phone`;var Zo=class{static assertionForEnrollment(e,t){return Qo._fromSecret(e,t)}static assertionForSignIn(e,t){return Qo._fromEnrollmentId(e,t)}static async generateSecret(e){let t=e;E(t.user?.auth!==void 0,`internal-error`);let n=await ta(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return $o._fromStartTotpMfaEnrollmentResponse(n,t.user.auth)}};Zo.FACTOR_ID=`totp`;var Qo=class e extends Jo{constructor(e,t,n){super(`totp`),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(t,n){return new e(n,void 0,t)}static _fromEnrollmentId(t,n){return new e(n,t)}async _finalizeEnroll(e,t,n){return E(this.secret!==void 0,e,`argument-error`),na(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){E(this.enrollmentId!==void 0&&this.otp!==void 0,e,`argument-error`);let n={verificationCode:this.otp};return Ha(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n})}},$o=class e{constructor(e,t,n,r,i,a,o){this.sessionInfo=a,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=r,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(t,n){return new e(t.totpSessionInfo.sharedSecretKey,t.totpSessionInfo.hashingAlgorithm,t.totpSessionInfo.verificationCodeLength,t.totpSessionInfo.periodSec,new Date(t.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),t.totpSessionInfo.sessionInfo,n)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let n=!1;return(es(e)||es(t))&&(n=!0),n&&(es(e)&&(e=this.auth.currentUser?.email||`unknownuser`),es(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}};function es(e){return e===void 0||e?.length===0}var ts=`@firebase/auth`,ns=`1.12.0`,rs=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){E(this.auth._initializationPromise,`dependent-sdk-initialized-before-auth`)}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function is(e){switch(e){case`Node`:return`node`;case`ReactNative`:return`rn`;case`Worker`:return`webworker`;case`Cordova`:return`cordova`;case`WebExtension`:return`web-extension`;default:return}}function as(e){tn(new Re(`auth`,(t,{options:n})=>{let r=t.getProvider(`app`).getImmediate(),i=t.getProvider(`heartbeat`),a=t.getProvider(`app-check-internal`),{apiKey:o,authDomain:s}=r.options;E(o&&!o.includes(`:`),`invalid-api-key`,{appName:r.name});let c=new qr(r,i,a,{apiKey:o,authDomain:s,clientPlatform:e,apiHost:`identitytoolkit.googleapis.com`,tokenApiHost:`securetoken.googleapis.com`,apiScheme:`https`,sdkClientVersion:Hr(e)});return di(c,n),c},`PUBLIC`).setInstantiationMode(`EXPLICIT`).setInstanceCreatedCallback((e,t,n)=>{e.getProvider(`auth-internal`).initialize()})),tn(new Re(`auth-internal`,e=>(e=>new rs(e))(Jr(e.getProvider(`auth`).getImmediate())),`PRIVATE`).setInstantiationMode(`EXPLICIT`)),ln(ts,ns,is(e)),ln(ts,ns,`esm2020`)}var os=h(`authIdTokenMaxAge`)||300,ss=null,cs=e=>async t=>{let n=t&&await t.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>os)return;let i=n?.token;ss!==i&&(ss=i,await fetch(e,{method:i?`POST`:`DELETE`,headers:i?{Authorization:`Bearer ${i}`}:{}}))};function ls(e=cn()){let t=nn(e,`auth`);if(t.isInitialized())return t.getImmediate();let n=ui(e,{popupRedirectResolver:qo,persistence:[za,ca,ma]}),r=h(`authTokenSyncURL`);if(r&&typeof isSecureContext==`boolean`&&isSecureContext){let e=new URL(r,location.origin);if(location.origin===e.origin){let t=cs(e.toString());Xi(n,t,()=>t(n.currentUser)),Yi(n,e=>t(e))}}let i=p(`auth`);return i&&fi(n,`http://${i}`),n}function us(){return document.getElementsByTagName(`head`)?.[0]??document}Zr({loadJS(e){return new Promise((t,n)=>{let r=document.createElement(`script`);r.setAttribute(`src`,e),r.onload=t,r.onerror=e=>{let t=Mn(`internal-error`);t.customData=e,n(t)},r.type=`text/javascript`,r.charset=`UTF-8`,us().appendChild(r)})},gapiScript:`https://apis.google.com/js/api.js`,recaptchaV2Script:`https://www.google.com/recaptcha/api.js`,recaptchaEnterpriseScript:`https://www.google.com/recaptcha/enterprise.js?render=`}),as(`Browser`);var ds=`@firebase/installations`,fs=`0.6.19`,ps=1e4,ms=`w:${fs}`,hs=`FIS_v2`,gs=`https://firebaseinstallations.googleapis.com/v1`,_s=3600*1e3,vs=new xe(`installations`,`Installations`,{"missing-app-config-values":`Missing App configuration value: "{$valueName}"`,"not-registered":`Firebase Installation is not registered.`,"installation-not-found":`Firebase Installation not found.`,"request-failed":`{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"`,"app-offline":`Could not process request. Application offline.`,"delete-pending-registration":`Can't delete installation while there is a pending registration request.`});function ys(e){return e instanceof be&&e.code.includes(`request-failed`)}function bs({projectId:e}){return`${gs}/projects/${e}/installations`}function xs(e){return{token:e.token,requestStatus:2,expiresIn:Es(e.expiresIn),creationTime:Date.now()}}async function Ss(e,t){let n=(await t.json()).error;return vs.create(`request-failed`,{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Cs({apiKey:e}){return new Headers({"Content-Type":`application/json`,Accept:`application/json`,"x-goog-api-key":e})}function ws(e,{refreshToken:t}){let n=Cs(e);return n.append(`Authorization`,Ds(t)),n}async function Ts(e){let t=await e();return t.status>=500&&t.status<600?e():t}function Es(e){return Number(e.replace(`s`,`000`))}function Ds(e){return`${hs} ${e}`}async function Os({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let r=bs(e),i=Cs(e),a=t.getImmediate({optional:!0});if(a){let e=await a.getHeartbeatsHeader();e&&i.append(`x-firebase-client`,e)}let o={fid:n,authVersion:hs,appId:e.appId,sdkVersion:ms},s={method:`POST`,headers:i,body:JSON.stringify(o)},c=await Ts(()=>fetch(r,s));if(c.ok){let e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:xs(e.authToken)}}else throw await Ss(`Create Installation`,c)}function ks(e){return new Promise(t=>{setTimeout(t,e)})}function As(e){return btoa(String.fromCharCode(...e)).replace(/\+/g,`-`).replace(/\//g,`_`)}var js=/^[cdef][\w-]{21}$/,Ms=``;function Ns(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=Ps(e);return js.test(t)?t:Ms}catch{return Ms}}function Ps(e){return As(e).substr(0,22)}function Fs(e){return`${e.appName}!${e.appId}`}var Is=new Map;function Ls(e,t){let n=Fs(e);Rs(n,t),zs(n,t)}function Rs(e,t){let n=Is.get(e);if(n)for(let e of n)e(t)}function zs(e,t){let n=Vs();n&&n.postMessage({key:e,fid:t}),Hs()}var Bs=null;function Vs(){return!Bs&&`BroadcastChannel`in self&&(Bs=new BroadcastChannel(`[Firebase] FID Change`),Bs.onmessage=e=>{Rs(e.data.key,e.data.fid)}),Bs}function Hs(){Is.size===0&&Bs&&(Bs.close(),Bs=null)}var Us=`firebase-installations-database`,Ws=1,Gs=`firebase-installations-store`,Ks=null;function qs(){return Ks||=pt(Us,Ws,{upgrade:(e,t)=>{switch(t){case 0:e.createObjectStore(Gs)}}}),Ks}async function Js(e,t){let n=Fs(e),r=(await qs()).transaction(Gs,`readwrite`),i=r.objectStore(Gs),a=await i.get(n);return await i.put(t,n),await r.done,(!a||a.fid!==t.fid)&&Ls(e,t.fid),t}async function Ys(e){let t=Fs(e),n=(await qs()).transaction(Gs,`readwrite`);await n.objectStore(Gs).delete(t),await n.done}async function Xs(e,t){let n=Fs(e),r=(await qs()).transaction(Gs,`readwrite`),i=r.objectStore(Gs),a=await i.get(n),o=t(a);return o===void 0?await i.delete(n):await i.put(o,n),await r.done,o&&(!a||a.fid!==o.fid)&&Ls(e,o.fid),o}async function Zs(e){let t,n=await Xs(e.appConfig,n=>{let r=$s(e,Qs(n));return t=r.registrationPromise,r.installationEntry});return n.fid===Ms?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}function Qs(e){return rc(e||{fid:Ns(),registrationStatus:0})}function $s(e,t){if(t.registrationStatus===0){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(vs.create(`app-offline`))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:ec(e,n)}}else if(t.registrationStatus===1)return{installationEntry:t,registrationPromise:tc(e)};else return{installationEntry:t}}async function ec(e,t){try{let n=await Os(e,t);return Js(e.appConfig,n)}catch(n){throw ys(n)&&n.customData.serverCode===409?await Ys(e.appConfig):await Js(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function tc(e){let t=await nc(e.appConfig);for(;t.registrationStatus===1;)await ks(100),t=await nc(e.appConfig);if(t.registrationStatus===0){let{installationEntry:t,registrationPromise:n}=await Zs(e);return n||t}return t}function nc(e){return Xs(e,e=>{if(!e)throw vs.create(`installation-not-found`);return rc(e)})}function rc(e){return ic(e)?{fid:e.fid,registrationStatus:0}:e}function ic(e){return e.registrationStatus===1&&e.registrationTime+ps<Date.now()}async function ac({appConfig:e,heartbeatServiceProvider:t},n){let r=oc(e,n),i=ws(e,n),a=t.getImmediate({optional:!0});if(a){let e=await a.getHeartbeatsHeader();e&&i.append(`x-firebase-client`,e)}let o={installation:{sdkVersion:ms,appId:e.appId}},s={method:`POST`,headers:i,body:JSON.stringify(o)},c=await Ts(()=>fetch(r,s));if(c.ok)return xs(await c.json());throw await Ss(`Generate Auth Token`,c)}function oc(e,{fid:t}){return`${bs(e)}/${t}/authTokens:generate`}async function sc(e,t=!1){let n,r=await Xs(e.appConfig,r=>{if(!dc(r))throw vs.create(`not-registered`);let i=r.authToken;if(!t&&fc(i))return r;if(i.requestStatus===1)return n=cc(e,t),r;{if(!navigator.onLine)throw vs.create(`app-offline`);let t=mc(r);return n=uc(e,t),t}});return n?await n:r.authToken}async function cc(e,t){let n=await lc(e.appConfig);for(;n.authToken.requestStatus===1;)await ks(100),n=await lc(e.appConfig);let r=n.authToken;return r.requestStatus===0?sc(e,t):r}function lc(e){return Xs(e,e=>{if(!dc(e))throw vs.create(`not-registered`);let t=e.authToken;return hc(t)?{...e,authToken:{requestStatus:0}}:e})}async function uc(e,t){try{let n=await ac(e,t),r={...t,authToken:n};return await Js(e.appConfig,r),n}catch(n){if(ys(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Ys(e.appConfig);else{let n={...t,authToken:{requestStatus:0}};await Js(e.appConfig,n)}throw n}}function dc(e){return e!==void 0&&e.registrationStatus===2}function fc(e){return e.requestStatus===2&&!pc(e)}function pc(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+_s}function mc(e){let t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}function hc(e){return e.requestStatus===1&&e.requestTime+ps<Date.now()}async function gc(e){let t=e,{installationEntry:n,registrationPromise:r}=await Zs(t);return r?r.catch(console.error):sc(t).catch(console.error),n.fid}async function _c(e,t=!1){let n=e;return await vc(n),(await sc(n,t)).token}async function vc(e){let{registrationPromise:t}=await Zs(e);t&&await t}function yc(e){if(!e||!e.options)throw bc(`App Configuration`);if(!e.name)throw bc(`App Name`);for(let t of[`projectId`,`apiKey`,`appId`])if(!e.options[t])throw bc(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function bc(e){return vs.create(`missing-app-config-values`,{valueName:e})}var xc=`installations`,Sc=`installations-internal`,Cc=e=>{let t=e.getProvider(`app`).getImmediate();return{app:t,appConfig:yc(t),heartbeatServiceProvider:nn(t,`heartbeat`),_delete:()=>Promise.resolve()}},wc=e=>{let t=nn(e.getProvider(`app`).getImmediate(),xc).getImmediate();return{getId:()=>gc(t),getToken:e=>_c(t,e)}};function Tc(){tn(new Re(xc,Cc,`PUBLIC`)),tn(new Re(Sc,wc,`PRIVATE`))}Tc(),ln(ds,fs),ln(ds,fs,`esm2020`);var Ec=`analytics`,Dc=`firebase_id`,Oc=`origin`,kc=60*1e3,Ac=`https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig`,jc=`https://www.googletagmanager.com/gtag/js`,A=new Ye(`@firebase/analytics`),Mc=new xe(`analytics`,`Analytics`,{"already-exists":`A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.`,"already-initialized":`initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.`,"already-initialized-settings":`Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.`,"interop-component-reg-failed":`Firebase Analytics Interop Component failed to instantiate: {$reason}`,"invalid-analytics-context":`Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}`,"indexeddb-unavailable":`IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}`,"fetch-throttle":`The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.`,"config-fetch-failed":`Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}`,"no-api-key":`The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.`,"no-app-id":`The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.`,"no-client-id":`The "client_id" field is empty.`,"invalid-gtag-resource":`Trusted Types detected an invalid gtag resource: {$gtagURL}.`});function Nc(e){if(!e.startsWith(jc)){let t=Mc.create(`invalid-gtag-resource`,{gtagURL:e});return A.warn(t.message),``}return e}function Pc(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Fc(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}function Ic(e,t){let n=Fc(`firebase-js-sdk-policy`,{createScriptURL:Nc}),r=document.createElement(`script`),i=`${jc}?l=${e}&id=${t}`;r.src=n?n?.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function Lc(e){let t=[];return Array.isArray(window[e])?t=window[e]:window[e]=t,t}async function Rc(e,t,n,r,i,a){let o=r[i];try{if(o)await t[o];else{let e=(await Pc(n)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){A.error(e)}e(`config`,i,a)}async function zc(e,t,n,r,i){try{let a=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let r=await Pc(n);for(let n of e){let e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(i)a.push(i);else{a=[];break}}}a.length===0&&(a=Object.values(t)),await Promise.all(a),e(`event`,r,i||{})}catch(e){A.error(e)}}function Bc(e,t,n,r){async function i(i,...a){try{if(i===`event`){let[r,i]=a;await zc(e,t,n,r,i)}else if(i===`config`){let[i,o]=a;await Rc(e,t,n,r,i,o)}else if(i===`consent`){let[t,n]=a;e(`consent`,t,n)}else if(i===`get`){let[t,n,r]=a;e(`get`,t,n,r)}else if(i===`set`){let[t]=a;e(`set`,t)}else e(i,...a)}catch(e){A.error(e)}}return i}function Vc(e,t,n,r,i){let a=function(...e){window[r].push(arguments)};return window[i]&&typeof window[i]==`function`&&(a=window[i]),window[i]=Bc(a,e,t,n),{gtagCore:a,wrappedGtag:window[i]}}function Hc(e){let t=window.document.getElementsByTagName(`script`);for(let n of Object.values(t))if(n.src&&n.src.includes(jc)&&n.src.includes(e))return n;return null}var Uc=30,Wc=1e3,Gc=new class{constructor(e={},t=Wc){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Kc(e){return new Headers({Accept:`application/json`,"x-goog-api-key":e})}async function qc(e){let{appId:t,apiKey:n}=e,r={method:`GET`,headers:Kc(n)},i=Ac.replace(`{app-id}`,t),a=await fetch(i,r);if(a.status!==200&&a.status!==304){let e=``;try{let t=await a.json();t.error?.message&&(e=t.error.message)}catch{}throw Mc.create(`config-fetch-failed`,{httpStatus:a.status,responseMessage:e})}return a.json()}async function Jc(e,t=Gc,n){let{appId:r,apiKey:i,measurementId:a}=e.options;if(!r)throw Mc.create(`no-app-id`);if(!i){if(a)return{measurementId:a,appId:r};throw Mc.create(`no-api-key`)}let o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new Qc;return setTimeout(async()=>{s.abort()},n===void 0?kc:n),Yc({appId:r,apiKey:i,measurementId:a},o,s,t)}async function Yc(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Gc){let{appId:a,measurementId:o}=e;try{await Xc(r,t)}catch(e){if(o)return A.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:a,measurementId:o};throw e}try{let t=await qc(e);return i.deleteThrottleMetadata(a),t}catch(t){let s=t;if(!Zc(s)){if(i.deleteThrottleMetadata(a),o)return A.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${s?.message}]`),{appId:a,measurementId:o};throw t}let c=Number(s?.customData?.httpStatus)===503?v(n,i.intervalMillis,Uc):v(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return i.setThrottleMetadata(a,l),A.debug(`Calling attemptFetch again in ${c} millis`),Yc(e,l,r,i)}}function Xc(e,t){return new Promise((n,r)=>{let i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(a),r(Mc.create(`fetch-throttle`,{throttleEndTimeMillis:t}))})})}function Zc(e){if(!(e instanceof be)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return t===429||t===500||t===503||t===504}var Qc=class{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}},$c;async function el(e,t,n,r,i){if(i&&i.global){e(`event`,n,r);return}else{let i=await t;e(`event`,n,{...r,send_to:i})}}async function tl(e,t,n,r){if(r&&r.global){let t={};for(let e of Object.keys(n))t[`user_properties.${e}`]=n[e];return e(`set`,t),Promise.resolve()}else e(`config`,await t,{update:!0,user_properties:n})}var nl;function rl(e){nl=e}function il(e){$c=e}async function al(){if(ge())try{await _e()}catch(e){return A.warn(Mc.create(`indexeddb-unavailable`,{errorInfo:e?.toString()}).message),!1}else return A.warn(Mc.create(`indexeddb-unavailable`,{errorInfo:`IndexedDB is not available in this environment.`}).message),!1;return!0}async function ol(e,t,n,r,i,a,o){let s=Jc(e);s.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&A.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>A.error(e)),t.push(s);let c=al().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([s,c]);Hc(a)||Ic(a,l.measurementId),nl&&(i(`consent`,`default`,nl),rl(void 0)),i(`js`,new Date);let d=o?.config??{};return d[Oc]=`firebase`,d.update=!0,u!=null&&(d[Dc]=u),i(`config`,l.measurementId,d),$c&&(i(`set`,$c),il(void 0)),l.measurementId}var sl=class{constructor(e){this.app=e}_delete(){return delete cl[this.app.options.appId],Promise.resolve()}},cl={},ll=[],ul={},dl=`dataLayer`,fl=`gtag`,pl,ml,hl=!1;function gl(){let e=[];if(fe()&&e.push(`This is a browser extension environment.`),ve()||e.push(`Cookies are not available.`),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(` `),n=Mc.create(`invalid-analytics-context`,{errorInfo:t});A.warn(n.message)}}function _l(e,t,n){gl();let r=e.options.appId;if(!r)throw Mc.create(`no-app-id`);if(!e.options.apiKey)if(e.options.measurementId)A.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Mc.create(`no-api-key`);if(cl[r]!=null)throw Mc.create(`already-exists`,{id:r});if(!hl){Lc(dl);let{wrappedGtag:e,gtagCore:t}=Vc(cl,ll,ul,dl,fl);ml=e,pl=t,hl=!0}return cl[r]=ol(e,ll,ul,t,pl,dl,n),new sl(e)}function vl(e=cn()){e=y(e);let t=nn(e,Ec);return t.isInitialized()?t.getImmediate():yl(e)}function yl(e,t={}){let n=nn(e,Ec);if(n.isInitialized()){let e=n.getImmediate();if(Te(t,n.getOptions()))return e;throw Mc.create(`already-initialized`)}return n.initialize({options:t})}function bl(e,t,n){e=y(e),tl(ml,cl[e.app.options.appId],t,n).catch(e=>A.error(e))}function xl(e,t,n,r){e=y(e),el(ml,cl[e.app.options.appId],t,n,r).catch(e=>A.error(e))}var Sl=`@firebase/analytics`,Cl=`0.10.19`;function wl(){tn(new Re(Ec,(e,{options:t})=>_l(e.getProvider(`app`).getImmediate(),e.getProvider(`installations-internal`).getImmediate(),t),`PUBLIC`)),tn(new Re(`analytics-internal`,e,`PRIVATE`)),ln(Sl,Cl),ln(Sl,Cl,`esm2020`);function e(e){try{let t=e.getProvider(Ec).getImmediate();return{logEvent:(e,n,r)=>xl(t,e,n,r),setUserProperties:(e,n)=>bl(t,e,n)}}catch(e){throw Mc.create(`interop-component-reg-failed`,{reason:e})}}}wl();var Tl=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{},El={},Dl,Ol;(function(){var e;function t(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(e,t,n){n||=0;let r=Array(16);if(typeof t==`string`)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let a=e.g[3],o;o=t+(a^n&(i^a))+r[0]+3614090360&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[1]+3905402710&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[2]+606105819&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[5]+1200080426&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[6]+2821735955&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[9]+2336552879&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[10]+4294925233&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(a^n&(i^a))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=a+(i^t&(n^i))+r[13]+4254626195&4294967295,a=t+(o<<12&4294967295|o>>>20),o=i+(n^a&(t^n))+r[14]+2792965006&4294967295,i=a+(o<<17&4294967295|o>>>15),o=n+(t^i&(a^t))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=t+(i^a&(n^i))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[6]+3225465664&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[11]+643717713&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[10]+38016083&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[15]+3634488961&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[14]+3275163606&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[3]+4107603335&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(i^a&(n^i))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=a+(n^i&(t^n))+r[2]+4243563512&4294967295,a=t+(o<<9&4294967295|o>>>23),o=i+(t^n&(a^t))+r[7]+1735328473&4294967295,i=a+(o<<14&4294967295|o>>>18),o=n+(a^t&(i^a))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=t+(n^i^a)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[8]+2272392833&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[11]+1839030562&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[4]+1272893353&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[7]+4139469664&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[0]+3936430074&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[3]+3572445317&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(n^i^a)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=a+(t^n^i)+r[12]+3873151461&4294967295,a=t+(o<<11&4294967295|o>>>21),o=i+(a^t^n)+r[15]+530742520&4294967295,i=a+(o<<16&4294967295|o>>>16),o=n+(i^a^t)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=t+(i^(n|~a))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[7]+1126891415&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[14]+2878612391&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[3]+2399980690&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[10]+4293915773&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[15]+4264355552&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[6]+2734768916&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=t+(i^(n|~a))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=a+(n^(t|~i))+r[11]+3174756917&4294967295,a=t+(o<<10&4294967295|o>>>22),o=i+(t^(a|~n))+r[2]+718787259&4294967295,i=a+(o<<15&4294967295|o>>>17),o=n+(a^(i|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}r.prototype.v=function(e,t){t===void 0&&(t=e.length);let n=t-this.blockSize,r=this.C,a=this.h,o=0;for(;o<t;){if(a==0)for(;o<=n;)i(this,e,o),o+=this.blockSize;if(typeof e==`string`){for(;o<t;)if(r[a++]=e.charCodeAt(o++),a==this.blockSize){i(this,r),a=0;break}}else for(;o<t;)if(r[a++]=e[o++],a==this.blockSize){i(this,r),a=0;break}}this.h=a,this.o+=t},r.prototype.A=function(){var e=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=this.o*8;for(var n=e.length-8;n<e.length;++n)e[n]=t&255,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};function a(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}function o(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let a=e[i]|0;r&&a==t||(n[i]=a,r=!1)}this.g=n}var s={};function c(e){return-128<=e&&e<128?a(e,function(e){return new o([e|0],e<0?-1:0)}):new o([e|0],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return d;if(e<0)return h(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new o(t,0)}function u(e,t){if(e.length==0)throw Error(`number format error: empty string`);if(t||=10,t<2||36<t)throw Error(`radix out of range: `+t);if(e.charAt(0)==`-`)return h(u(e.substring(1),t));if(e.indexOf(`-`)>=0)throw Error(`number format error: interior "-" character`);let n=l(t**8),r=d;for(let a=0;a<e.length;a+=8){var i=Math.min(8,e.length-a);let o=parseInt(e.substring(a,a+i),t);i<8?(i=l(t**+i),r=r.j(i).add(l(o))):(r=r.j(n),r=r.add(l(o)))}return r}var d=c(0),f=c(1),p=c(16777216);e=o.prototype,e.m=function(){if(m(this))return-h(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(e||=10,e<2||36<e)throw Error(`radix out of range: `+e);if(ee(this))return`0`;if(m(this))return`-`+h(this).toString(e);let t=l(e**6);var n=this;let r=``;for(;;){let i=ie(n,t).g;n=te(n,i.j(t));let a=((n.g.length>0?n.g[0]:n.h)>>>0).toString(e);if(n=i,ee(n))return a+r;for(;a.length<6;)a=`0`+a;r=a+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h};function ee(e){if(e.h!=0)return!1;for(let t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function m(e){return e.h==-1}e.l=function(e){return e=te(this,e),m(e)?-1:ee(e)?0:1};function h(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new o(n,~e.h).add(f)}e.abs=function(){return m(this)?h(this):this},e.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(this.i(i)&65535)+(e.i(i)&65535),a=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=a>>>16,t&=65535,a&=65535,n[i]=a<<16|t}return new o(n,n[n.length-1]&-2147483648?-1:0)};function te(e,t){return e.add(h(t))}e.j=function(e){if(ee(this)||ee(e))return d;if(m(this))return m(e)?h(this).j(h(e)):h(h(this).j(e));if(m(e))return h(this.j(h(e)));if(this.l(p)<0&&e.l(p)<0)return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,a=this.i(r)&65535,o=e.i(t)>>>16,s=e.i(t)&65535;n[2*r+2*t]+=a*s,ne(n,2*r+2*t),n[2*r+2*t+1]+=i*s,ne(n,2*r+2*t+1),n[2*r+2*t+1]+=a*o,ne(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,ne(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new o(n,0)};function ne(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function re(e,t){this.g=e,this.h=t}function ie(e,t){if(ee(t))throw Error(`division by zero`);if(ee(e))return new re(d,d);if(m(e))return t=ie(h(e),t),new re(h(t.g),h(t.h));if(m(t))return t=ie(e,h(t)),new re(h(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error(`slowDivide_ only works with positive integers.`);for(var n=f,r=t;r.l(e)<=0;)n=ae(n),r=ae(r);var i=oe(n,1),a=oe(r,1);for(r=oe(r,2),n=oe(n,2);!ee(r);){var o=a.add(r);o.l(e)<=0&&(i=i.add(n),a=o),r=oe(r,1),n=oe(n,1)}return t=te(e,i.j(t)),new re(i,t)}for(i=d;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=Math.ceil(Math.log(n)/Math.LN2),r=r<=48?1:2**(r-48),a=l(n),o=a.j(t);m(o)||o.l(e)>0;)n-=r,a=l(n),o=a.j(t);ee(a)&&(a=f),i=i.add(a),e=te(e,o)}return new re(i,e)}e.B=function(e){return ie(this,e).h},e.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new o(n,this.h&e.h)},e.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new o(n,this.h|e.h)},e.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new o(n,this.h^e.h)};function ae(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new o(n,e.h)}function oe(e,t){let n=t>>5;t%=32;let r=e.g.length-n,i=[];for(let a=0;a<r;a++)i[a]=t>0?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new o(i,e.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Ol=El.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=u,Dl=El.Integer=o}).apply(Tl===void 0?typeof self<`u`?self:typeof window<`u`?window:{}:Tl);var kl=typeof globalThis<`u`?globalThis:typeof window<`u`?window:typeof global<`u`?global:typeof self<`u`?self:{},Al={},jl,Ml,Nl,Pl,Fl,Il,Ll,Rl;(function(){var e,t=Object.defineProperty;function n(e){e=[typeof globalThis==`object`&&globalThis,e,typeof window==`object`&&window,typeof self==`object`&&self,typeof kl==`object`&&kl];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error(`Cannot find global object`)}var r=n(this);function i(e,n){if(n)a:{var i=r;e=e.split(`.`);for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in i))break a;i=i[o]}e=e[e.length-1],a=i[e],n=n(a),n!=a&&n!=null&&t(i,e,{configurable:!0,writable:!0,value:n})}}i(`Symbol.dispose`,function(e){return e||Symbol(`Symbol.dispose`)}),i(`Array.prototype.values`,function(e){return e||function(){return this[Symbol.iterator]()}}),i(`Object.entries`,function(e){return e||function(e){var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push([n,e[n]]);return t}});var a=a||{},o=this||self;function s(e){var t=typeof e;return t==`object`&&e!=null||t==`function`}function c(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return l=c,l.apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}var f=typeof AsyncContext<`u`&&typeof AsyncContext.Snapshot==`function`?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function p(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function ee(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if(n=n==`object`?r?Array.isArray(r)?`array`:n:`null`:n,n==`array`||n==`object`&&typeof r.length==`number`){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}class m{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function h(e){o.setTimeout(()=>{throw e},0)}function te(){var e=se;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}class ne{constructor(){this.h=this.g=null}add(e,t){let n=re.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var re=new m(()=>new ie,e=>e.reset());class ie{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let ae,oe=!1,se=new ne,ce=()=>{let e=Promise.resolve(void 0);ae=()=>{e.then(le)}};function le(){for(var e;e=te();){try{e.h.call(e.g)}catch(e){h(e)}var t=re;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}oe=!1}function g(){this.u=this.u,this.C=this.C}g.prototype.u=!1,g.prototype.dispose=function(){this.u||(this.u=!0,this.N())},g.prototype[Symbol.dispose]=function(){this.dispose()},g.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var ue=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},`passive`,{get:function(){e=!0}});try{let e=()=>{};o.addEventListener(`test`,e,t),o.removeEventListener(`test`,e,t)}catch{}return e}();function de(e){return/^[\s\xa0]*$/.test(e)}function fe(e,t){_.call(this,e?e.type:``),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key=``,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType=``,this.i=null,e&&this.init(e,t)}d(fe,_),fe.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget,t||(n==`mouseover`?t=e.fromElement:n==`mouseout`&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=r.clientX===void 0?r.pageX:r.clientX,this.clientY=r.clientY===void 0?r.pageY:r.clientY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX===void 0?e.pageX:e.clientX,this.clientY=e.clientY===void 0?e.pageY:e.clientY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||``,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&fe.Z.h.call(this)},fe.prototype.h=function(){fe.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var pe=`closure_listenable_`+(Math.random()*1e6|0),me=0;function he(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++me,this.da=this.fa=!1}function ge(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function _e(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function ve(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function ye(e){let t={};for(let n in e)t[n]=e[n];return t}let be=`constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf`.split(` `);function xe(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<be.length;t++)n=be[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Se(e){this.src=e,this.g={},this.h=0}Se.prototype.add=function(e,t,n,r,i){let a=e.toString();e=this.g[a],e||(e=this.g[a]=[],this.h++);let o=we(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):(t=new he(t,this.src,a,!!r,i),t.fa=n,e.push(t)),t};function Ce(e,t){let n=t.type;if(n in e.g){var r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0),a;(a=i>=0)&&Array.prototype.splice.call(r,i,1),a&&(ge(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function we(e,t,n,r){for(let i=0;i<e.length;++i){let a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}var Te=`closure_lm_`+(Math.random()*1e6|0),Ee={};function De(e,t,n,r,i){if(r&&r.once)return Ae(e,t,n,r,i);if(Array.isArray(t)){for(let a=0;a<t.length;a++)De(e,t[a],n,r,i);return null}return n=Le(n),e&&e[pe]?e.J(t,n,s(r)?!!r.capture:!!r,i):Oe(e,t,n,!1,r,i)}function Oe(e,t,n,r,i,a){if(!t)throw Error(`Invalid event type`);let o=s(i)?!!i.capture:!!i,c=Fe(e);if(c||(e[Te]=c=new Se(e)),n=c.add(t,n,r,o,a),n.proxy)return n;if(r=ke(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ue||(i=o),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Ne(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error(`addEventListener and attachEvent are unavailable.`);return n}function ke(){function e(n){return t.call(e.src,e.listener,n)}let t=Pe;return e}function Ae(e,t,n,r,i){if(Array.isArray(t)){for(let a=0;a<t.length;a++)Ae(e,t[a],n,r,i);return null}return n=Le(n),e&&e[pe]?e.K(t,n,s(r)?!!r.capture:!!r,i):Oe(e,t,n,!0,r,i)}function je(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)je(e,t[a],n,r,i);else r=s(r)?!!r.capture:!!r,n=Le(n),e&&e[pe]?(e=e.i,a=String(t).toString(),a in e.g&&(t=e.g[a],n=we(t,n,r,i),n>-1&&(ge(t[n]),Array.prototype.splice.call(t,n,1),t.length==0&&(delete e.g[a],e.h--)))):(e&&=Fe(e))&&(t=e.g[t.toString()],e=-1,t&&(e=we(t,n,r,i)),(n=e>-1?t[e]:null)&&Me(n))}function Me(e){if(typeof e!=`number`&&e&&!e.da){var t=e.src;if(t&&t[pe])Ce(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ne(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Fe(t))?(Ce(n,e),n.h==0&&(n.src=null,t[Te]=null)):ge(e)}}}function Ne(e){return e in Ee?Ee[e]:Ee[e]=`on`+e}function Pe(e,t){if(e.da)e=!0;else{t=new fe(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Me(e),e=n.call(r,t)}return e}function Fe(e){return e=e[Te],e instanceof Se?e:null}var Ie=`__closure_events_fn_`+(Math.random()*1e9>>>0);function Le(e){return typeof e==`function`?e:(e[Ie]||(e[Ie]=function(t){return e.handleEvent(t)}),e[Ie])}function v(){g.call(this),this.i=new Se(this),this.M=this,this.G=null}d(v,g),v.prototype[pe]=!0,v.prototype.removeEventListener=function(e,t,n,r){je(this,e,t,n,r)};function y(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,typeof t==`string`)t=new _(t,e);else if(t instanceof _)t.target=t.target||e;else{var i=t;t=new _(r,e),xe(t,i)}i=!0;let a,o;if(n)for(o=n.length-1;o>=0;o--)a=t.g=n[o],i=Re(a,r,!0,t)&&i;if(a=t.g=e,i=Re(a,r,!0,t)&&i,i=Re(a,r,!1,t)&&i,n)for(o=0;o<n.length;o++)a=t.g=n[o],i=Re(a,r,!1,t)&&i}v.prototype.N=function(){if(v.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)ge(n[e]);delete e.g[t],e.h--}}this.G=null},v.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},v.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function Re(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();let i=!0;for(let a=0;a<t.length;++a){let o=t[a];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&Ce(e.i,o),i=t.call(n,r)!==!1&&i}}return i&&!r.defaultPrevented}function ze(e,t){if(typeof e!=`function`)if(e&&typeof e.handleEvent==`function`)e=l(e.handleEvent,e);else throw Error(`Invalid listener argument`);return Number(t)>2147483647?-1:o.setTimeout(e,t||0)}function Be(e){e.g=ze(()=>{e.g=null,e.i&&(e.i=!1,Be(e))},e.l);let t=e.h;e.h=null,e.m.apply(null,t)}class Ve extends g{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:Be(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function He(e){g.call(this),this.h=e,this.g={}}d(He,g);var Ue=[];function We(e){_e(e.g,function(e,t){this.g.hasOwnProperty(t)&&Me(e)},e),e.g={}}He.prototype.N=function(){He.Z.N.call(this),We(this)},He.prototype.handleEvent=function(){throw Error(`EventHandler.handleEvent not implemented`)};var b=o.JSON.stringify,Ge=o.JSON.parse,Ke=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function qe(){}function Je(){}var Ye={OPEN:`a`,hb:`b`,ERROR:`c`,tb:`d`};function Xe(){_.call(this,`d`)}d(Xe,_);function Ze(){_.call(this,`c`)}d(Ze,_);var Qe={},$e=null;function et(){return $e||=new v}Qe.Ia=`serverreachability`;function tt(e){_.call(this,Qe.Ia,e)}d(tt,_);function nt(e){let t=et();y(t,new tt(t))}Qe.STAT_EVENT=`statevent`;function rt(e,t){_.call(this,Qe.STAT_EVENT,e),this.stat=t}d(rt,_);function x(e){let t=et();y(t,new rt(t,e))}Qe.Ja=`timingevent`;function it(e,t){_.call(this,Qe.Ja,e),this.size=t}d(it,_);function at(e,t){if(typeof e!=`function`)throw Error(`Fn must not be null and must be a function`);return o.setTimeout(function(){e()},t)}function ot(){this.g=!0}ot.prototype.ua=function(){this.g=!1};function st(e,t,n,r,i,a){e.info(function(){if(e.g)if(a){var o=``,s=a.split(`&`);for(let e=0;e<s.length;e++){var c=s[e].split(`=`);if(c.length>1){let e=c[0];c=c[1];let t=e.split(`_`);o=t.length>=2&&t[1]==`type`?o+(e+`=`+c+`&`):o+(e+`=redacted&`)}}}else o=null;else o=a;return`XMLHTTP REQ (`+r+`) [attempt `+i+`]: `+t+`
`+n+`
`+o})}function ct(e,t,n,r,i,a,o){e.info(function(){return`XMLHTTP RESP (`+r+`) [ attempt `+i+`]: `+t+`
`+n+`
`+a+` `+o})}function lt(e,t,n,r){e.info(function(){return`XMLHTTP TEXT (`+t+`): `+dt(e,n)+(r?` `+r:``)})}function ut(e,t){e.info(function(){return`TIMEOUT: `+t})}ot.prototype.info=function(){};function dt(e,t){if(!e.g)return t;if(!t)return null;try{let a=JSON.parse(t);if(a){for(e=0;e<a.length;e++)if(Array.isArray(a[e])){var n=a[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if(i!=`noop`&&i!=`stop`&&i!=`close`)for(let e=1;e<r.length;e++)r[e]=``}}}}return b(a)}catch{return t}}var ft={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},pt={ib:`complete`,Fb:`success`,ERROR:`error`,Ga:`abort`,xb:`ready`,yb:`readystatechange`,TIMEOUT:`timeout`,sb:`incrementaldata`,wb:`progress`,lb:`downloadprogress`,Nb:`uploadprogress`},mt;function ht(){}d(ht,qe),ht.prototype.g=function(){return new XMLHttpRequest},mt=new ht;function gt(e){return encodeURIComponent(String(e))}function _t(e){var t=1;e=e.split(`:`);let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(`:`)),n}function vt(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new He(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new yt}function yt(){this.i=null,this.g=``,this.h=!1}var bt={},xt={};function St(e,t,n){e.M=1,e.A=Jt(Wt(t)),e.u=n,e.R=!0,Ct(e,null)}function Ct(e,t){e.F=Date.now(),Dt(e),e.B=Wt(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),cn(n.i,`t`,r),e.C=0,n=e.j.L,e.h=new yt,e.g=D(e.j,n?t:null,!e.u),e.P>0&&(e.O=new Ve(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var i=`readystatechange`;Array.isArray(i)||(i&&(Ue[0]=i.toString()),i=Ue);for(let e=0;e<i.length;e++){let a=De(n,i[e],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.J?ye(e.J):{},e.u?(e.v||=`POST`,t[`Content-Type`]=`application/x-www-form-urlencoded`,e.g.ea(e.B,e.v,e.u,t)):(e.v=`GET`,e.g.ea(e.B,e.v,null,t)),nt(),st(e.i,e.v,e.B,e.l,e.S,e.u)}vt.prototype.ba=function(e){e=e.target;let t=this.O;t&&kn(e)==3?t.j():this.Y(e)},vt.prototype.Y=function(e){try{if(e==this.g)a:{let s=kn(this.g),c=this.g.ya(),l=this.g.ca();if(!(s<3)&&(s!=3||this.g&&(this.h.h||this.g.la()||An(this.g)))){this.K||s!=4||c==7||nt(c==8||l<=0?3:2),kt(this);var t=this.g.ca();this.X=t;var n=wt(this);if(this.o=t==200,ct(this.i,this.v,this.B,this.l,this.S,s,t),this.o){if(this.U&&!this.L){b:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader(`X-HTTP-Initial-Response`):null)&&!de(r)){var a=r;break b}}a=null}if(e=a)lt(this.i,this.l,e,`Initial handshake response via X-HTTP-Initial-Response`),this.L=!0,Mt(this,e);else{this.o=!1,this.m=3,x(12),jt(this),At(this);break a}}if(this.R){e=!0;let t;for(;!this.K&&this.C<n.length;)if(t=Et(this,n),t==xt){s==4&&(this.m=4,x(14),e=!1),lt(this.i,this.l,null,`[Incomplete Response]`);break}else if(t==bt){this.m=4,x(15),lt(this.i,this.l,n,`[Invalid Chunk]`),e=!1;break}else lt(this.i,this.l,t,null),Mt(this,t);if(Tt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),s!=4||n.length!=0||this.h.h||(this.m=1,x(16),e=!1),this.o=this.o&&e,!e)lt(this.i,this.l,n,`[Invalid Chunked Response]`),jt(this),At(this);else if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info(`Great, no buffering proxy detected. Bytes received: `+n.length),Hn(o),o.P=!0,x(11))}}else lt(this.i,this.l,n,null),Mt(this,n);s==4&&jt(this),this.o&&!this.K&&(s==4?Gn(this.j,this):(this.o=!1,Dt(this)))}else jn(this.g),t==400&&n.indexOf(`Unknown SID`)>0?(this.m=3,x(12)):(this.m=0,x(13)),jt(this),At(this)}}}catch{}};function wt(e){if(!Tt(e))return e.g.la();let t=An(e.g);if(t===``)return``;let n=``,r=t.length,i=kn(e.g)==4;if(!e.h.i){if(typeof TextDecoder>`u`)return jt(e),At(e),``;e.h.i=new o.TextDecoder}for(let a=0;a<r;a++)e.h.h=!0,n+=e.h.i.decode(t[a],{stream:!(i&&a==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}function Tt(e){return e.g?e.v==`GET`&&e.M!=2&&e.j.Aa:!1}function Et(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?xt:(n=Number(t.substring(n,r)),isNaN(n)?bt:(r+=1,r+n>t.length?xt:(t=t.slice(r,r+n),e.C=r+n,t)))}vt.prototype.cancel=function(){this.K=!0,jt(this)};function Dt(e){e.T=Date.now()+e.H,Ot(e,e.H)}function Ot(e,t){if(e.D!=null)throw Error(`WatchDog timer not null`);e.D=at(l(e.aa,e),t)}function kt(e){e.D&&=(o.clearTimeout(e.D),null)}vt.prototype.aa=function(){this.D=null;let e=Date.now();e-this.T>=0?(ut(this.i,this.B),this.M!=2&&(nt(),x(17)),jt(this),this.m=2,At(this)):Ot(this,this.T-e)};function At(e){e.j.I==0||e.K||Gn(e.j,e)}function jt(e){kt(e);var t=e.O;t&&typeof t.dispose==`function`&&t.dispose(),e.O=null,We(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Mt(e,t){try{var n=e.j;if(n.I!=0&&(n.g==e||Lt(n.h,e))){if(!e.L&&Lt(n.h,e)&&n.I==3){try{var r=n.Ba.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){a:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)Wn(n),Pn(n);else break a;Vn(n),x(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&n.A==0&&!n.C&&(n.C=at(l(n.Va,n),6e3));It(n.h)<=1&&n.ta&&(n.ta=void 0)}else qn(n,11)}else if((e.L||n.g==e)&&Wn(n),!de(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let l=i[t],u=l[0];if(!(u<=n.K))if(n.K=u,l=l[1],n.I==2)if(l[0]==`c`){n.M=l[1],n.ba=l[2];let t=l[3];t!=null&&(n.ka=t,n.j.info(`VER=`+n.ka));let i=l[4];i!=null&&(n.za=i,n.j.info(`SVER=`+n.za));let u=l[5];u!=null&&typeof u==`number`&&u>0&&(r=1.5*u,n.O=r,n.j.info(`backChannelRequestTimeoutMs_=`+r)),r=n;let d=e.g;if(d){let e=d.g?d.g.getResponseHeader(`X-Client-Wire-Protocol`):null;if(e){var a=r.h;a.g||e.indexOf(`spdy`)==-1&&e.indexOf(`quic`)==-1&&e.indexOf(`h2`)==-1||(a.j=a.l,a.g=new Set,a.h&&=(Rt(a,a.h),null))}if(r.G){let e=d.g?d.g.getResponseHeader(`X-HTTP-Session-Id`):null;e&&(r.wa=e,S(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info(`Handshake RTT: `+n.T+`ms`)),r=n;var o=e;if(r.na=Yn(r,r.L?r.ba:null,r.W),o.L){zt(r.h,o);var s=o,c=r.O;c&&(s.H=c),s.D&&(kt(s),Dt(s)),r.g=o}else Bn(r);n.i.length>0&&In(n)}else l[0]!=`stop`&&l[0]!=`close`||qn(n,7);else n.I==3&&(l[0]==`stop`||l[0]==`close`?l[0]==`stop`?qn(n,7):Nn(n):l[0]!=`noop`&&n.l&&n.l.qa(l),n.A=0)}}nt(4)}catch{}}var Nt=class{constructor(e,t){this.g=e,this.map=t}};function Pt(e){this.l=e||10,o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType(`navigation`),e=e.length>0&&(e[0].nextHopProtocol==`hq`||e[0].nextHopProtocol==`h2`)):e=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ft(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function It(e){return e.h?1:e.g?e.g.size:0}function Lt(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function Rt(e,t){e.g?e.g.add(t):e.h=t}function zt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Pt.prototype.cancel=function(){if(this.i=Bt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function Bt(e){if(e.h!=null)return e.i.concat(e.h.G);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return p(e.i)}var Vt=RegExp(`^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$`);function Ht(e,t){if(e){e=e.split(`&`);for(let n=0;n<e.length;n++){let r=e[n].indexOf(`=`),i,a=null;r>=0?(i=e[n].substring(0,r),a=e[n].substring(r+1)):i=e[n],t(i,a?decodeURIComponent(a.replace(/\+/g,` `)):``)}}}function Ut(e){this.g=this.o=this.j=``,this.u=null,this.m=this.h=``,this.l=!1;let t;e instanceof Ut?(this.l=e.l,Gt(this,e.j),this.o=e.o,this.g=e.g,Kt(this,e.u),this.h=e.h,qt(this,ln(e.i)),this.m=e.m):e&&(t=String(e).match(Vt))?(this.l=!1,Gt(this,t[1]||``,!0),this.o=Yt(t[2]||``),this.g=Yt(t[3]||``,!0),Kt(this,t[4]),this.h=Yt(t[5]||``,!0),qt(this,t[6]||``,!0),this.m=Yt(t[7]||``)):(this.l=!1,this.i=new C(null,this.l))}Ut.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(Xt(t,Qt,!0),`:`);var n=this.g;return(n||t==`file`)&&(e.push(`//`),(t=this.o)&&e.push(Xt(t,Qt,!0),`@`),e.push(gt(n).replace(/%25([0-9a-fA-F]{2})/g,`%$1`)),n=this.u,n!=null&&e.push(`:`,String(n))),(n=this.h)&&(this.g&&n.charAt(0)!=`/`&&e.push(`/`),e.push(Xt(n,n.charAt(0)==`/`?en:$t,!0))),(n=this.i.toString())&&e.push(`?`,n),(n=this.m)&&e.push(`#`,Xt(n,nn)),e.join(``)},Ut.prototype.resolve=function(e){let t=Wt(this),n=!!e.j;n?Gt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=e.u!=null;var r=e.h;if(n)Kt(t,e.u);else if(n=!!e.h){if(r.charAt(0)!=`/`)if(this.g&&!this.h)r=`/`+r;else{var i=t.h.lastIndexOf(`/`);i!=-1&&(r=t.h.slice(0,i+1)+r)}if(i=r,i==`..`||i==`.`)r=``;else if(i.indexOf(`./`)!=-1||i.indexOf(`/.`)!=-1){r=i.lastIndexOf(`/`,0)==0,i=i.split(`/`);let e=[];for(let t=0;t<i.length;){let n=i[t++];n==`.`?r&&t==i.length&&e.push(``):n==`..`?((e.length>1||e.length==1&&e[0]!=``)&&e.pop(),r&&t==i.length&&e.push(``)):(e.push(n),r=!0)}r=e.join(`/`)}else r=i}return n?t.h=r:n=e.i.toString()!==``,n?qt(t,ln(e.i)):n=!!e.m,n&&(t.m=e.m),t};function Wt(e){return new Ut(e)}function Gt(e,t,n){e.j=n?Yt(t,!0):t,e.j&&=e.j.replace(/:$/,``)}function Kt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error(`Bad port number `+t);e.u=t}else e.u=null}function qt(e,t,n){t instanceof C?(e.i=t,dn(e.i,e.l)):(n||(t=Xt(t,tn)),e.i=new C(t,e.l))}function S(e,t,n){e.i.set(t,n)}function Jt(e){return S(e,`zx`,Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),e}function Yt(e,t){return e?t?decodeURI(e.replace(/%25/g,`%2525`)):decodeURIComponent(e):``}function Xt(e,t,n){return typeof e==`string`?(e=encodeURI(e).replace(t,Zt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,`%$1`)),e):null}function Zt(e){return e=e.charCodeAt(0),`%`+(e>>4&15).toString(16)+(e&15).toString(16)}var Qt=/[#\/\?@]/g,$t=/[#\?:]/g,en=/[#\?]/g,tn=/[#\?@]/g,nn=/#/g;function C(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function rn(e){e.g||(e.g=new Map,e.h=0,e.i&&Ht(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g,` `)),n)}))}e=C.prototype,e.add=function(e,t){rn(this),this.i=null,e=un(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function an(e,t){rn(e),t=un(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function on(e,t){return rn(e),t=un(e,t),e.g.has(t)}e.forEach=function(e,t){rn(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)};function sn(e,t){rn(e);let n=[];if(typeof t==`string`)on(e,t)&&(n=n.concat(e.g.get(un(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}e.set=function(e,t){return rn(this),this.i=null,e=un(this,e),on(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e?(e=sn(this,e),e.length>0?String(e[0]):t):t};function cn(e,t,n){an(e,t),n.length>0&&(e.i=null,e.g.set(un(e,t),p(n)),e.h+=n.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return``;let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=gt(n);n=sn(this,n);for(let t=0;t<n.length;t++){let r=i;n[t]!==``&&(r+=`=`+gt(n[t])),e.push(r)}}return this.i=e.join(`&`)};function ln(e){let t=new C;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function un(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function dn(e,t){t&&!e.j&&(rn(e),e.i=null,e.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(an(this,t),cn(this,n,e))},e)),e.j=t}function fn(e,t){let n=new ot;if(o.Image){let r=new Image;r.onload=u(mn,n,`TestLoadImage: loaded`,!0,t,r),r.onerror=u(mn,n,`TestLoadImage: error`,!1,t,r),r.onabort=u(mn,n,`TestLoadImage: abort`,!1,t,r),r.ontimeout=u(mn,n,`TestLoadImage: timeout`,!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function pn(e,t){let n=new ot,r=new AbortController,i=setTimeout(()=>{r.abort(),mn(n,`TestPingServer: timeout`,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?mn(n,`TestPingServer: ok`,!0,t):mn(n,`TestPingServer: server error`,!1,t)}).catch(()=>{clearTimeout(i),mn(n,`TestPingServer: error`,!1,t)})}function mn(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch{}}function hn(){this.g=new Ke}function gn(e){this.i=e.Sb||null,this.h=e.ab||!1}d(gn,qe),gn.prototype.g=function(){return new _n(this.i,this.h)};function _n(e,t){v.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText=``,this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F=`GET`,this.D=``,this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(_n,v),e=_n.prototype,e.open=function(e,t){if(this.readyState!=0)throw this.abort(),Error(`Error reopening a connection`);this.F=e,this.D=t,this.readyState=1,bn(this)},e.send=function(e){if(this.readyState!=1)throw this.abort(),Error(`need to call open() first. `);if(this.v.signal.aborted)throw this.abort(),Error(`Request was aborted.`);this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText=``,this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel(`Request was aborted.`).catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,yn(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,bn(this)),this.g&&(this.readyState=3,bn(this),this.g)))if(this.responseType===`arraybuffer`)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(o.ReadableStream!==void 0&&`body`in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error(`responseType must be empty for "streamBinaryChunks" mode responses.`);this.response=[]}else this.response=this.responseText=``,this.B=new TextDecoder;vn(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))};function vn(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array;(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?yn(this):bn(this),this.readyState==3&&vn(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,yn(this))},e.Na=function(e){this.g&&(this.response=e,yn(this))},e.ga=function(){this.g&&yn(this)};function yn(e){e.readyState=4,e.l=null,e.j=null,e.B=null,bn(e)}e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||``},e.getAllResponseHeaders=function(){if(!this.h)return``;let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+`: `+n[1]),n=t.next();return e.join(`\r
`)};function bn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(_n.prototype,`withCredentials`,{get:function(){return this.m===`include`},set:function(e){this.m=e?`include`:`same-origin`}});function xn(e){let t=``;return _e(e,function(e,n){t+=n,t+=`:`,t+=e,t+=`\r
`}),t}function Sn(e,t,n){a:{for(r in n){var r=!1;break a}r=!0}r||(n=xn(n),typeof e==`string`||S(e,t,n))}function w(e){v.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D=``,this.o=0,this.l=``,this.j=this.B=this.v=this.A=!1,this.m=null,this.F=``,this.H=!1}d(w,v);var Cn=/^https?$/i,wn=[`POST`,`PUT`];e=w.prototype,e.Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error(`[goog.net.XhrIo] Object is active with another request=`+this.D+`; newUri=`+e);t=t?t.toUpperCase():`GET`,this.D=e,this.l=``,this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():mt.g(),this.g.onreadystatechange=f(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){Tn(this,e);return}if(e=n||``,n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys==`function`&&typeof r.get==`function`)for(let e of r.keys())n.set(e,r.get(e));else throw Error(`Unknown input type for opt_headers: `+String(r));r=Array.from(n.keys()).find(e=>e.toLowerCase()==`content-type`),i=o.FormData&&e instanceof o.FormData,!(Array.prototype.indexOf.call(wn,t,void 0)>=0)||r||i||n.set(`Content-Type`,`application/x-www-form-urlencoded;charset=utf-8`);for(let[e,t]of n)this.g.setRequestHeader(e,t);this.F&&(this.g.responseType=this.F),`withCredentials`in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&=(clearTimeout(this.m),null),this.v=!0,this.g.send(e),this.v=!1}catch(e){Tn(this,e)}};function Tn(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,En(e),On(e)}function En(e){e.A||(e.A=!0,y(e,`complete`),y(e,`error`))}e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,y(this,`complete`),y(this,`abort`),On(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),On(this,!0)),w.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Dn(this):this.Xa())},e.Xa=function(){Dn(this)};function Dn(e){if(e.h&&a!==void 0){if(e.v&&kn(e)==4)setTimeout(e.Ca.bind(e),0);else if(y(e,`readystatechange`),kn(e)==4){e.h=!1;try{let a=e.ca();a:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break a;default:t=!1}var n;if(!(n=t)){var r;if(r=a===0){let t=String(e.D).match(Vt)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),r=!Cn.test(t?t.toLowerCase():``)}n=r}if(n)y(e,`complete`),y(e,`success`);else{e.o=6;try{var i=kn(e)>2?e.g.statusText:``}catch{i=``}e.l=i+` [`+e.ca()+`]`,En(e)}}finally{On(e)}}}}function On(e,t){if(e.g){e.m&&=(clearTimeout(e.m),null);let n=e.g;e.g=null,t||y(e,`ready`);try{n.onreadystatechange=null}catch{}}}e.isActive=function(){return!!this.g};function kn(e){return e.g?e.g.readyState:0}e.ca=function(){try{return kn(this)>2?this.g.status:-1}catch{return-1}},e.la=function(){try{return this.g?this.g.responseText:``}catch{return``}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),Ge(t)}};function An(e){try{if(!e.g)return null;if(`response`in e.g)return e.g.response;switch(e.F){case``:case`text`:return e.g.responseText;case`arraybuffer`:if(`mozResponseArrayBuffer`in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function jn(e){let t={};e=(e.g&&kn(e)>=2&&e.g.getAllResponseHeaders()||``).split(`\r
`);for(let r=0;r<e.length;r++){if(de(e[r]))continue;var n=_t(e[r]);let i=n[0];if(n=n[1],typeof n!=`string`)continue;n=n.trim();let a=t[i]||[];t[i]=a,a.push(n)}ve(t,function(e){return e.join(`, `)})}e.ya=function(){return this.o},e.Ha=function(){return typeof this.l==`string`?this.l:String(this.l)};function T(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Mn(e){this.za=0,this.i=[],this.j=new ot,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=T(`failFast`,!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=T(`baseRetryDelayMs`,5e3,e),this.Za=T(`retryDelaySeedMs`,1e4,e),this.Ta=T(`forwardChannelMaxRetries`,2,e),this.va=T(`forwardChannelRequestTimeoutMs`,2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M=``,this.h=new Pt(e&&e.concurrentRequestLimit),this.Ba=new hn,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}e=Mn.prototype,e.ka=8,e.I=1,e.connect=function(e,t,n,r){x(0),this.W=e,this.H=t||{},n&&r!==void 0&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=Yn(this,null,this.W),In(this)};function Nn(e){if(Fn(e),e.I==3){var t=e.V++,n=Wt(e.J);if(S(n,`SID`,e.M),S(n,`RID`,t),S(n,`TYPE`,`terminate`),Rn(e,n),t=new vt(e,e.j,t),t.M=2,t.A=Jt(Wt(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),``)}catch{}!n&&o.Image&&(new Image().src=t.A,n=!0),n||(t.g=D(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Dt(t)}Jn(e)}function Pn(e){e.g&&=(Hn(e),e.g.cancel(),null)}function Fn(e){Pn(e),e.v&&=(o.clearTimeout(e.v),null),Wn(e),e.h.cancel(),e.m&&=(typeof e.m==`number`&&o.clearTimeout(e.m),null)}function In(e){if(!Ft(e.h)&&!e.m){e.m=!0;var t=e.Ea;ae||ce(),oe||=(ae(),!0),se.add(t,e),e.D=0}}function E(e,t){return It(e.h)>=e.h.j-(e.m?1:0)?!1:e.m?(e.i=t.G.concat(e.i),!0):e.I==1||e.I==2||e.D>=(e.Sa?0:e.Ta)?!1:(e.m=at(l(e.Ea,e,t),Kn(e,e.D)),e.D++,!0)}e.Ea=function(e){if(this.m)if(this.m=null,this.I==1){if(!e){this.V=Math.floor(Math.random()*1e5),e=this.V++;let i=new vt(this,this.j,e),a=this.o;if(this.U&&(a?(a=ye(a),xe(a,this.U)):a=this.U),this.u!==null||this.R||(i.J=a,a=null),this.S)a:{for(var t=0,n=0;n<this.i.length;n++){b:{var r=this.i[n];if(`__data__`in r.map&&(r=r.map.__data__,typeof r==`string`)){r=r.length;break b}r=void 0}if(r===void 0)break;if(t+=r,t>4096){t=n;break a}if(t===4096||n===this.i.length-1){t=n+1;break a}}t=1e3}else t=1e3;t=zn(this,i,t),n=Wt(this.J),S(n,`RID`,e),S(n,`CVER`,22),this.G&&S(n,`X-HTTP-Session-Id`,this.G),Rn(this,n),a&&(this.R?t=`headers=`+gt(xn(a))+`&`+t:this.u&&Sn(n,this.u,a)),Rt(this.h,i),this.Ra&&S(n,`TYPE`,`init`),this.S?(S(n,`$req`,t),S(n,`SID`,`null`),i.U=!0,St(i,n,null)):St(i,n,t),this.I=2}}else this.I==3&&(e?Ln(this,e):this.i.length==0||Ft(this.h)||Ln(this))};function Ln(e,t){var n=t?t.l:e.V++;let r=Wt(e.J);S(r,`SID`,e.M),S(r,`RID`,n),S(r,`AID`,e.K),Rn(e,r),e.u&&e.o&&Sn(r,e.u,e.o),n=new vt(e,e.j,n,e.D+1),e.u===null&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=zn(e,n,1e3),n.H=Math.round(e.va*.5)+Math.round(e.va*.5*Math.random()),Rt(e.h,n),St(n,r,t)}function Rn(e,t){e.H&&_e(e.H,function(e,n){S(t,n,e)}),e.l&&_e({},function(e,n){S(t,n,e)})}function zn(e,t,n){n=Math.min(e.i.length,n);let r=e.l?l(e.l.Ka,e.l,e):null;a:{var i=e.i;let t=-1;for(;;){let e=[`count=`+n];t==-1?n>0?(t=i[0].g,e.push(`ofs=`+t)):t=0:e.push(`ofs=`+t);let c=!0;for(let l=0;l<n;l++){var a=i[l].g;let n=i[l].map;if(a-=t,a<0)t=Math.max(0,i[l].g-100),c=!1;else try{a=`req`+a+`_`||``;try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;s(n)&&(r=b(n)),e.push(a+t+`=`+encodeURIComponent(r))}}catch(t){throw e.push(a+`type=_badmap`),t}}catch{r&&r(n)}}if(c){o=e.join(`&`);break a}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function Bn(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;ae||ce(),oe||=(ae(),!0),se.add(t,e),e.A=0}}function Vn(e){return e.g||e.v||e.A>=3?!1:(e.Y++,e.v=at(l(e.Da,e),Kn(e,e.A)),e.A++,!0)}e.Da=function(){if(this.v=null,Un(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var e=4*this.T;this.j.info(`BP detection timer enabled: `+e),this.B=at(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info(`BP detection timeout reached.`),this.j.info(`Buffering proxy detected and switch to long-polling!`),this.F=!1,this.P=!0,x(10),Pn(this),Un(this))};function Hn(e){e.B!=null&&(o.clearTimeout(e.B),e.B=null)}function Un(e){e.g=new vt(e,e.j,`rpc`,e.Y),e.u===null&&(e.g.J=e.o),e.g.P=0;var t=Wt(e.na);S(t,`RID`,`rpc`),S(t,`SID`,e.M),S(t,`AID`,e.K),S(t,`CI`,e.F?`0`:`1`),!e.F&&e.ia&&S(t,`TO`,e.ia),S(t,`TYPE`,`xmlhttp`),Rn(e,t),e.u&&e.o&&Sn(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=Jt(Wt(t)),n.u=null,n.R=!0,Ct(n,e)}e.Va=function(){this.C!=null&&(this.C=null,Pn(this),Vn(this),x(19))};function Wn(e){e.C!=null&&(o.clearTimeout(e.C),e.C=null)}function Gn(e,t){var n=null;if(e.g==t){Wn(e),Hn(e),e.g=null;var r=2}else if(Lt(e.h,t))n=t.G,zt(e.h,t),r=1;else return;if(e.I!=0){if(t.o)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;r=et(),y(r,new it(r,n)),In(e)}else Bn(e);else if(i=t.m,i==3||i==0&&t.X>0||!(r==1&&E(e,t)||r==2&&Vn(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),i){case 1:qn(e,5);break;case 4:qn(e,10);break;case 3:qn(e,6);break;default:qn(e,2)}}}function Kn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function qn(e,t){if(e.j.info(`Error code `+t),t==2){var n=l(e.bb,e),r=e.Ua;let t=!r;r=new Ut(r||`//www.google.com/images/cleardot.gif`),o.location&&o.location.protocol==`http`||Gt(r,`https`),Jt(r),t?fn(r.toString(),n):pn(r.toString(),n)}else x(2);e.I=0,e.l&&e.l.pa(t),Jn(e),Fn(e)}e.bb=function(e){e?(this.j.info(`Successfully pinged google.com`),x(2)):(this.j.info(`Failed to ping google.com`),x(1))};function Jn(e){if(e.I=0,e.ja=[],e.l){let t=Bt(e.h);(t.length!=0||e.i.length!=0)&&(ee(e.ja,t),ee(e.ja,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.oa()}}function Yn(e,t,n){var r=n instanceof Ut?Wt(n):new Ut(n);if(r.g!=``)t&&(r.g=t+`.`+r.g),Kt(r,r.u);else{var i=o.location;r=i.protocol,t=t?t+`.`+i.hostname:i.hostname,i=+i.port;let e=new Ut(null);r&&Gt(e,r),t&&(e.g=t),i&&Kt(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&S(r,n,t),S(r,`VER`,e.ka),Rn(e,r),r}function D(e,t,n){if(t&&!e.L)throw Error(`Can't create secondary domain capable XhrIo object.`);return t=e.Aa&&!e.ma?new w(new gn({ab:n})):new w(e.ma),t.Fa(e.L),t}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function O(){}e=O.prototype,e.ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){};function Xn(){}Xn.prototype.g=function(e,t){return new k(e,t)};function k(e,t){v.call(this),this.g=new Mn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e[`X-Client-Protocol`]=`webchannel`:e={"X-Client-Protocol":`webchannel`}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e[`X-WebChannel-Content-Type`]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e[`X-WebChannel-Client-Profile`]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!de(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t&&=t.httpSessionIdParam)&&!de(t)&&(this.g.G=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new $n(this)}d(k,v),k.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},k.prototype.close=function(){Nn(this.g)},k.prototype.o=function(e){var t=this.g;if(typeof e==`string`){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=b(e),e=n);t.i.push(new Nt(t.Ya++,e)),t.I==3&&In(t)},k.prototype.N=function(){this.g.l=null,delete this.j,Nn(this.g),delete this.g,k.Z.N.call(this)};function Zn(e){Xe.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){a:{for(let n in t){e=n;break a}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}d(Zn,Xe);function Qn(){Ze.call(this),this.status=1}d(Qn,Ze);function $n(e){this.g=e}d($n,O),$n.prototype.ra=function(){y(this.g,`a`)},$n.prototype.qa=function(e){y(this.g,new Zn(e))},$n.prototype.pa=function(e){y(this.g,new Qn)},$n.prototype.oa=function(){y(this.g,`b`)},Xn.prototype.createWebChannel=Xn.prototype.g,k.prototype.send=k.prototype.o,k.prototype.open=k.prototype.m,k.prototype.close=k.prototype.close,Rl=Al.createWebChannelTransport=function(){return new Xn},Ll=Al.getStatEventTarget=function(){return et()},Il=Al.Event=Qe,Fl=Al.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ft.NO_ERROR=0,ft.TIMEOUT=8,ft.HTTP_ERROR=6,Pl=Al.ErrorCode=ft,pt.COMPLETE=`complete`,Nl=Al.EventType=pt,Je.EventType=Ye,Ye.OPEN=`a`,Ye.CLOSE=`b`,Ye.ERROR=`c`,Ye.MESSAGE=`d`,v.prototype.listen=v.prototype.J,Ml=Al.WebChannel=Je,Al.FetchXmlHttpFactory=gn,w.prototype.listenOnce=w.prototype.K,w.prototype.getLastError=w.prototype.Ha,w.prototype.getLastErrorCode=w.prototype.ya,w.prototype.getStatus=w.prototype.ca,w.prototype.getResponseJson=w.prototype.La,w.prototype.getResponseText=w.prototype.la,w.prototype.send=w.prototype.ea,w.prototype.setWithCredentials=w.prototype.Fa,jl=Al.XhrIo=w}).apply(kl===void 0?typeof self<`u`?self:typeof window<`u`?window:{}:kl);var j=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?`uid:`+this.uid:`anonymous-user`}isEqual(e){return e.uid===this.uid}};j.UNAUTHENTICATED=new j(null),j.GOOGLE_CREDENTIALS=new j(`google-credentials-uid`),j.FIRST_PARTY=new j(`first-party-uid`),j.MOCK_USER=new j(`mock-user`);var zl=`12.8.0`;function Bl(e){zl=e}var Vl=new Ye(`@firebase/firestore`);function Hl(){return Vl.logLevel}function M(e,...t){if(Vl.logLevel<=b.DEBUG){let n=t.map(Gl);Vl.debug(`Firestore (${zl}): ${e}`,...n)}}function Ul(e,...t){if(Vl.logLevel<=b.ERROR){let n=t.map(Gl);Vl.error(`Firestore (${zl}): ${e}`,...n)}}function Wl(e,...t){if(Vl.logLevel<=b.WARN){let n=t.map(Gl);Vl.warn(`Firestore (${zl}): ${e}`,...n)}}function Gl(e){if(typeof e==`string`)return e;try{return function(e){return JSON.stringify(e)}(e)}catch{return e}}function N(e,t,n){let r=`Unexpected state`;typeof t==`string`?r=t:n=t,Kl(e,r,n)}function Kl(e,t,n){let r=`FIRESTORE (${zl}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(n!==void 0)try{r+=` CONTEXT: `+JSON.stringify(n)}catch{r+=` CONTEXT: `+n}throw Ul(r),Error(r)}function P(e,t,n,r){let i=`Unexpected state`;typeof n==`string`?i=n:r=n,e||Kl(t,i,r)}function F(e,t){return e}var I={OK:`ok`,CANCELLED:`cancelled`,UNKNOWN:`unknown`,INVALID_ARGUMENT:`invalid-argument`,DEADLINE_EXCEEDED:`deadline-exceeded`,NOT_FOUND:`not-found`,ALREADY_EXISTS:`already-exists`,PERMISSION_DENIED:`permission-denied`,UNAUTHENTICATED:`unauthenticated`,RESOURCE_EXHAUSTED:`resource-exhausted`,FAILED_PRECONDITION:`failed-precondition`,ABORTED:`aborted`,OUT_OF_RANGE:`out-of-range`,UNIMPLEMENTED:`unimplemented`,INTERNAL:`internal`,UNAVAILABLE:`unavailable`,DATA_LOSS:`data-loss`},L=class extends be{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}},ql=class{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}},Jl=class{constructor(e,t){this.user=t,this.type=`OAuth`,this.headers=new Map,this.headers.set(`Authorization`,`Bearer ${e}`)}},Yl=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(j.UNAUTHENTICATED)))}shutdown(){}},Xl=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}},Zl=class{constructor(e){this.t=e,this.currentUser=j.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){P(this.o===void 0,42304);let n=this.i,r=e=>this.i===n?Promise.resolve():(n=this.i,t(e)),i=new ql;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ql,e.enqueueRetryable((()=>r(this.currentUser)))};let a=()=>{let t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{M(`FirebaseAuthCredentialsProvider`,`Auth detected`),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(M(`FirebaseAuthCredentialsProvider`,`Auth not yet detected`),i.resolve(),i=new ql)}}),0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i===e?t?(P(typeof t.accessToken==`string`,31837,{l:t}),new Jl(t.accessToken,this.currentUser)):null:(M(`FirebaseAuthCredentialsProvider`,`getToken aborted due to token change.`),this.getToken()))):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return P(e===null||typeof e==`string`,2055,{h:e}),new j(e)}},Ql=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type=`FirstParty`,this.user=j.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set(`X-Goog-AuthUser`,this.P);let e=this.A();return e&&this.R.set(`Authorization`,e),this.T&&this.R.set(`X-Goog-Iam-Authorization-Token`,this.T),this.R}},$l=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Ql(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(j.FIRST_PARTY)))}shutdown(){}invalidateToken(){}},eu=class{constructor(e){this.value=e,this.type=`AppCheck`,this.headers=new Map,e&&e.length>0&&this.headers.set(`x-firebase-appcheck`,this.value)}},tu=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,C(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){P(this.o===void 0,3512);let n=e=>{e.error!=null&&M(`FirebaseAppCheckTokenProvider`,`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,M(`FirebaseAppCheckTokenProvider`,`Received ${n?`new`:`existing`} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};let r=e=>{M(`FirebaseAppCheckTokenProvider`,`AppCheck detected`),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):M(`FirebaseAppCheckTokenProvider`,`AppCheck not yet detected`)}}),0)}getToken(){if(this.p)return Promise.resolve(new eu(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(P(typeof e.token==`string`,44558,{tokenResult:e}),this.m=e.token,new eu(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function nu(e){let t=typeof self<`u`&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues==`function`)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}var ru=class{static newId(){let e=``;for(;e.length<20;){let t=nu(40);for(let n=0;n<t.length;++n)e.length<20&&t[n]<248&&(e+=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`.charAt(t[n]%62))}return e}};function R(e,t){return e<t?-1:e>t?1:0}function iu(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return su(n)===su(i)?R(n,i):su(n)?1:-1}return R(e.length,t.length)}var au=55296,ou=57343;function su(e){let t=e.charCodeAt(0);return t>=au&&t<=ou}function cu(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}var lu=`__name__`,uu=class e{constructor(e,t,n){t===void 0?t=0:t>e.length&&N(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&N(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((e=>{n.push(e)})):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let i=0;i<r;i++){let r=e.compareSegments(t.get(i),n.get(i));if(r!==0)return r}return R(t.length,n.length)}static compareSegments(t,n){let r=e.isNumericId(t),i=e.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?e.extractNumericId(t).compare(e.extractNumericId(n)):iu(t,n)}static isNumericId(e){return e.startsWith(`__id`)&&e.endsWith(`__`)}static extractNumericId(e){return Dl.fromString(e.substring(4,e.length-2))}},z=class e extends uu{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join(`/`)}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join(`/`)}static fromString(...t){let n=[];for(let e of t){if(e.indexOf(`//`)>=0)throw new L(I.INVALID_ARGUMENT,`Invalid segment (${e}). Paths must not contain // in them.`);n.push(...e.split(`/`).filter((e=>e.length>0)))}return new e(n)}static emptyPath(){return new e([])}},du=/^[_a-zA-Z][_a-zA-Z0-9]*$/,fu=class e extends uu{construct(t,n,r){return new e(t,n,r)}static isValidIdentifier(e){return du.test(e)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,`\\\\`).replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(`.`)}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===`__name__`}static keyField(){return new e([lu])}static fromServerFormat(t){let n=[],r=``,i=0,a=()=>{if(r.length===0)throw new L(I.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=``},o=!1;for(;i<t.length;){let e=t[i];if(e===`\\`){if(i+1===t.length)throw new L(I.INVALID_ARGUMENT,`Path has trailing escape character: `+t);let e=t[i+1];if(e!==`\\`&&e!==`.`&&e!=="`")throw new L(I.INVALID_ARGUMENT,`Path has invalid escape sequence: `+t);r+=e,i+=2}else e==="`"?(o=!o,i++):e!==`.`||o?(r+=e,i++):(a(),i++)}if(a(),o)throw new L(I.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}static emptyPath(){return new e([])}},B=class e{constructor(e){this.path=e}static fromPath(t){return new e(z.fromString(t))}static fromName(t){return new e(z.fromString(t).popFirst(5))}static empty(){return new e(z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&z.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(t){return new e(new z(t.slice()))}};function pu(e,t,n){if(!n)throw new L(I.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function mu(e,t,n,r){if(!0===t&&!0===r)throw new L(I.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function hu(e){if(!B.isDocumentKey(e))throw new L(I.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function gu(e){return typeof e==`object`&&!!e&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function _u(e){if(e===void 0)return`undefined`;if(e===null)return`null`;if(typeof e==`string`)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return``+e;if(typeof e==`object`){if(e instanceof Array)return`an array`;{let t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:`an object`}}return typeof e==`function`?`a function`:N(12329,{type:typeof e})}function vu(e,t){if(`_delegate`in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new L(I.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?`);{let n=_u(e);throw new L(I.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function V(e,t){let n={typeString:e};return t&&(n.value=t),n}function yu(e,t){if(!gu(e))throw new L(I.INVALID_ARGUMENT,`JSON must be an object`);let n;for(let r in t)if(t[r]){let i=t[r].typeString,a=`value`in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(a!==void 0&&o!==a.value){n=`Expected '${r}' field to equal '${a.value}'`;break}}if(n)throw new L(I.INVALID_ARGUMENT,n);return!0}var bu=-62135596800,xu=1e6,H=class e{static now(){return e.fromMillis(Date.now())}static fromDate(t){return e.fromMillis(t.getTime())}static fromMillis(t){let n=Math.floor(t/1e3);return new e(n,Math.floor((t-1e3*n)*xu))}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new L(I.INVALID_ARGUMENT,`Timestamp nanoseconds out of range: `+t);if(e<bu||e>=253402300800)throw new L(I.INVALID_ARGUMENT,`Timestamp seconds out of range: `+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xu}_compareTo(e){return this.seconds===e.seconds?R(this.nanoseconds,e.nanoseconds):R(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return`Timestamp(seconds=`+this.seconds+`, nanoseconds=`+this.nanoseconds+`)`}toJSON(){return{type:e._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(yu(t,e._jsonSchema))return new e(t.seconds,t.nanoseconds)}valueOf(){let e=this.seconds-bu;return String(e).padStart(12,`0`)+`.`+String(this.nanoseconds).padStart(9,`0`)}};H._jsonSchemaVersion=`firestore/timestamp/1.0`,H._jsonSchema={type:V(`string`,H._jsonSchemaVersion),seconds:V(`number`),nanoseconds:V(`number`)};var U=class e{static fromTimestamp(t){return new e(t)}static min(){return new e(new H(0,0))}static max(){return new e(new H(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return`SnapshotVersion(`+this.timestamp.toString()+`)`}toTimestamp(){return this.timestamp}},Su=-1,Cu=class{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}};Cu.UNKNOWN_ID=-1;function wu(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new Eu(U.fromTimestamp(r===1e9?new H(n+1,0):new H(n,r)),B.empty(),t)}function Tu(e){return new Eu(e.readTime,e.key,Su)}var Eu=class e{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new e(U.min(),B.empty(),Su)}static max(){return new e(U.max(),B.empty(),Su)}};function Du(e,t){let n=e.readTime.compareTo(t.readTime);return n===0?(n=B.comparator(e.documentKey,t.documentKey),n===0?R(e.largestBatchId,t.largestBatchId):n):n}var Ou=`The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.`,ku=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}};async function Au(e){if(e.code!==I.FAILED_PRECONDITION||e.message!==Ou)throw e;M(`LocalStore`,`Unexpectedly lost primary lease`)}var W=class e{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(t,n){return this.callbackAttached&&N(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(((e,r)=>{this.nextCallback=n=>{this.wrapSuccess(t,n).next(e,r)},this.catchCallback=t=>{this.wrapFailure(n,t).next(e,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(t){try{let n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}wrapSuccess(t,n){return t?this.wrapUserFunction((()=>t(n))):e.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction((()=>t(n))):e.reject(n)}static resolve(t){return new e(((e,n)=>{e(t)}))}static reject(t){return new e(((e,n)=>{n(t)}))}static waitFor(t){return new e(((e,n)=>{let r=0,i=0,a=!1;t.forEach((t=>{++r,t.next((()=>{++i,a&&i===r&&e()}),(e=>n(e)))})),a=!0,i===r&&e()}))}static or(t){let n=e.resolve(!1);for(let r of t)n=n.next((t=>t?e.resolve(t):r()));return n}static forEach(e,t){let n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(t,n){return new e(((e,r)=>{let i=t.length,a=Array(i),o=0;for(let s=0;s<i;s++){let c=s;n(t[c]).next((t=>{a[c]=t,++o,o===i&&e(a)}),(e=>r(e)))}}))}static doWhile(t,n){return new e(((e,r)=>{let i=()=>{!0===t()?n().next((()=>{i()}),r):e()};i()}))}};function ju(e){let t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(`.`).slice(0,2).join(`.`):`-1`;return Number(n)}function Mu(e){return e.name===`IndexedDbTransactionError`}var Nu=class{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}};Nu.ce=-1;var Pu=-1;function Fu(e){return e==null}function Iu(e){return e===0&&1/e==-1/0}function Lu(e){return typeof e==`number`&&Number.isInteger(e)&&!Iu(e)&&e<=2**53-1&&e>=-(2**53-1)}var Ru=``;function zu(e){let t=``;for(let n=0;n<e.length;n++)t.length>0&&(t=Vu(t)),t=Bu(e.get(n),t);return Vu(t)}function Bu(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case`\0`:n+=``;break;case Ru:n+=``;break;default:n+=r}}return n}function Vu(e){return e+Ru+``}function Hu(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Uu(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Wu(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var G=class e{constructor(e,t){this.comparator=e,this.root=t||Ku.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Ku.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ku.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){let e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(`, `)}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gu(this.root,e,this.comparator,!0)}},Gu=class{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ku=class e{constructor(t,n,r,i,a){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=a??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,i,a){return new e(t??this.key,n??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return 2**this.check()<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw N(43730,{key:this.key,value:this.value});if(this.right.isRed())throw N(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw N(27949);return e+(this.isRed()?0:1)}};Ku.EMPTY=null,Ku.RED=!0,Ku.BLACK=!1,Ku.EMPTY=new class{constructor(){this.size=0}get key(){throw N(57766)}get value(){throw N(16141)}get color(){throw N(16727)}get left(){throw N(29726)}get right(){throw N(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new Ku(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var K=class e{constructor(e){this.comparator=e,this.data=new G(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t===void 0?this.data.getIterator():this.data.getIteratorFrom(t);n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qu(this.data.getIterator())}getIteratorFrom(e){return new qu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let e=n.getNext().key,t=r.getNext().key;if(this.comparator(e,t)!==0)return!1}return!0}toArray(){let e=[];return this.forEach((t=>{e.push(t)})),e}toString(){let e=[];return this.forEach((t=>e.push(t))),`SortedSet(`+e.toString()+`)`}copy(t){let n=new e(this.comparator);return n.data=t,n}},qu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}},Ju=class e{constructor(e){this.fields=e,e.sort(fu.comparator)}static empty(){return new e([])}unionWith(t){let n=new K(fu.comparator);for(let e of this.fields)n=n.add(e);for(let e of t)n=n.add(e);return new e(n.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return cu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}},Yu=class extends Error{constructor(){super(...arguments),this.name=`Base64DecodeError`}},Xu=class e{constructor(e){this.binaryString=e}static fromBase64String(t){return new e(function(e){try{return atob(e)}catch(e){throw typeof DOMException<`u`&&e instanceof DOMException?new Yu(`Invalid base64 string: `+e):e}}(t))}static fromUint8Array(t){return new e(function(e){let t=``;for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return R(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Xu.EMPTY_BYTE_STRING=new Xu(``);var Zu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qu(e){if(P(!!e,39018),typeof e==`string`){let t=0,n=Zu.exec(e);if(P(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+`000000000`).substr(0,9),t=Number(e)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:q(e.seconds),nanos:q(e.nanos)}}function q(e){return typeof e==`number`?e:typeof e==`string`?Number(e):0}function $u(e){return typeof e==`string`?Xu.fromBase64String(e):Xu.fromUint8Array(e)}var ed=`server_timestamp`,td=`__type__`,nd=`__previous_value__`,rd=`__local_write_time__`;function id(e){return(e?.mapValue?.fields||{})[td]?.stringValue===ed}function ad(e){let t=e.mapValue.fields[nd];return id(t)?ad(t):t}function od(e){let t=Qu(e.mapValue.fields[rd].timestampValue);return new H(t.seconds,t.nanos)}var sd=class{constructor(e,t,n,r,i,a,o,s,c,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c,this.isUsingEmulator=l,this.apiKey=u}},cd=`(default)`,ld=class e{constructor(e,t){this.projectId=e,this.database=t||cd}static empty(){return new e(``,``)}get isDefaultDatabase(){return this.database===cd}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}};function ud(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,[`projectId`]))throw new L(I.INVALID_ARGUMENT,`"projectId" not provided in firebase.initializeApp.`);return new ld(e.options.projectId,t)}var dd=`__type__`,fd=`__max__`,pd={mapValue:{fields:{__type__:{stringValue:fd}}}},md=`__vector__`,hd=`value`;function gd(e){return`nullValue`in e?0:`booleanValue`in e?1:`integerValue`in e||`doubleValue`in e?2:`timestampValue`in e?3:`stringValue`in e?5:`bytesValue`in e?6:`referenceValue`in e?7:`geoPointValue`in e?8:`arrayValue`in e?9:`mapValue`in e?id(e)?4:Md(e)?9007199254740991:Ad(e)?10:11:N(28295,{value:e})}function _d(e,t){if(e===t)return!0;let n=gd(e);if(n!==gd(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return od(e).isEqual(od(t));case 3:return function(e,t){if(typeof e.timestampValue==`string`&&typeof t.timestampValue==`string`&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=Qu(e.timestampValue),r=Qu(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return $u(e.bytesValue).isEqual($u(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return q(e.geoPointValue.latitude)===q(t.geoPointValue.latitude)&&q(e.geoPointValue.longitude)===q(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if(`integerValue`in e&&`integerValue`in t)return q(e.integerValue)===q(t.integerValue);if(`doubleValue`in e&&`doubleValue`in t){let n=q(e.doubleValue),r=q(t.doubleValue);return n===r?Iu(n)===Iu(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return cu(e.arrayValue.values||[],t.arrayValue.values||[],_d);case 10:case 11:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Hu(n)!==Hu(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(r[e]===void 0||!_d(n[e],r[e])))return!1;return!0}(e,t);default:return N(52216,{left:e})}}function vd(e,t){return(e.values||[]).find((e=>_d(e,t)))!==void 0}function yd(e,t){if(e===t)return 0;let n=gd(e),r=gd(t);if(n!==r)return R(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return R(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=q(e.integerValue||e.doubleValue),r=q(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return bd(e.timestampValue,t.timestampValue);case 4:return bd(od(e),od(t));case 5:return iu(e.stringValue,t.stringValue);case 6:return function(e,t){let n=$u(e),r=$u(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split(`/`),r=t.split(`/`);for(let e=0;e<n.length&&e<r.length;e++){let t=R(n[e],r[e]);if(t!==0)return t}return R(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=R(q(e.latitude),q(t.latitude));return n===0?R(q(e.longitude),q(t.longitude)):n}(e.geoPointValue,t.geoPointValue);case 9:return xd(e.arrayValue,t.arrayValue);case 10:return function(e,t){let n=e.fields||{},r=t.fields||{},i=n[hd]?.arrayValue,a=r[hd]?.arrayValue,o=R(i?.values?.length||0,a?.values?.length||0);return o===0?xd(i,a):o}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===pd.mapValue&&t===pd.mapValue)return 0;if(e===pd.mapValue)return 1;if(t===pd.mapValue)return-1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(let e=0;e<r.length&&e<a.length;++e){let t=iu(r[e],a[e]);if(t!==0)return t;let o=yd(n[r[e]],i[a[e]]);if(o!==0)return o}return R(r.length,a.length)}(e.mapValue,t.mapValue);default:throw N(23264,{he:n})}}function bd(e,t){if(typeof e==`string`&&typeof t==`string`&&e.length===t.length)return R(e,t);let n=Qu(e),r=Qu(t),i=R(n.seconds,r.seconds);return i===0?R(n.nanos,r.nanos):i}function xd(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=yd(n[e],r[e]);if(t)return t}return R(n.length,r.length)}function Sd(e){return Cd(e)}function Cd(e){return`nullValue`in e?`null`:`booleanValue`in e?``+e.booleanValue:`integerValue`in e?``+e.integerValue:`doubleValue`in e?``+e.doubleValue:`timestampValue`in e?function(e){let t=Qu(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):`stringValue`in e?e.stringValue:`bytesValue`in e?function(e){return $u(e).toBase64()}(e.bytesValue):`referenceValue`in e?function(e){return B.fromName(e).toString()}(e.referenceValue):`geoPointValue`in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):`arrayValue`in e?function(e){let t=`[`,n=!0;for(let r of e.values||[])n?n=!1:t+=`,`,t+=Cd(r);return t+`]`}(e.arrayValue):`mapValue`in e?function(e){let t=Object.keys(e.fields||{}).sort(),n=`{`,r=!0;for(let i of t)r?r=!1:n+=`,`,n+=`${i}:${Cd(e.fields[i])}`;return n+`}`}(e.mapValue):N(61005,{value:e})}function wd(e){switch(gd(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=ad(e);return t?16+wd(t):16;case 5:return 2*e.stringValue.length;case 6:return $u(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+wd(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Uu(e.fields,((e,n)=>{t+=e.length+wd(n)})),t}(e.mapValue);default:throw N(13486,{value:e})}}function Td(e){return!!e&&`integerValue`in e}function Ed(e){return!!e&&`arrayValue`in e}function Dd(e){return!!e&&`nullValue`in e}function Od(e){return!!e&&`doubleValue`in e&&isNaN(Number(e.doubleValue))}function kd(e){return!!e&&`mapValue`in e}function Ad(e){return(e?.mapValue?.fields||{})[dd]?.stringValue===md}function jd(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&typeof e.timestampValue==`object`)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return Uu(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=jd(n))),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=jd(e.arrayValue.values[n]);return t}return{...e}}function Md(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===fd}var Nd=class e{constructor(e){this.value=e}static empty(){return new e({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!kd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=jd(t)}setAll(e){let t=fu.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=jd(e):r.push(i.lastSegment())}));let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());kd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _d(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];kd(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Uu(t,((t,n)=>e[t]=n));for(let t of n)delete e[t]}clone(){return new e(jd(this.value))}};function Pd(e){let t=[];return Uu(e.fields,((e,n)=>{let r=new fu([e]);if(kd(n)){let e=Pd(n.mapValue).fields;if(e.length===0)t.push(r);else for(let n of e)t.push(r.child(n))}else t.push(r)})),new Ju(t)}var Fd=class e{constructor(e,t,n,r,i,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(t){return new e(t,0,U.min(),U.min(),U.min(),Nd.empty(),0)}static newFoundDocument(t,n,r,i){return new e(t,1,n,U.min(),r,i,0)}static newNoDocument(t,n){return new e(t,2,n,U.min(),U.min(),Nd.empty(),0)}static newUnknownDocument(t,n){return new e(t,3,n,U.min(),U.min(),Nd.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nd.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nd.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}},Id=class{constructor(e,t){this.position=e,this.inclusive=t}};function Ld(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let a=t[i],o=e.position[i];if(r=a.field.isKeyField()?B.comparator(B.fromName(o.referenceValue),n.key):yd(o,n.data.field(a.field)),a.dir===`desc`&&(r*=-1),r!==0)break}return r}function Rd(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!_d(e.position[n],t.position[n]))return!1;return!0}var zd=class{constructor(e,t=`asc`){this.field=e,this.dir=t}};function Bd(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Vd=class{},J=class e extends Vd{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(t,n,r){return t.isKeyField()?n===`in`||n===`not-in`?this.createKeyFieldInFilter(t,n,r):new Yd(t,n,r):n===`array-contains`?new $d(t,r):n===`in`?new ef(t,r):n===`not-in`?new tf(t,r):n===`array-contains-any`?new nf(t,r):new e(t,n,r)}static createKeyFieldInFilter(e,t,n){return t===`in`?new Xd(e,n):new Zd(e,n)}matches(e){let t=e.data.field(this.field);return this.op===`!=`?t!==null&&t.nullValue===void 0&&this.matchesComparison(yd(t,this.value)):t!==null&&gd(this.value)===gd(t)&&this.matchesComparison(yd(t,this.value))}matchesComparison(e){switch(this.op){case`<`:return e<0;case`<=`:return e<=0;case`==`:return e===0;case`!=`:return e!==0;case`>`:return e>0;case`>=`:return e>=0;default:return N(47266,{operator:this.op})}}isInequality(){return[`<`,`<=`,`>`,`>=`,`!=`,`not-in`].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Hd=class e extends Vd{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(t,n){return new e(t,n)}matches(e){return Ud(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Ud(e){return e.op===`and`}function Wd(e){return Gd(e)&&Ud(e)}function Gd(e){for(let t of e.filters)if(t instanceof Hd)return!1;return!0}function Kd(e){if(e instanceof J)return e.field.canonicalString()+e.op.toString()+Sd(e.value);if(Wd(e))return e.filters.map((e=>Kd(e))).join(`,`);{let t=e.filters.map((e=>Kd(e))).join(`,`);return`${e.op}(${t})`}}function qd(e,t){return e instanceof J?function(e,t){return t instanceof J&&e.op===t.op&&e.field.isEqual(t.field)&&_d(e.value,t.value)}(e,t):e instanceof Hd?function(e,t){return t instanceof Hd&&e.op===t.op&&e.filters.length===t.filters.length?e.filters.reduce(((e,n,r)=>e&&qd(n,t.filters[r])),!0):!1}(e,t):void N(19439)}function Jd(e){return e instanceof J?function(e){return`${e.field.canonicalString()} ${e.op} ${Sd(e.value)}`}(e):e instanceof Hd?function(e){return e.op.toString()+` {`+e.getFilters().map(Jd).join(` ,`)+`}`}(e):`Filter`}var Yd=class extends J{constructor(e,t,n){super(e,t,n),this.key=B.fromName(n.referenceValue)}matches(e){let t=B.comparator(e.key,this.key);return this.matchesComparison(t)}},Xd=class extends J{constructor(e,t){super(e,`in`,t),this.keys=Qd(`in`,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}},Zd=class extends J{constructor(e,t){super(e,`not-in`,t),this.keys=Qd(`not-in`,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}};function Qd(e,t){return(t.arrayValue?.values||[]).map((e=>B.fromName(e.referenceValue)))}var $d=class extends J{constructor(e,t){super(e,`array-contains`,t)}matches(e){let t=e.data.field(this.field);return Ed(t)&&vd(t.arrayValue,this.value)}},ef=class extends J{constructor(e,t){super(e,`in`,t)}matches(e){let t=e.data.field(this.field);return t!==null&&vd(this.value.arrayValue,t)}},tf=class extends J{constructor(e,t){super(e,`not-in`,t)}matches(e){if(vd(this.value.arrayValue,{nullValue:`NULL_VALUE`}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!vd(this.value.arrayValue,t)}},nf=class extends J{constructor(e,t){super(e,`array-contains-any`,t)}matches(e){let t=e.data.field(this.field);return!(!Ed(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>vd(this.value.arrayValue,e)))}},rf=class{constructor(e,t=null,n=[],r=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=a,this.endAt=o,this.Te=null}};function af(e,t=null,n=[],r=[],i=null,a=null,o=null){return new rf(e,t,n,r,i,a,o)}function of(e){let t=F(e);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+=`|cg:`+t.collectionGroup),e+=`|f:`,e+=t.filters.map((e=>Kd(e))).join(`,`),e+=`|ob:`,e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(`,`),Fu(t.limit)||(e+=`|l:`,e+=t.limit),t.startAt&&(e+=`|lb:`,e+=t.startAt.inclusive?`b:`:`a:`,e+=t.startAt.position.map((e=>Sd(e))).join(`,`)),t.endAt&&(e+=`|ub:`,e+=t.endAt.inclusive?`a:`:`b:`,e+=t.endAt.position.map((e=>Sd(e))).join(`,`)),t.Te=e}return t.Te}function sf(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bd(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!qd(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Rd(e.startAt,t.startAt)&&Rd(e.endAt,t.endAt)}function cf(e){return B.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var lf=class{constructor(e,t=null,n=[],r=[],i=null,a=`F`,o=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=s,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}};function uf(e,t,n,r,i,a,o,s){return new lf(e,t,n,r,i,a,o,s)}function df(e){return new lf(e)}function ff(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function pf(e){return B.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}function mf(e){return e.collectionGroup!==null}function hf(e){let t=F(e);if(t.Ie===null){t.Ie=[];let e=new Set;for(let n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:`asc`;(function(e){let t=new K(fu.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new zd(r,n))})),e.has(fu.keyField().canonicalString())||t.Ie.push(new zd(fu.keyField(),n))}return t.Ie}function gf(e){let t=F(e);return t.Ee||=_f(t,hf(e)),t.Ee}function _f(e,t){if(e.limitType===`F`)return af(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{let t=e.dir===`desc`?`asc`:`desc`;return new zd(e.field,t)}));let n=e.endAt?new Id(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Id(e.startAt.position,e.startAt.inclusive):null;return af(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function vf(e,t,n){return new lf(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function yf(e,t){return sf(gf(e),gf(t))&&e.limitType===t.limitType}function bf(e){return`${of(gf(e))}|lt:${e.limitType}`}function xf(e){return`Query(target=${function(e){let t=e.path.canonicalString();return e.collectionGroup!==null&&(t+=` collectionGroup=`+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Jd(e))).join(`, `)}]`),Fu(e.limit)||(t+=`, limit: `+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(`, `)}]`),e.startAt&&(t+=`, startAt: `,t+=e.startAt.inclusive?`b:`:`a:`,t+=e.startAt.position.map((e=>Sd(e))).join(`,`)),e.endAt&&(t+=`, endAt: `,t+=e.endAt.inclusive?`a:`:`b:`,t+=e.endAt.position.map((e=>Sd(e))).join(`,`)),`Target(${t})`}(gf(e))}; limitType=${e.limitType})`}function Sf(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return e.collectionGroup===null?B.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n):t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n)}(e,t)&&function(e,t){for(let n of hf(e))if(!n.field.isKeyField()&&t.data.field(n.field)===null)return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){let r=Ld(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,hf(e),t)||e.endAt&&!function(e,t,n){let r=Ld(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,hf(e),t))}(e,t)}function Cf(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function wf(e){return(t,n)=>{let r=!1;for(let i of hf(e)){let e=Tf(i,t,n);if(e!==0)return e;r||=i.field.isKeyField()}return 0}}function Tf(e,t,n){let r=e.field.isKeyField()?B.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return r!==null&&i!==null?yd(r,i):N(42886)}(e.field,t,n);switch(e.dir){case`asc`:return r;case`desc`:return-1*r;default:return N(19790,{direction:e.dir})}}var Ef=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Uu(this.inner,((t,n)=>{for(let[t,r]of n)e(t,r)}))}isEmpty(){return Wu(this.inner)}size(){return this.innerSize}},Df=new G(B.comparator);function Of(){return Df}var kf=new G(B.comparator);function Af(...e){let t=kf;for(let n of e)t=t.insert(n.key,n);return t}function jf(e){let t=kf;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Mf(){return Pf()}function Nf(){return Pf()}function Pf(){return new Ef((e=>e.toString()),((e,t)=>e.isEqual(t)))}var Ff=new G(B.comparator),If=new K(B.comparator);function Y(...e){let t=If;for(let n of e)t=t.add(n);return t}var Lf=new K(R);function Rf(){return Lf}function zf(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:`NaN`};if(t===1/0)return{doubleValue:`Infinity`};if(t===-1/0)return{doubleValue:`-Infinity`}}return{doubleValue:Iu(t)?`-0`:t}}function Bf(e){return{integerValue:``+e}}function Vf(e,t){return Lu(t)?Bf(t):zf(e,t)}var Hf=class{constructor(){this._=void 0}};function Uf(e,t,n){return e instanceof Kf?function(e,t){let n={fields:{[td]:{stringValue:ed},[rd]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&id(t)&&(t=ad(t)),t&&(n.fields[nd]=t),{mapValue:n}}(n,t):e instanceof qf?Jf(e,t):e instanceof Yf?Xf(e,t):function(e,t){let n=Gf(e,t),r=Qf(n)+Qf(e.Ae);return Td(n)&&Td(e.Ae)?Bf(r):zf(e.serializer,r)}(e,t)}function Wf(e,t,n){return e instanceof qf?Jf(e,t):e instanceof Yf?Xf(e,t):n}function Gf(e,t){return e instanceof Zf?function(e){return Td(e)||function(e){return!!e&&`doubleValue`in e}(e)}(t)?t:{integerValue:0}:null}var Kf=class extends Hf{},qf=class extends Hf{constructor(e){super(),this.elements=e}};function Jf(e,t){let n=$f(t);for(let t of e.elements)n.some((e=>_d(e,t)))||n.push(t);return{arrayValue:{values:n}}}var Yf=class extends Hf{constructor(e){super(),this.elements=e}};function Xf(e,t){let n=$f(t);for(let t of e.elements)n=n.filter((e=>!_d(e,t)));return{arrayValue:{values:n}}}var Zf=class extends Hf{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Qf(e){return q(e.integerValue||e.doubleValue)}function $f(e){return Ed(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var ep=class{constructor(e,t){this.field=e,this.transform=t}};function tp(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof qf&&t instanceof qf||e instanceof Yf&&t instanceof Yf?cu(e.elements,t.elements,_d):e instanceof Zf&&t instanceof Zf?_d(e.Ae,t.Ae):e instanceof Kf&&t instanceof Kf}(e.transform,t.transform)}var np=class{constructor(e,t){this.version=e,this.transformResults=t}},rp=class e{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new e}static exists(t){return new e(void 0,t)}static updateTime(t){return new e(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ip(e,t){return e.updateTime===void 0?e.exists===void 0||e.exists===t.isFoundDocument():t.isFoundDocument()&&t.version.isEqual(e.updateTime)}var ap=class{};function op(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new gp(e.key,rp.none()):new dp(e.key,e.data,rp.none());{let n=e.data,r=Nd.empty(),i=new K(fu.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);t===null&&e.length>1&&(e=e.popLast(),t=n.field(e)),t===null?r.delete(e):r.set(e,t),i=i.add(e)}return new fp(e.key,r,new Ju(i.toArray()),rp.none())}}function sp(e,t,n){e instanceof dp?function(e,t,n){let r=e.value.clone(),i=mp(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof fp?function(e,t,n){if(!ip(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=mp(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(pp(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function cp(e,t,n,r){return e instanceof dp?function(e,t,n,r){if(!ip(e.precondition,t))return n;let i=e.value.clone(),a=hp(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof fp?function(e,t,n,r){if(!ip(e.precondition,t))return n;let i=hp(e.fieldTransforms,r,t),a=t.data;return a.setAll(pp(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),n===null?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return ip(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function lp(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=Gf(r.transform,e||null);i!=null&&(n===null&&(n=Nd.empty()),n.set(r.field,i))}return n||null}function up(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return e===void 0&&t===void 0||!(!e||!t)&&cu(e,t,((e,t)=>tp(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var dp=class extends ap{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}},fp=class extends ap{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function pp(e){let t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}})),t}function mp(e,t,n){let r=new Map;P(e.length===n.length,32656,{Ve:n.length,de:e.length});for(let i=0;i<n.length;i++){let a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Wf(o,s,n[i]))}return r}function hp(e,t,n){let r=new Map;for(let i of e){let e=i.transform,a=n.data.field(i.field);r.set(i.field,Uf(e,a,t))}return r}var gp=class extends ap{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},_p=class extends ap{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}},vp=class{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&sp(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=cp(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=cp(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Nf();return this.mutations.forEach((r=>{let i=e.get(r.key),a=i.overlayedDocument,o=this.applyToLocalView(a,i.mutatedFields);o=t.has(r.key)?null:o;let s=op(a,o);s!==null&&n.set(r.key,s),a.isValidDocument()||a.convertToNoDocument(U.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Y())}isEqual(e){return this.batchId===e.batchId&&cu(this.mutations,e.mutations,((e,t)=>up(e,t)))&&cu(this.baseMutations,e.baseMutations,((e,t)=>up(e,t)))}},yp=class e{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(t,n,r){P(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let i=function(){return Ff}(),a=t.mutations;for(let e=0;e<a.length;e++)i=i.insert(a[e].key,r[e].version);return new e(t,n,r,i)}},bp=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}},xp=class{constructor(e,t){this.count=e,this.unchangedNames=t}},X,Z;function Sp(e){switch(e){case I.OK:return N(64938);case I.CANCELLED:case I.UNKNOWN:case I.DEADLINE_EXCEEDED:case I.RESOURCE_EXHAUSTED:case I.INTERNAL:case I.UNAVAILABLE:case I.UNAUTHENTICATED:return!1;case I.INVALID_ARGUMENT:case I.NOT_FOUND:case I.ALREADY_EXISTS:case I.PERMISSION_DENIED:case I.FAILED_PRECONDITION:case I.ABORTED:case I.OUT_OF_RANGE:case I.UNIMPLEMENTED:case I.DATA_LOSS:return!0;default:return N(15467,{code:e})}}function Cp(e){if(e===void 0)return Ul(`GRPC error has no .code`),I.UNKNOWN;switch(e){case X.OK:return I.OK;case X.CANCELLED:return I.CANCELLED;case X.UNKNOWN:return I.UNKNOWN;case X.DEADLINE_EXCEEDED:return I.DEADLINE_EXCEEDED;case X.RESOURCE_EXHAUSTED:return I.RESOURCE_EXHAUSTED;case X.INTERNAL:return I.INTERNAL;case X.UNAVAILABLE:return I.UNAVAILABLE;case X.UNAUTHENTICATED:return I.UNAUTHENTICATED;case X.INVALID_ARGUMENT:return I.INVALID_ARGUMENT;case X.NOT_FOUND:return I.NOT_FOUND;case X.ALREADY_EXISTS:return I.ALREADY_EXISTS;case X.PERMISSION_DENIED:return I.PERMISSION_DENIED;case X.FAILED_PRECONDITION:return I.FAILED_PRECONDITION;case X.ABORTED:return I.ABORTED;case X.OUT_OF_RANGE:return I.OUT_OF_RANGE;case X.UNIMPLEMENTED:return I.UNIMPLEMENTED;case X.DATA_LOSS:return I.DATA_LOSS;default:return N(39323,{code:e})}}(Z=X||={})[Z.OK=0]=`OK`,Z[Z.CANCELLED=1]=`CANCELLED`,Z[Z.UNKNOWN=2]=`UNKNOWN`,Z[Z.INVALID_ARGUMENT=3]=`INVALID_ARGUMENT`,Z[Z.DEADLINE_EXCEEDED=4]=`DEADLINE_EXCEEDED`,Z[Z.NOT_FOUND=5]=`NOT_FOUND`,Z[Z.ALREADY_EXISTS=6]=`ALREADY_EXISTS`,Z[Z.PERMISSION_DENIED=7]=`PERMISSION_DENIED`,Z[Z.UNAUTHENTICATED=16]=`UNAUTHENTICATED`,Z[Z.RESOURCE_EXHAUSTED=8]=`RESOURCE_EXHAUSTED`,Z[Z.FAILED_PRECONDITION=9]=`FAILED_PRECONDITION`,Z[Z.ABORTED=10]=`ABORTED`,Z[Z.OUT_OF_RANGE=11]=`OUT_OF_RANGE`,Z[Z.UNIMPLEMENTED=12]=`UNIMPLEMENTED`,Z[Z.INTERNAL=13]=`INTERNAL`,Z[Z.UNAVAILABLE=14]=`UNAVAILABLE`,Z[Z.DATA_LOSS=15]=`DATA_LOSS`;var wp=null;function Tp(){return new TextEncoder}var Ep=new Dl([4294967295,4294967295],0);function Dp(e){let t=Tp().encode(e),n=new Ol;return n.update(t),new Uint8Array(n.digest())}function Op(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new Dl([n,r],0),new Dl([i,a],0)]}var kp=class e{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ap(`Invalid padding: ${t}`);if(n<0||e.length>0&&this.hashCount===0)throw new Ap(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ap(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Dl.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Dl.fromNumber(n)));return r.compare(Ep)===1&&(r=new Dl([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let[t,n]=Op(Dp(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(t,n,r){let i=t%8==0?0:8-t%8,a=new e(new Uint8Array(Math.ceil(t/8)),i,n);return r.forEach((e=>a.insert(e))),a}insert(e){if(this.ge===0)return;let[t,n]=Op(Dp(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Ap=class extends Error{constructor(){super(...arguments),this.name=`BloomFilterError`}},jp=class e{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,n,r){let i=new Map;return i.set(t,Mp.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(U.min(),i,new G(R),Of(),Y())}},Mp=class e{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,n,r){return new e(r,n,Y(),Y(),Y())}},Np=class{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}},Pp=class{constructor(e,t){this.targetId=e,this.Ce=t}},Fp=class{constructor(e,t,n=Xu.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}},Ip=class{constructor(){this.ve=0,this.Fe=zp(),this.Me=Xu.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Y(),t=Y(),n=Y();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:N(38017,{changeType:i})}})),new Mp(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=zp()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){--this.ve,P(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}},Lp=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=Of(),this.He=Rp(),this.Je=Rp(),this.Ze=new G(R)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:N(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((e,n)=>{this.rt(n)&&t(n)}))}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(cf(i))if(n===0){let e=new B(i.path);this.et(t,e,Fd.newNoDocument(e,U.min()))}else P(n===1,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;if(i!==0){this.it(t);let e=i===2?`TargetPurposeExistenceFilterMismatchBloom`:`TargetPurposeExistenceFilterMismatch`;this.Ze=this.Ze.insert(t,e)}wp?.lt(function(e,t,n,r,i){let a={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},o=t.unchangedNames;return o&&(a.bloomFilter={applied:i===0,hashCount:o?.hashCount??0,bitmapLength:o?.bits?.bitmap?.length??0,padding:o?.bits?.padding??0,mightContain:e=>r?.mightContain(e)??!1}),a}(r,e.Ce,this.Ge.ht(),n,i))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n=``,padding:r=0},hashCount:i=0}=t,a,o;try{a=$u(n).toUint8Array()}catch(e){if(e instanceof Yu)return Wl(`Decoding the base64 bloom filter in existence filter failed (`+e.message+`); ignoring the bloom filter and falling back to full re-query.`),null;throw e}try{o=new kp(a,r,i)}catch(e){return Wl(e instanceof Ap?`BloomFilter error: `:`Applying bloom filter failed: `,e),null}return o.ge===0?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach((n=>{let i=this.Ge.ht(),a=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(a)||(this.et(t,n,null),r++)})),r}Tt(e){let t=new Map;this.ze.forEach(((n,r)=>{let i=this.ot(r);if(i){if(n.current&&cf(i.target)){let t=new B(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Fd.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.Ke())}}));let n=Y();this.Je.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{let t=this.ot(e);return!t||t.purpose===`TargetPurposeLimboResolution`||(r=!1,!1)})),r&&(n=n.add(e))})),this.je.forEach(((t,n)=>n.setReadTime(e)));let r=new jp(e,t,this.Ze,this.je,n);return this.je=Of(),this.He=Rp(),this.Je=Rp(),this.Ze=new G(R),r}Ye(e,t){if(!this.rt(e))return;let n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ip,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new K(R),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new K(R),this.He=this.He.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||M(`WatchChangeAggregator`,`Detected inactive target`,e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ip),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function Rp(){return new G(B.comparator)}function zp(){return new G(B.comparator)}var Bp=(()=>({asc:`ASCENDING`,desc:`DESCENDING`}))(),Vp=(()=>({"<":`LESS_THAN`,"<=":`LESS_THAN_OR_EQUAL`,">":`GREATER_THAN`,">=":`GREATER_THAN_OR_EQUAL`,"==":`EQUAL`,"!=":`NOT_EQUAL`,"array-contains":`ARRAY_CONTAINS`,in:`IN`,"not-in":`NOT_IN`,"array-contains-any":`ARRAY_CONTAINS_ANY`}))(),Hp=(()=>({and:`AND`,or:`OR`}))(),Up=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Wp(e,t){return e.useProto3Json||Fu(t)?t:{value:t}}function Gp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,``).replace(`Z`,``)}.${(`000000000`+t.nanoseconds).slice(-9)}Z`:{seconds:``+t.seconds,nanos:t.nanoseconds}}function Kp(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function qp(e,t){return Gp(e,t.toTimestamp())}function Jp(e){return P(!!e,49232),U.fromTimestamp(function(e){let t=Qu(e);return new H(t.seconds,t.nanos)}(e))}function Yp(e,t){return Xp(e,t).canonicalString()}function Xp(e,t){let n=function(e){return new z([`projects`,e.projectId,`databases`,e.database])}(e).child(`documents`);return t===void 0?n:n.child(t)}function Zp(e){let t=z.fromString(e);return P(bm(t),10190,{key:t.toString()}),t}function Qp(e,t){return Yp(e.databaseId,t.path)}function $p(e,t){let n=Zp(t);if(n.get(1)!==e.databaseId.projectId)throw new L(I.INVALID_ARGUMENT,`Tried to deserialize key from different project: `+n.get(1)+` vs `+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new L(I.INVALID_ARGUMENT,`Tried to deserialize key from different database: `+n.get(3)+` vs `+e.databaseId.database);return new B(rm(n))}function em(e,t){return Yp(e.databaseId,t)}function tm(e){let t=Zp(e);return t.length===4?z.emptyPath():rm(t)}function nm(e){return new z([`projects`,e.databaseId.projectId,`databases`,e.databaseId.database]).canonicalString()}function rm(e){return P(e.length>4&&e.get(4)===`documents`,29091,{key:e.toString()}),e.popFirst(5)}function im(e,t,n){return{name:Qp(e,t),fields:n.value.mapValue.fields}}function am(e,t){let n;if(`targetChange`in t){t.targetChange;let r=function(e){return e===`NO_CHANGE`?0:e===`ADD`?1:e===`REMOVE`?2:e===`CURRENT`?3:e===`RESET`?4:N(39313,{state:e})}(t.targetChange.targetChangeType||`NO_CHANGE`),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(P(t===void 0||typeof t==`string`,58123),Xu.fromBase64String(t||``)):(P(t===void 0||t instanceof Buffer||t instanceof Uint8Array,16193),Xu.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause;n=new Fp(r,i,a,o&&function(e){return new L(e.code===void 0?I.UNKNOWN:Cp(e.code),e.message||``)}(o)||null)}else if(`documentChange`in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=$p(e,r.document.name),a=Jp(r.document.updateTime),o=r.document.createTime?Jp(r.document.createTime):U.min(),s=new Nd({mapValue:{fields:r.document.fields}}),c=Fd.newFoundDocument(i,a,o,s);n=new Np(r.targetIds||[],r.removedTargetIds||[],c.key,c)}else if(`documentDelete`in t){t.documentDelete;let r=t.documentDelete;r.document;let i=$p(e,r.document),a=r.readTime?Jp(r.readTime):U.min(),o=Fd.newNoDocument(i,a);n=new Np([],r.removedTargetIds||[],o.key,o)}else if(`documentRemove`in t){t.documentRemove;let r=t.documentRemove;r.document;let i=$p(e,r.document);n=new Np([],r.removedTargetIds||[],i,null)}else{if(!(`filter`in t))return N(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,a=new xp(r,i),o=e.targetId;n=new Pp(o,a)}}return n}function om(e,t){let n;if(t instanceof dp)n={update:im(e,t.key,t.value)};else if(t instanceof gp)n={delete:Qp(e,t.key)};else if(t instanceof fp)n={update:im(e,t.key,t.data),updateMask:ym(t.fieldMask)};else{if(!(t instanceof _p))return N(16599,{dt:t.type});n={verify:Qp(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){let n=t.transform;if(n instanceof Kf)return{fieldPath:t.field.canonicalString(),setToServerValue:`REQUEST_TIME`};if(n instanceof qf)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Yf)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Zf)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw N(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return t.updateTime===void 0?t.exists===void 0?N(27497):{exists:t.exists}:{updateTime:qp(e,t.updateTime)}}(e,t.precondition)),n}function sm(e,t){return e&&e.length>0?(P(t!==void 0,14353),e.map((e=>function(e,t){let n=e.updateTime?Jp(e.updateTime):Jp(t);return n.isEqual(U.min())&&(n=Jp(t)),new np(n,e.transformResults||[])}(e,t)))):[]}function cm(e,t){return{documents:[em(e,t.path)]}}function lm(e,t){let n={structuredQuery:{}},r=t.path,i;t.collectionGroup===null?(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]):(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]),n.parent=em(e,i);let a=function(e){if(e.length!==0)return vm(Hd.create(e,`and`))}(t.filters);a&&(n.structuredQuery.where=a);let o=function(e){if(e.length!==0)return e.map((e=>function(e){return{field:gm(e.field),direction:pm(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);let s=Wp(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function um(e){let t=tm(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){P(r===1,65062);let e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let a=[];n.where&&(a=function(e){let t=fm(e);return t instanceof Hd&&Wd(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new zd(_m(e.field),function(e){switch(e){case`ASCENDING`:return`asc`;case`DESCENDING`:return`desc`;default:return}}(e.direction))}(e)))}(n.orderBy));let s=null;n.limit&&(s=function(e){let t;return t=typeof e==`object`?e.value:e,Fu(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){let t=!!e.before;return new Id(e.values||[],t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){let t=!e.before;return new Id(e.values||[],t)}(n.endAt)),uf(t,i,o,a,s,`F`,c,l)}function dm(e,t){let n=function(e){switch(e){case`TargetPurposeListen`:return null;case`TargetPurposeExistenceFilterMismatch`:return`existence-filter-mismatch`;case`TargetPurposeExistenceFilterMismatchBloom`:return`existence-filter-mismatch-bloom`;case`TargetPurposeLimboResolution`:return`limbo-document`;default:return N(28987,{purpose:e})}}(t.purpose);return n==null?null:{"goog-listen-tags":n}}function fm(e){return e.unaryFilter===void 0?e.fieldFilter===void 0?e.compositeFilter===void 0?N(30097,{filter:e}):function(e){return Hd.create(e.compositeFilter.filters.map((e=>fm(e))),function(e){switch(e){case`AND`:return`and`;case`OR`:return`or`;default:return N(1026)}}(e.compositeFilter.op))}(e):function(e){return J.create(_m(e.fieldFilter.field),function(e){switch(e){case`EQUAL`:return`==`;case`NOT_EQUAL`:return`!=`;case`GREATER_THAN`:return`>`;case`GREATER_THAN_OR_EQUAL`:return`>=`;case`LESS_THAN`:return`<`;case`LESS_THAN_OR_EQUAL`:return`<=`;case`ARRAY_CONTAINS`:return`array-contains`;case`IN`:return`in`;case`NOT_IN`:return`not-in`;case`ARRAY_CONTAINS_ANY`:return`array-contains-any`;case`OPERATOR_UNSPECIFIED`:return N(58110);default:return N(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):function(e){switch(e.unaryFilter.op){case`IS_NAN`:let t=_m(e.unaryFilter.field);return J.create(t,`==`,{doubleValue:NaN});case`IS_NULL`:let n=_m(e.unaryFilter.field);return J.create(n,`==`,{nullValue:`NULL_VALUE`});case`IS_NOT_NAN`:let r=_m(e.unaryFilter.field);return J.create(r,`!=`,{doubleValue:NaN});case`IS_NOT_NULL`:let i=_m(e.unaryFilter.field);return J.create(i,`!=`,{nullValue:`NULL_VALUE`});case`OPERATOR_UNSPECIFIED`:return N(61313);default:return N(60726)}}(e)}function pm(e){return Bp[e]}function mm(e){return Vp[e]}function hm(e){return Hp[e]}function gm(e){return{fieldPath:e.canonicalString()}}function _m(e){return fu.fromServerFormat(e.fieldPath)}function vm(e){return e instanceof J?function(e){if(e.op===`==`){if(Od(e.value))return{unaryFilter:{field:gm(e.field),op:`IS_NAN`}};if(Dd(e.value))return{unaryFilter:{field:gm(e.field),op:`IS_NULL`}}}else if(e.op===`!=`){if(Od(e.value))return{unaryFilter:{field:gm(e.field),op:`IS_NOT_NAN`}};if(Dd(e.value))return{unaryFilter:{field:gm(e.field),op:`IS_NOT_NULL`}}}return{fieldFilter:{field:gm(e.field),op:mm(e.op),value:e.value}}}(e):e instanceof Hd?function(e){let t=e.getFilters().map((e=>vm(e)));return t.length===1?t[0]:{compositeFilter:{op:hm(e.op),filters:t}}}(e):N(54877,{filter:e})}function ym(e){let t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function bm(e){return e.length>=4&&e.get(0)===`projects`&&e.get(2)===`databases`}function xm(e){return!!e&&typeof e._toProto==`function`&&e._protoValueType===`ProtoValue`}var Sm=class e{constructor(e,t,n,r,i=U.min(),a=U.min(),o=Xu.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=s}withSequenceNumber(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}},Cm=class{constructor(e){this.yt=e}};function wm(e){let t=um({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType===`LAST`?vf(t,t.limit,`L`):t}var Tm=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if(`nullValue`in e)this.Ft(t,5);else if(`booleanValue`in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if(`integerValue`in e)this.Ft(t,15),t.Mt(q(e.integerValue));else if(`doubleValue`in e){let n=q(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Iu(n)?t.Mt(0):t.Mt(n))}else if(`timestampValue`in e){let n=e.timestampValue;this.Ft(t,20),typeof n==`string`&&(n=Qu(n)),t.xt(`${n.seconds||``}`),t.Mt(n.nanos||0)}else if(`stringValue`in e)this.Ot(e.stringValue,t),this.Nt(t);else if(`bytesValue`in e)this.Ft(t,30),t.Bt($u(e.bytesValue)),this.Nt(t);else if(`referenceValue`in e)this.Lt(e.referenceValue,t);else if(`geoPointValue`in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else `mapValue`in e?Md(e)?this.Ft(t,2**53-1):Ad(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):`arrayValue`in e?(this.qt(e.arrayValue,t),this.Nt(t)):N(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let n=e.fields||{};this.Ft(t,55);for(let e of Object.keys(n))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=hd,i=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(q(i)),this.Ot(r,t),this.Ct(n[r],t)}qt(e,t){let n=e.values||[];this.Ft(t,50);for(let e of n)this.Ct(e,t)}Lt(e,t){this.Ft(t,37),B.fromName(e).path.forEach((e=>{this.Ft(t,60),this.$t(e,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};Tm.Wt=new Tm;var Em=class{constructor(){this.Sn=new Dm}addToCollectionParentIndex(e,t){return this.Sn.add(t),W.resolve()}getCollectionParents(e,t){return W.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return W.resolve()}deleteFieldIndex(e,t){return W.resolve()}deleteAllFieldIndexes(e){return W.resolve()}createTargetIndexes(e,t){return W.resolve()}getDocumentsMatchingTarget(e,t){return W.resolve(null)}getIndexType(e,t){return W.resolve(0)}getFieldIndexes(e,t){return W.resolve([])}getNextCollectionGroupToUpdate(e){return W.resolve(null)}getMinOffset(e,t){return W.resolve(Eu.min())}getMinOffsetFromCollectionGroup(e,t){return W.resolve(Eu.min())}updateCollectionGroup(e,t,n){return W.resolve()}updateIndexEntries(e,t){return W.resolve()}},Dm=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new K(z.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new K(z.comparator)).toArray()}};new Uint8Array;var Om={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},km=41943040,Am=class e{static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};Am.DEFAULT_COLLECTION_PERCENTILE=10,Am.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Am.DEFAULT=new Am(km,Am.DEFAULT_COLLECTION_PERCENTILE,Am.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Am.DISABLED=new Am(-1,0,0);var jm=class e{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new e(0)}static ar(){return new e(-1)}},Mm=`LruGarbageCollector`,Nm=1048576;function Pm([e,t],[n,r]){let i=R(e,n);return i===0?R(t,r):i}var Fm=class{constructor(e){this.Pr=e,this.buffer=new K(Pm),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();Pm(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}},Im=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&=(this.Rr.cancel(),null)}get started(){return this.Rr!==null}Ar(e){M(Mm,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay(`lru_garbage_collection`,e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Mu(e)?M(Mm,`Ignoring IndexedDB error during garbage collection: `,e):await Au(e)}await this.Ar(3e5)}))}},Lm=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(t===0)return W.resolve(Nu.ce);let n=new Fm(t);return this.Vr.forEachTarget(e,(e=>n.Er(e.sequenceNumber))).next((()=>this.Vr.mr(e,(e=>n.Er(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M(`LruGarbageCollector`,`Garbage collection skipped; disabled`),W.resolve(Om)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(M(`LruGarbageCollector`,`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Om):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,i,a,o,s,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(M(`LruGarbageCollector`,`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,s=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Hl()<=b.DEBUG&&M(`LruGarbageCollector`,`LRU Garbage Collection\n\tCounted targets in ${a-l}ms\n\tDetermined least recently used ${r} in `+(o-a)+`ms
\tRemoved ${i} targets in `+(s-o)+`ms
\tRemoved ${e} documents in `+(c-s)+`ms
Total Duration: ${c-l}ms`),W.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}};function Rm(e,t){return new Lm(e,t)}var zm=class{constructor(){this.changes=new Ef((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fd.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n===void 0?this.getFromCache(e,t):W.resolve(n)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}},Bm=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}},Vm=class{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(n!==null&&cp(n.mutation,e,Ju.empty(),H.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Y()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Y()){let r=Mf();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=Af();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){let n=Mf();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Y())))}populateOverlays(e,t,n){let r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Of(),a=Pf(),o=function(){return Pf()}();return t.forEach(((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(o===void 0||o.mutation instanceof fp)?i=i.insert(t.key,t):o===void 0?a.set(t.key,Ju.empty()):(a.set(t.key,o.mutation.getFieldMask()),cp(o.mutation,t,o.mutation.getFieldMask(),H.now()))})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>a.set(e,t))),t.forEach(((e,t)=>o.set(e,new Bm(t,a.get(e)??null)))),o)))}recalculateAndSaveOverlays(e,t){let n=Pf(),r=new G(((e,t)=>e-t)),i=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(let i of e)i.keys().forEach((e=>{let a=t.get(e);if(a===null)return;let o=n.get(e)||Ju.empty();o=i.applyToLocalView(a,o),n.set(e,o);let s=(r.get(i.batchId)||Y()).add(e);r=r.insert(i.batchId,s)}))})).next((()=>{let a=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),s=r.key,c=r.value,l=Nf();c.forEach((e=>{if(!i.has(e)){let r=op(t.get(e),n.get(e));r!==null&&l.set(e,r),i=i.add(e)}})),a.push(this.documentOverlayCache.saveOverlays(e,s,l))}return W.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return pf(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):mf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{let a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):W.resolve(Mf()),o=Su,s=i;return a.next((t=>W.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?W.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{s=s.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,s,t,Y()))).next((e=>({batchId:o,changes:jf(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((e=>{let t=Af();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,a=Af();return this.indexManager.getCollectionParents(e,i).next((o=>W.forEach(o,(o=>{let s=function(e,t){return new lf(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,s,n,r).next((e=>{e.forEach(((e,t)=>{a=a.insert(e,t)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{let r=n.getKey();e.get(r)===null&&(e=e.insert(r,Fd.newInvalidDocument(r)))}));let n=Af();return e.forEach(((e,r)=>{let a=i.get(e);a!==void 0&&cp(a.mutation,r,Ju.empty(),H.now()),Sf(t,r)&&(n=n.insert(e,r))})),n}))}},Hm=class{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return W.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Jp(e.createTime)}}(t)),W.resolve()}getNamedQuery(e,t){return W.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(e){return{name:e.name,query:wm(e.bundledQuery),readTime:Jp(e.readTime)}}(t)),W.resolve()}},Um=class{constructor(){this.overlays=new G(B.comparator),this.Lr=new Map}getOverlay(e,t){return W.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Mf();return W.forEach(t,(t=>this.getOverlay(e,t).next((e=>{e!==null&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.bt(e,t,r)})),W.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Lr.get(n);return r!==void 0&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Lr.delete(n)),W.resolve()}getOverlaysForCollection(e,t,n){let r=Mf(),i=t.length+1,a=new B(t.child(``)),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){let e=o.getNext().value,a=e.getKey();if(!t.isPrefixOf(a.path))break;a.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return W.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new G(((e,t)=>e-t)),a=this.overlays.getIterator();for(;a.hasNext();){let e=a.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);t===null&&(t=Mf(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=Mf(),s=i.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return W.resolve(o)}bt(e,t,n){let r=this.overlays.get(n.key);if(r!==null){let e=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new bp(t,n));let i=this.Lr.get(t);i===void 0&&(i=Y(),this.Lr.set(t,i)),this.Lr.set(t,i.add(n.key))}},Wm=class{constructor(){this.sessionToken=Xu.EMPTY_BYTE_STRING}getSessionToken(e){return W.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,W.resolve()}},Gm=class{constructor(){this.kr=new K(Q.Kr),this.qr=new K(Q.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let n=new Q(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Wr(new Q(e,t))}Qr(e,t){e.forEach((e=>this.removeReference(e,t)))}Gr(e){let t=new B(new z([])),n=new Q(t,e),r=new Q(t,e+1),i=[];return this.qr.forEachInRange([n,r],(e=>{this.Wr(e),i.push(e.key)})),i}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new B(new z([])),n=new Q(t,e),r=new Q(t,e+1),i=Y();return this.qr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){let t=new Q(e,0),n=this.kr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Q=class{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return B.comparator(e.key,t.key)||R(e.Hr,t.Hr)}static Ur(e,t){return R(e.Hr,t.Hr)||B.comparator(e.key,t.key)}},Km=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new K(Q.Kr)}checkEmpty(e){return W.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new vp(i,t,n,r);this.mutationQueue.push(a);for(let t of r)this.Jr=this.Jr.add(new Q(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return W.resolve(a)}lookupMutationBatch(e,t){return W.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=this.Xr(n),i=r<0?0:r;return W.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return W.resolve(this.mutationQueue.length===0?Pu:this.Yn-1)}getAllMutationBatches(e){return W.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Q(t,0),r=new Q(t,1/0),i=[];return this.Jr.forEachInRange([n,r],(e=>{let t=this.Zr(e.Hr);i.push(t)})),W.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new K(R);return t.forEach((e=>{let t=new Q(e,0),r=new Q(e,1/0);this.Jr.forEachInRange([t,r],(e=>{n=n.add(e.Hr)}))})),W.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;B.isDocumentKey(i)||(i=i.child(``));let a=new Q(new B(i),0),o=new K(R);return this.Jr.forEachWhile((e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Hr)),!0)}),a),W.resolve(this.Yr(o))}Yr(e){let t=[];return e.forEach((e=>{let n=this.Zr(e);n!==null&&t.push(n)})),t}removeMutationBatch(e,t){P(this.ei(t.batchId,`removed`)===0,55003),this.mutationQueue.shift();let n=this.Jr;return W.forEach(t.mutations,(r=>{let i=new Q(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Jr=n}))}nr(e){}containsKey(e,t){let n=new Q(t,0),r=this.Jr.firstAfterOrEqual(n);return W.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,W.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}},qm=class{constructor(e){this.ti=e,this.docs=function(){return new G(B.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return W.resolve(n?n.document.mutableCopy():Fd.newInvalidDocument(t))}getEntries(e,t){let n=Of();return t.forEach((e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Fd.newInvalidDocument(e))})),W.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Of(),a=t.path,o=new B(a.child(`__id-9223372036854775808__`)),s=this.docs.getIteratorFrom(o);for(;s.hasNext();){let{key:e,value:{document:o}}=s.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||Du(Tu(o),n)<=0||(r.has(o.key)||Sf(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return W.resolve(i)}getAllFromCollectionGroup(e,t,n,r){N(9500)}ni(e,t){return W.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Jm(this)}getSize(e){return W.resolve(this.size)}},Jm=class extends zm{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)})),W.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}},Ym=class{constructor(e){this.persistence=e,this.ri=new Ef((e=>of(e)),sf),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ii=0,this.si=new Gm,this.targetCount=0,this.oi=jm._r()}forEachTarget(e,t){return this.ri.forEach(((e,n)=>t(n))),W.resolve()}getLastRemoteSnapshotVersion(e){return W.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return W.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),W.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),W.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new jm(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,W.resolve()}updateTargetData(e,t){return this.lr(t),W.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),--this.targetCount,W.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.ri.forEach(((a,o)=>{o.sequenceNumber<=t&&n.get(o.targetId)===null&&(this.ri.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),W.waitFor(i).next((()=>r))}getTargetCount(e){return W.resolve(this.targetCount)}getTargetData(e,t){let n=this.ri.get(t)||null;return W.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),W.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),W.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),W.resolve()}getMatchingKeysForTargetId(e,t){let n=this.si.jr(t);return W.resolve(n)}containsKey(e,t){return W.resolve(this.si.containsKey(t))}},Xm=class{constructor(e,t){this._i={},this.overlays={},this.ai=new Nu(0),this.ui=!1,this.ui=!0,this.ci=new Wm,this.referenceDelegate=e(this),this.li=new Ym(this),this.indexManager=new Em,this.remoteDocumentCache=function(e){return new qm(e)}((e=>this.referenceDelegate.hi(e))),this.serializer=new Cm(t),this.Pi=new Hm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Um,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new Km(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){M(`MemoryPersistence`,`Starting transaction:`,e);let r=new Zm(this.ai.next());return this.referenceDelegate.Ti(),n(r).next((e=>this.referenceDelegate.Ii(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ei(e,t){return W.or(Object.values(this._i).map((n=>()=>n.containsKey(e,t))))}},Zm=class extends ku{constructor(e){super(),this.currentSequenceNumber=e}},Qm=class e{constructor(e){this.persistence=e,this.Ri=new Gm,this.Ai=null}static Vi(t){return new e(t)}get di(){if(this.Ai)return this.Ai;throw N(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),W.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),W.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),W.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((e=>this.di.add(e.toString())));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.di.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return W.forEach(this.di,(n=>{let r=B.fromPath(n);return this.mi(e,r).next((e=>{e||t.removeEntry(r,U.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return W.or([()=>W.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},$m=class e{constructor(e,t){this.persistence=e,this.fi=new Ef((e=>zu(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=Rm(this,t)}static Vi(t,n){return new e(t,n)}Ti(){}Ii(e){return W.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}pr(e){let t=0;return this.mr(e,(e=>{t++})).next((()=>t))}mr(e,t){return W.forEach(this.fi,((n,r)=>this.wr(e,n,r).next((e=>e?W.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ni(e,(r=>this.wr(e,r,t).next((e=>{e||(n++,i.removeEntry(r,U.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),W.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),W.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),W.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),W.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wd(e.data.value)),t}wr(e,t,n){return W.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return W.resolve(e!==void 0&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}},eh=class e{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(t,n){let r=Y(),i=Y();for(let e of n.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new e(t,n.fromCache,r,i)}},th=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}},nh=class{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return he()?8:ju(g())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.gs(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ps(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;let n=new th;return this.ys(e,t,n).next((r=>{if(i.result=r,this.As)return this.ws(e,t,n,r.size)}))})).next((()=>i.result))}ws(e,t,n,r){return n.documentReadCount<this.Vs?(Hl()<=b.DEBUG&&M(`QueryEngine`,`SDK will not create cache indexes for query:`,xf(t),`since it only creates cache indexes for collection contains`,`more than or equal to`,this.Vs,`documents`),W.resolve()):(Hl()<=b.DEBUG&&M(`QueryEngine`,`Query:`,xf(t),`scans`,n.documentReadCount,`local documents and returns`,r,`documents as results.`),n.documentReadCount>this.ds*r?(Hl()<=b.DEBUG&&M(`QueryEngine`,`The SDK decides to create cache indexes for query:`,xf(t),`as using cache indexes may help improve performance.`),this.indexManager.createTargetIndexes(e,gf(t))):W.resolve())}gs(e,t){if(ff(t))return W.resolve(null);let n=gf(t);return this.indexManager.getIndexType(e,n).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=vf(t,null,`F`),n=gf(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{let i=Y(...r);return this.fs.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{let a=this.bs(t,r);return this.Ss(t,a,i,n.readTime)?this.gs(e,vf(t,null,`F`)):this.Ds(e,a,t,n)}))))})))))}ps(e,t,n,r){return ff(t)||r.isEqual(U.min())?W.resolve(null):this.fs.getDocuments(e,n).next((i=>{let a=this.bs(t,i);return this.Ss(t,a,n,r)?W.resolve(null):(Hl()<=b.DEBUG&&M(`QueryEngine`,`Re-using previous result from %s to execute query: %s`,r.toString(),xf(t)),this.Ds(e,a,t,wu(r,Su)).next((e=>e)))}))}bs(e,t){let n=new K(wf(e));return t.forEach(((t,r)=>{Sf(e,r)&&(n=n.add(r))})),n}Ss(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let i=e.limitType===`F`?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ys(e,t,n){return Hl()<=b.DEBUG&&M(`QueryEngine`,`Using full collection scan to execute query:`,xf(t)),this.fs.getDocumentsMatchingQuery(e,t,Eu.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}},rh=`LocalStore`,ih=3e8,ah=class{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new G(R),this.Fs=new Ef((e=>of(e)),sf),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vm(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction(`Collect garbage`,`readwrite-primary`,(t=>e.collect(t,this.vs)))}};function oh(e,t,n,r){return new ah(e,t,n,r)}async function sh(e,t){let n=F(e);return await n.persistence.runTransaction(`Handle user change`,`readonly`,(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Os(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{let i=[],a=[],o=Y();for(let e of r){i.push(e.batchId);for(let t of e.mutations)o=o.add(t.key)}for(let e of t){a.push(e.batchId);for(let t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Ns:e,removedBatchIds:i,addedBatchIds:a})))}))}))}function ch(e,t){let n=F(e);return n.persistence.runTransaction(`Acknowledge batch`,`readwrite-primary`,(e=>{let r=t.batch.keys(),i=n.xs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){let i=n.batch,a=i.keys(),o=W.resolve();return a.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{let a=n.docVersions.get(e);P(a!==null,48541),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Y();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}function lh(e){let t=F(e);return t.persistence.runTransaction(`Get last remote snapshot version`,`readonly`,(e=>t.li.getLastRemoteSnapshotVersion(e)))}function uh(e,t){let n=F(e),r=t.snapshotVersion,i=n.vs;return n.persistence.runTransaction(`Apply remote event`,`readwrite-primary`,(e=>{let a=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;let o=[];t.targetChanges.forEach(((a,s)=>{let c=i.get(s);if(!c)return;o.push(n.li.removeMatchingKeys(e,a.removedDocuments,s).next((()=>n.li.addMatchingKeys(e,a.addedDocuments,s))));let l=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.get(s)===null?a.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(a.resumeToken,r)):l=l.withResumeToken(Xu.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()),i=i.insert(s,l),function(e,t,n){return e.resumeToken.approximateByteSize()===0||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=ih?!0:n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,a)&&o.push(n.li.updateTargetData(e,l))}));let s=Of(),c=Y();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(dh(e,a,t.documentUpdates).next((e=>{s=e.Bs,c=e.Ls}))),!r.isEqual(U.min())){let t=n.li.getLastRemoteSnapshotVersion(e).next((t=>n.li.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return W.waitFor(o).next((()=>a.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,s,c))).next((()=>s))})).then((e=>(n.vs=i,e)))}function dh(e,t,n){let r=Y(),i=Y();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Of();return n.forEach(((n,a)=>{let o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(U.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||a.version.compareTo(o.version)===0&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):M(rh,`Ignoring outdated watch update for `,n,`. Current version:`,o.version,` Watch version:`,a.version)})),{Bs:r,Ls:i}}))}function fh(e,t){let n=F(e);return n.persistence.runTransaction(`Get next mutation batch`,`readonly`,(e=>(t===void 0&&(t=Pu),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function ph(e,t){let n=F(e);return n.persistence.runTransaction(`Allocate target`,`readwrite`,(e=>{let r;return n.li.getTargetData(e,t).next((i=>i?(r=i,W.resolve(r)):n.li.allocateTargetId(e).next((i=>(r=new Sm(t,i,`TargetPurposeListen`,e.currentSequenceNumber),n.li.addTargetData(e,r).next((()=>r)))))))})).then((e=>{let r=n.vs.get(e.targetId);return(r===null||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.vs=n.vs.insert(e.targetId,e),n.Fs.set(t,e.targetId)),e}))}async function mh(e,t,n){let r=F(e),i=r.vs.get(t),a=n?`readwrite`:`readwrite-primary`;try{n||await r.persistence.runTransaction(`Release target`,a,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Mu(e))throw e;M(rh,`Failed to update sequence numbers for target ${t}: ${e}`)}r.vs=r.vs.remove(t),r.Fs.delete(i.target)}function hh(e,t,n){let r=F(e),i=U.min(),a=Y();return r.persistence.runTransaction(`Execute query`,`readwrite`,(e=>function(e,t,n){let r=F(e),i=r.Fs.get(n);return i===void 0?r.li.getTargetData(t,n):W.resolve(r.vs.get(i))}(r,e,gf(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(e,t.targetId).next((e=>{a=e}))})).next((()=>r.Cs.getDocumentsMatchingQuery(e,t,n?i:U.min(),n?a:Y()))).next((e=>(gh(r,Cf(t),e),{documents:e,ks:a})))))}function gh(e,t,n){let r=e.Ms.get(t)||U.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ms.set(t,r)}var _h=class{constructor(){this.activeTargetIds=Rf()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},vh=class{constructor(){this.vo=new _h,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||`not-current`}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new _h,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}},yh=class{Mo(e){}shutdown(){}},bh=`ConnectivityMonitor`,xh=class{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener(`online`,this.xo),window.removeEventListener(`offline`,this.No)}ko(){window.addEventListener(`online`,this.xo),window.addEventListener(`offline`,this.No)}Oo(){M(bh,`Network connectivity changed: AVAILABLE`);for(let e of this.Lo)e(0)}Bo(){M(bh,`Network connectivity changed: UNAVAILABLE`);for(let e of this.Lo)e(1)}static v(){return typeof window<`u`&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}},Sh=null;function Ch(){return Sh===null?Sh=function(){return 268435456+Math.round(2147483648*Math.random())}():Sh++,`0x`+Sh.toString(16)}var wh=`RestConnection`,Th={BatchGetDocuments:`batchGet`,Commit:`commit`,RunQuery:`runQuery`,RunAggregationQuery:`runAggregationQuery`,ExecutePipeline:`executePipeline`},Eh=class{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?`https`:`http`,n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+`://`+e.host,this.Uo=`projects/${n}/databases/${r}`,this.$o=this.databaseId.database===cd?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,i){let a=Ch(),o=this.Qo(e,t.toUriEncodedString());M(wh,`Sending RPC '${e}' ${a}:`,o,n);let s={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(s,r,i);let{host:c}=new URL(o),l=ne(c);return this.zo(e,o,s,n,l).then((t=>(M(wh,`Received RPC '${e}' ${a}: `,t),t)),(t=>{throw Wl(wh,`RPC '${e}' ${a} failed with error: `,t,`url: `,o,`request:`,n),t}))}jo(e,t,n,r,i,a){return this.Wo(e,t,n,r,i)}Go(e,t,n){e[`X-Goog-Api-Client`]=function(){return`gl-js/ fire/`+zl}(),e[`Content-Type`]=`text/plain`,this.databaseInfo.appId&&(e[`X-Firebase-GMPID`]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}Qo(e,t){let n=Th[e],r=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}},Dh=class{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}},$=`WebChannelConnection`,Oh=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))},kh=class e extends Eh{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){e.c_||=(Oh(Ll(),Il.STAT_EVENT,(e=>{e.stat===Fl.PROXY?M($,`STAT_EVENT: detected buffering proxy`):e.stat===Fl.NOPROXY&&M($,`STAT_EVENT: detected no buffering proxy`)})),!0)}zo(e,t,n,r,i){let a=Ch();return new Promise(((i,o)=>{let s=new jl;s.setWithCredentials(!0),s.listenOnce(Nl.COMPLETE,(()=>{try{switch(s.getLastErrorCode()){case Pl.NO_ERROR:let t=s.getResponseJson();M($,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(t)),i(t);break;case Pl.TIMEOUT:M($,`RPC '${e}' ${a} timed out`),o(new L(I.DEADLINE_EXCEEDED,`Request time out`));break;case Pl.HTTP_ERROR:let n=s.getStatus();if(M($,`RPC '${e}' ${a} failed with status:`,n,`response text:`,s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;t&&t.status&&t.message?o(new L(function(e){let t=e.toLowerCase().replace(/_/g,`-`);return Object.values(I).indexOf(t)>=0?t:I.UNKNOWN}(t.status),t.message)):o(new L(I.UNKNOWN,`Server responded with status `+s.getStatus()))}else o(new L(I.UNAVAILABLE,`Connection failed.`));break;default:N(9055,{l_:e,streamId:a,h_:s.getLastErrorCode(),P_:s.getLastError()})}}finally{M($,`RPC '${e}' ${a} completed.`)}}));let c=JSON.stringify(r);M($,`RPC '${e}' ${a} sending request:`,r),s.send(t,`POST`,c,n,15)}))}T_(t,n,r){let i=Ch(),a=[this.qo,`/`,`google.firestore.v1.Firestore`,`/`,t,`/channel`],o=this.createWebChannelTransport(),s={httpSessionIdParam:`gsessionid`,initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Go(s.initMessageHeaders,n,r),s.encodeInitMessageHeaders=!0;let l=a.join(``);M($,`Creating RPC '${t}' stream ${i}: ${l}`,s);let u=o.createWebChannel(l,s);this.I_(u);let d=!1,f=!1,p=new Dh({Ho:e=>{f?M($,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(d||=(M($,`Opening RPC '${t}' stream ${i} transport.`),u.open(),!0),M($,`RPC '${t}' stream ${i} sending:`,e),u.send(e))},Jo:()=>u.close()});return Oh(u,Ml.EventType.OPEN,(()=>{f||(M($,`RPC '${t}' stream ${i} transport opened.`),p.i_())})),Oh(u,Ml.EventType.CLOSE,(()=>{f||(f=!0,M($,`RPC '${t}' stream ${i} transport closed`),p.o_(),this.E_(u))})),Oh(u,Ml.EventType.ERROR,(e=>{f||(f=!0,Wl($,`RPC '${t}' stream ${i} transport errored. Name:`,e.name,`Message:`,e.message),p.o_(new L(I.UNAVAILABLE,`The operation could not be completed`)))})),Oh(u,Ml.EventType.MESSAGE,(e=>{if(!f){let n=e.data[0];P(!!n,16349);let r=n,a=r?.error||r[0]?.error;if(a){M($,`RPC '${t}' stream ${i} received error:`,a);let e=a.status,n=function(e){let t=X[e];if(t!==void 0)return Cp(t)}(e),r=a.message;n===void 0&&(n=I.INTERNAL,r=`Unknown error status: `+e+` with message `+a.message),f=!0,p.o_(new L(n,r)),u.close()}else M($,`RPC '${t}' stream ${i} received:`,n),p.__(n)}})),e.u_(),setTimeout((()=>{p.s_()}),0),p}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e[`x-goog-api-key`]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Rl()}};function Ah(e){return new kh(e)}function jh(){return typeof document<`u`?document:null}function Mh(e){return new Up(e,!0)}kh.c_=!1;var Nh=class{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&M(`ExponentialBackoff`,`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}},Ph=`PersistentStream`,Fh=class{constructor(e,t,n,r,i,a,o,s){this.Ci=e,this.b_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Nh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state===4?this.N_():this.auth()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&=(this.C_.cancel(),null)}U_(){this.v_&&=(this.v_.cancel(),null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e===4?t&&t.code===I.RESOURCE_EXHAUSTED?(Ul(t.toString()),Ul(`Using maximum backoff delay to prevent overloading the backend.`),this.M_.g_()):t&&t.code===I.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()):this.M_.reset(),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.D_===t&&this.G_(e,n)}),(t=>{e((()=>{let e=new L(I.UNKNOWN,`Fetching auth token failed: `+t.message);return this.z_(e)}))}))}G_(e,t){let n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{n((()=>this.listener.Zo()))})),this.stream.Yo((()=>{n((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((e=>{n((()=>this.z_(e)))})),this.stream.onMessage((e=>{n((()=>++this.F_==1?this.H_(e):this.onNext(e)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(Ph,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(M(Ph,`stream callback skipped by getCloseGuardedDispatcher.`),Promise.resolve())))}}},Ih=class extends Fh{constructor(e,t,n,r,i,a){super(e,`listen_stream_connection_backoff`,`listen_stream_idle`,`health_check_timeout`,t,n,r,a),this.serializer=i}j_(e,t){return this.connection.T_(`Listen`,e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=am(this.serializer,e),n=function(e){if(!(`targetChange`in e))return U.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?U.min():t.readTime?Jp(t.readTime):U.min()}(e);return this.listener.J_(t,n)}Z_(e){let t={};t.database=nm(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if(n=cf(r)?{documents:cm(e,r)}:{query:lm(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Kp(e,t.resumeToken);let r=Wp(e,t.expectedCount);r!==null&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(U.min())>0){n.readTime=Gp(e,t.snapshotVersion.toTimestamp());let r=Wp(e,t.expectedCount);r!==null&&(n.expectedCount=r)}return n}(this.serializer,e);let n=dm(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){let t={};t.database=nm(this.serializer),t.removeTarget=e,this.K_(t)}},Lh=class extends Fh{constructor(e,t,n,r,i,a){super(e,`write_stream_connection_backoff`,`write_stream_idle`,`health_check_timeout`,t,n,r,a),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_(`Write`,e,t)}H_(e){return P(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,P(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){P(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=sm(e.writeResults,e.commitTime),n=Jp(e.commitTime);return this.listener.na(n,t)}ra(){let e={};e.database=nm(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map((e=>om(this.serializer,e)))};this.K_(t)}},Rh=class{},zh=class extends Rh{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new L(I.FAILED_PRECONDITION,`The client has already been terminated.`)}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Wo(e,Xp(t,n),r,i,a))).catch((e=>{throw e.name===`FirebaseError`?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(I.UNKNOWN,e.toString())}))}jo(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,o])=>this.connection.jo(e,Xp(t,n),r,a,o,i))).catch((e=>{throw e.name===`FirebaseError`?(e.code===I.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(I.UNKNOWN,e.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}};function Bh(e,t,n,r){return new zh(e,t,n,r)}var Vh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state=`Unknown`,this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca(`Unknown`),this._a=this.asyncQueue.enqueueAfterDelay(`online_state_timeout`,1e4,(()=>(this._a=null,this.la(`Backend didn't respond within 10 seconds.`),this.ca(`Offline`),Promise.resolve()))))}ha(e){this.state===`Online`?this.ca(`Unknown`):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca(`Offline`)))}set(e){this.Pa(),this.oa=0,e===`Online`&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ul(t),this.aa=!1):M(`OnlineStateTracker`,t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}},Hh=`RemoteStore`,Uh=class{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo((e=>{n.enqueueAndForget((async()=>{Qh(this)&&(M(Hh,`Restarting streams for network reachability change.`),await async function(e){let t=F(e);t.Ea.add(4),await Gh(t),t.Va.set(`Unknown`),t.Ea.delete(4),await Wh(t)}(this))}))})),this.Va=new Vh(n,r)}};async function Wh(e){if(Qh(e))for(let t of e.Ra)await t(!0)}async function Gh(e){for(let t of e.Ra)await t(!1)}function Kh(e,t){let n=F(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Zh(n)?Xh(n):_g(n).O_()&&Jh(n,t))}function qh(e,t){let n=F(e),r=_g(n);n.Ia.delete(t),r.O_()&&Yh(n,t),n.Ia.size===0&&(r.O_()?r.L_():Qh(n)&&n.Va.set(`Unknown`))}function Jh(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}_g(e).Z_(t)}function Yh(e,t){e.da.$e(t),_g(e).X_(t)}function Xh(e){e.da=new Lp({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),_g(e).start(),e.Va.ua()}function Zh(e){return Qh(e)&&!_g(e).x_()&&e.Ia.size>0}function Qh(e){return F(e).Ea.size===0}function $h(e){e.da=void 0}async function eg(e){e.Va.set(`Online`)}async function tg(e){e.Ia.forEach(((t,n)=>{Jh(e,t)}))}async function ng(e,t){$h(e),Zh(e)?(e.Va.ha(t),Xh(e)):e.Va.set(`Unknown`)}async function rg(e,t,n){if(e.Va.set(`Online`),t instanceof Fp&&t.state===2&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.da.removeTarget(r))}(e,t)}catch(n){M(Hh,`Failed to remove targets %s: %s `,t.targetIds.join(`,`),n),await ig(e,n)}else if(t instanceof Np?e.da.Xe(t):t instanceof Pp?e.da.st(t):e.da.tt(t),!n.isEqual(U.min()))try{let t=await lh(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.da.Tt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{let r=e.Ia.get(t);r&&(e.Ia.set(t,r.withResumeToken(Xu.EMPTY_BYTE_STRING,r.snapshotVersion)),Yh(e,t),Jh(e,new Sm(r.target,t,n,r.sequenceNumber)))})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){M(Hh,`Failed to raise snapshot:`,t),await ig(e,t)}}async function ig(e,t,n){if(!Mu(t))throw t;e.Ea.add(1),await Gh(e),e.Va.set(`Offline`),n||=()=>lh(e.localStore),e.asyncQueue.enqueueRetryable((async()=>{M(Hh,`Retrying IndexedDB access`),await n(),e.Ea.delete(1),await Wh(e)}))}function ag(e,t){return t().catch((n=>ig(e,n,t)))}async function og(e){let t=F(e),n=vg(t),r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Pu;for(;sg(t);)try{let e=await fh(t.localStore,r);if(e===null){t.Ta.length===0&&n.L_();break}r=e.batchId,cg(t,e)}catch(e){await ig(t,e)}lg(t)&&ug(t)}function sg(e){return Qh(e)&&e.Ta.length<10}function cg(e,t){e.Ta.push(t);let n=vg(e);n.O_()&&n.Y_&&n.ea(t.mutations)}function lg(e){return Qh(e)&&!vg(e).x_()&&e.Ta.length>0}function ug(e){vg(e).start()}async function dg(e){vg(e).ra()}async function fg(e){let t=vg(e);for(let n of e.Ta)t.ea(n.mutations)}async function pg(e,t,n){let r=e.Ta.shift(),i=yp.from(r,t,n);await ag(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await og(e)}async function mg(e,t){t&&vg(e).Y_&&await async function(e,t){if(function(e){return Sp(e)&&e!==I.ABORTED}(t.code)){let n=e.Ta.shift();vg(e).B_(),await ag(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await og(e)}}(e,t),lg(e)&&ug(e)}async function hg(e,t){let n=F(e);n.asyncQueue.verifyOperationInProgress(),M(Hh,`RemoteStore received new credentials`);let r=Qh(n);n.Ea.add(3),await Gh(n),r&&n.Va.set(`Unknown`),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await Wh(n)}async function gg(e,t){let n=F(e);t?(n.Ea.delete(2),await Wh(n)):t||(n.Ea.add(2),await Gh(n),n.Va.set(`Unknown`))}function _g(e){return e.ma||(e.ma=function(e,t,n){let r=F(e);return r.sa(),new Ih(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:eg.bind(null,e),Yo:tg.bind(null,e),t_:ng.bind(null,e),J_:rg.bind(null,e)}),e.Ra.push((async t=>{t?(e.ma.B_(),Zh(e)?Xh(e):e.Va.set(`Unknown`)):(await e.ma.stop(),$h(e))}))),e.ma}function vg(e){return e.fa||(e.fa=function(e,t,n){let r=F(e);return r.sa(),new Lh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),Yo:dg.bind(null,e),t_:mg.bind(null,e),ta:fg.bind(null,e),na:pg.bind(null,e)}),e.Ra.push((async t=>{t?(e.fa.B_(),await og(e)):(await e.fa.stop(),e.Ta.length>0&&(M(Hh,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}var yg=class e{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ql,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,i,a){let o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(I.CANCELLED,`Operation cancelled`+(e?`: `+e:``))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle===null?Promise.resolve():(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e))))))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function bg(e,t){if(Ul(`AsyncQueue`,`${t}: ${e}`),Mu(e))return new L(I.UNAVAILABLE,`${t}: ${e}`);throw e}var xg=class e{static emptySet(t){return new e(t.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||B.comparator(t.key,n.key):(e,t)=>B.comparator(e.key,t.key),this.keyedMap=Af(),this.sortedSet=new G(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;n.hasNext();){let e=n.getNext().key,t=r.getNext().key;if(!e.isEqual(t))return!1}return!0}toString(){let e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?`DocumentSet ()`:`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(t,n){let r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}},Sg=class{constructor(){this.ga=new G(B.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):N(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}},Cg=class e{constructor(e,t,n,r,i,a,o,s,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=c}static fromInitialDocuments(t,n,r,i,a){let o=[];return n.forEach((e=>{o.push({type:0,doc:e})})),new e(t,n,xg.emptySet(n),o,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}},wg=class{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}},Tg=class{constructor(){this.queries=Eg(),this.onlineState=`Unknown`,this.Ca=new Set}terminate(){(function(e,t){let n=F(e),r=n.queries;n.queries=Eg(),r.forEach(((e,n)=>{for(let e of n.ba)e.onError(t)}))})(this,new L(I.ABORTED,`Firestore shutting down`))}};function Eg(){return new Ef((e=>bf(e)),yf)}async function Dg(e,t){let n=F(e),r=3,i=t.query,a=n.queries.get(i);a?!a.Sa()&&t.Da()&&(r=2):(a=new wg,r=t.Da()?0:1);try{switch(r){case 0:a.wa=await n.onListen(i,!0);break;case 1:a.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){let n=bg(e,`Initialization of query '${xf(t.query)}' failed`);t.onError(n);return}n.queries.set(i,a),a.ba.push(t),t.va(n.onlineState),a.wa&&t.Fa(a.wa)&&jg(n)}async function Og(e,t){let n=F(e),r=t.query,i=3,a=n.queries.get(r);if(a){let e=a.ba.indexOf(t);e>=0&&(a.ba.splice(e,1),a.ba.length===0?i=t.Da()?0:1:!a.Sa()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function kg(e,t){let n=F(e),r=!1;for(let e of t){let t=e.query,i=n.queries.get(t);if(i){for(let t of i.ba)t.Fa(e)&&(r=!0);i.wa=e}}r&&jg(n)}function Ag(e,t,n){let r=F(e),i=r.queries.get(t);if(i)for(let e of i.ba)e.onError(n);r.queries.delete(t)}function jg(e){e.Ca.forEach((e=>{e.next()}))}var Mg,Ng;(Ng=Mg||={}).Ma=`default`,Ng.Cache=`cache`;var Pg=class{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState=`Unknown`,this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)n.type!==3&&t.push(n);e=new Cg(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let n=t!==`Offline`;return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t===`Offline`)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Cg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Mg.Cache}},Fg=class{constructor(e){this.key=e}},Ig=class{constructor(e){this.key=e}},Lg=class{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Y(),this.mutatedKeys=Y(),this.eu=wf(e),this.tu=new xg(this.eu)}get nu(){return this.Za}ru(e,t){let n=t?t.iu:new Sg,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1,s=this.query.limitType===`F`&&r.size===this.query.limit?r.last():null,c=this.query.limitType===`L`&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{let l=r.get(e),u=Sf(this.query,t)?t:null,d=!!l&&this.mutatedKeys.has(l.key),f=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),p=!1;l&&u?l.data.isEqual(u.data)?d!==f&&(n.track({type:3,doc:u}),p=!0):this.su(l,u)||(n.track({type:2,doc:u}),p=!0,(s&&this.eu(u,s)>0||c&&this.eu(u,c)<0)&&(o=!0)):!l&&u?(n.track({type:0,doc:u}),p=!0):l&&!u&&(n.track({type:1,doc:l}),p=!0,(s||c)&&(o=!0)),p&&(u?(a=a.add(u),i=f?i.add(e):i.delete(e)):(a=a.delete(e),i=i.delete(e)))})),this.query.limit!==null)for(;a.size>this.query.limit;){let e=this.query.limitType===`F`?a.last():a.first();a=a.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:a,iu:n,Ss:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort(((e,t)=>function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc))),this.ou(n),r??=!1;let o=t&&!r?this._u():[],s=this.Ya.size===0&&this.current&&!r?1:0,c=s!==this.Xa;return this.Xa=s,a.length!==0||c?{snapshot:new Cg(this.query,e.tu,i,a,e.mutatedKeys,s===0,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e===`Offline`?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Sg,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((e=>this.Za=this.Za.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Za=this.Za.delete(e))),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=Y(),this.tu.forEach((e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))}));let t=[];return e.forEach((e=>{this.Ya.has(e)||t.push(new Ig(e))})),this.Ya.forEach((n=>{e.has(n)||t.push(new Fg(n))})),t}cu(e){this.Za=e.ks,this.Ya=Y();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Cg.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}},Rg=`SyncEngine`,zg=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Bg=class{constructor(e){this.key=e,this.hu=!1}},Vg=class{constructor(e,t,n,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ef((e=>bf(e)),yf),this.Iu=new Map,this.Eu=new Set,this.Ru=new G(B.comparator),this.Au=new Map,this.Vu=new Gm,this.du={},this.mu=new Map,this.fu=jm.ar(),this.onlineState=`Unknown`,this.gu=void 0}get isPrimaryClient(){return!0===this.gu}};async function Hg(e,t,n=!0){let r=u_(e),i,a=r.Tu.get(t);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await Wg(r,t,n,!0),i}async function Ug(e,t){await Wg(u_(e),t,!0,!1)}async function Wg(e,t,n,r){let i=await ph(e.localStore,gf(t)),a=i.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n),s;return r&&(s=await Gg(e,t,a,o===`current`,i.resumeToken)),e.isPrimaryClient&&n&&Kh(e.remoteStore,i),s}async function Gg(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Ss&&(i=await hh(e.localStore,t.query,!1).then((({documents:e})=>t.view.ru(e,i))));let a=r&&r.targetChanges.get(t.targetId),o=r&&r.targetMismatches.get(t.targetId)!=null,s=t.view.applyChanges(i,e.isPrimaryClient,a,o);return i_(e,t.targetId,s.au),s.snapshot}(e,t,n,r);let a=await hh(e.localStore,t,!0),o=new Lg(t,a.ks),s=o.ru(a.documents),c=Mp.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!==`Offline`,i),l=o.applyChanges(s,e.isPrimaryClient,c);i_(e,n,l.au);let u=new zg(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),l.snapshot}async function Kg(e,t,n){let r=F(e),i=r.Tu.get(t),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter((e=>!yf(e,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await mh(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&qh(r.remoteStore,i.targetId),n_(r,i.targetId)})).catch(Au)):(n_(r,i.targetId),await mh(r.localStore,i.targetId,!0))}async function qg(e,t){let n=F(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),qh(n.remoteStore,r.targetId))}async function Jg(e,t,n){let r=d_(e);try{let e=await function(e,t){let n=F(e),r=H.now(),i=t.reduce(((e,t)=>e.add(t.key)),Y()),a,o;return n.persistence.runTransaction(`Locally write mutations`,`readwrite`,(e=>{let s=Of(),c=Y();return n.xs.getEntries(e,i).next((e=>{s=e,s.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,s))).next((i=>{a=i;let o=[];for(let e of t){let t=lp(e,a.get(e.key).overlayedDocument);t!=null&&o.push(new fp(e.key,t,Pd(t.value.mapValue),rp.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;let r=t.applyToLocalDocumentSet(a,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:jf(a)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.du[e.currentUser.toKey()];r||=new G(R),r=r.insert(t,n),e.du[e.currentUser.toKey()]=r}(r,e.batchId,n),await s_(r,e.changes),await og(r.remoteStore)}catch(e){let t=bg(e,`Failed to persist write`);n.reject(t)}}async function Yg(e,t){let n=F(e);try{let e=await uh(n.localStore,t);t.targetChanges.forEach(((e,t)=>{let r=n.Au.get(t);r&&(P(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?P(r.hu,14607):e.removedDocuments.size>0&&(P(r.hu,42227),r.hu=!1))})),await s_(n,e,t)}catch(e){await Au(e)}}function Xg(e,t,n){let r=F(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let e=[];r.Tu.forEach(((n,r)=>{let i=r.view.va(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){let n=F(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)})),r&&jg(n)}(r.eventManager,t),e.length&&r.Pu.J_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Zg(e,t,n){let r=F(e);r.sharedClientState.updateQueryState(t,`rejected`,n);let i=r.Au.get(t),a=i&&i.key;if(a){let e=new G(B.comparator);e=e.insert(a,Fd.newNoDocument(a,U.min()));let n=Y().add(a);await Yg(r,new jp(U.min(),new Map,new G(R),e,n)),r.Ru=r.Ru.remove(a),r.Au.delete(t),o_(r)}else await mh(r.localStore,t,!1).then((()=>n_(r,t,n))).catch(Au)}async function Qg(e,t){let n=F(e),r=t.batch.batchId;try{let e=await ch(n.localStore,t);t_(n,r,null),e_(n,r),n.sharedClientState.updateMutationState(r,`acknowledged`),await s_(n,e)}catch(e){await Au(e)}}async function $g(e,t,n){let r=F(e);try{let e=await function(e,t){let n=F(e);return n.persistence.runTransaction(`Reject batch`,`readwrite-primary`,(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(P(t!==null,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);t_(r,t,n),e_(r,t),r.sharedClientState.updateMutationState(t,`rejected`,n),await s_(r,e)}catch(e){await Au(e)}}function e_(e,t){(e.mu.get(t)||[]).forEach((e=>{e.resolve()})),e.mu.delete(t)}function t_(e,t,n){let r=F(e),i=r.du[r.currentUser.toKey()];if(i){let e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.du[r.currentUser.toKey()]=i}}function n_(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(let r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach((t=>{e.Vu.containsKey(t)||r_(e,t)}))}function r_(e,t){e.Eu.delete(t.path.canonicalString());let n=e.Ru.get(t);n!==null&&(qh(e.remoteStore,n),e.Ru=e.Ru.remove(t),e.Au.delete(n),o_(e))}function i_(e,t,n){for(let r of n)r instanceof Fg?(e.Vu.addReference(r.key,t),a_(e,r)):r instanceof Ig?(M(Rg,`Document no longer in limbo: `+r.key),e.Vu.removeReference(r.key,t),e.Vu.containsKey(r.key)||r_(e,r.key)):N(19791,{wu:r})}function a_(e,t){let n=t.key,r=n.path.canonicalString();e.Ru.get(n)||e.Eu.has(r)||(M(Rg,`New document in limbo: `+n),e.Eu.add(r),o_(e))}function o_(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new B(z.fromString(t)),r=e.fu.next();e.Au.set(r,new Bg(n)),e.Ru=e.Ru.insert(n,r),Kh(e.remoteStore,new Sm(gf(df(n.path)),r,`TargetPurposeLimboResolution`,Nu.ce))}}async function s_(e,t,n){let r=F(e),i=[],a=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((e,s)=>{o.push(r.pu(s,t,n).then((e=>{if((e||n)&&r.isPrimaryClient){let t=e?!e.fromCache:n?.targetChanges.get(s.targetId)?.current;r.sharedClientState.updateQueryState(s.targetId,t?`current`:`not-current`)}if(e){i.push(e);let t=eh.Es(s.targetId,e);a.push(t)}})))})),await Promise.all(o),r.Pu.J_(i),await async function(e,t){let n=F(e);try{await n.persistence.runTransaction(`notifyLocalViewChanges`,`readwrite`,(e=>W.forEach(t,(t=>W.forEach(t.Ts,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>W.forEach(t.Is,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Mu(e))throw e;M(rh,`Failed to update sequence numbers: `+e)}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=n.vs.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.vs=n.vs.insert(t,i)}}}(r.localStore,a))}async function c_(e,t){let n=F(e);if(!n.currentUser.isEqual(t)){M(Rg,`User change. New user:`,t.toKey());let e=await sh(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach((e=>{e.forEach((e=>{e.reject(new L(I.CANCELLED,t))}))})),e.mu.clear()}(n,`'waitForPendingWrites' promise is rejected due to a user change.`),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await s_(n,e.Ns)}}function l_(e,t){let n=F(e),r=n.Au.get(t);if(r&&r.hu)return Y().add(r.key);{let e=Y(),r=n.Iu.get(t);if(!r)return e;for(let t of r){let r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function u_(e){let t=F(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=l_.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zg.bind(null,t),t.Pu.J_=kg.bind(null,t.eventManager),t.Pu.yu=Ag.bind(null,t.eventManager),t}function d_(e){let t=F(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Qg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=$g.bind(null,t),t}var f_=class{constructor(){this.kind=`memory`,this.synchronizeTabs=!1}async initialize(e){this.serializer=Mh(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return oh(this.persistence,new nh,e.initialUser,this.serializer)}Cu(e){return new Xm(Qm.Vi,this.serializer)}Du(e){return new vh}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}};f_.provider={build:()=>new f_};var p_=class extends f_{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){P(this.persistence.referenceDelegate instanceof $m,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new Im(n,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes===void 0?Am.DEFAULT:Am.withCacheSize(this.cacheSizeBytes);return new Xm((e=>$m.Vi(e,t)),this.serializer)}},m_=class{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Xg(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=c_.bind(null,this.syncEngine),await gg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Tg}()}createDatastore(e){let t=Mh(e.databaseInfo.databaseId),n=Ah(e.databaseInfo);return Bh(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Uh(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Xg(this.syncEngine,e,0)),function(){return xh.v()?new xh:new yh}())}createSyncEngine(e,t){return function(e,t,n,r,i,a,o){let s=new Vg(e,t,n,r,i,a);return o&&(s.gu=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){let t=F(e);M(Hh,`RemoteStore shutting down.`),t.Ea.add(5),await Gh(t),t.Aa.shutdown(),t.Va.set(`Unknown`)}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}};m_.provider={build:()=>new m_};var h_=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ul(`Uncaught Error in snapshot listener:`,e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}},g_=`FirestoreClient`,__=class{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=j.UNAUTHENTICATED,this.clientId=ru.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{M(g_,`Received user=`,e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(M(g_,`Received new app check token=`,e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ql;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=bg(t,`Failed to shutdown persistence`);e.reject(n)}})),e.promise}};async function v_(e,t){e.asyncQueue.verifyOperationInProgress(),M(g_,`Initializing OfflineComponentProvider`);let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await sh(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function y_(e,t){e.asyncQueue.verifyOperationInProgress();let n=await b_(e);M(g_,`Initializing OnlineComponentProvider`),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>hg(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>hg(t.remoteStore,n))),e._onlineComponents=t}async function b_(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){M(g_,`Using user provided OfflineComponentProvider`);try{await v_(e,e._uninitializedComponentsProvider._offline)}catch(t){let n=t;if(!function(e){return e.name===`FirebaseError`?e.code===I.FAILED_PRECONDITION||e.code===I.UNIMPLEMENTED:!(typeof DOMException<`u`&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}(n))throw n;Wl(`Error using user provided cache. Falling back to memory cache: `+n),await v_(e,new f_)}}else M(g_,`Using default OfflineComponentProvider`),await v_(e,new p_(void 0));return e._offlineComponents}async function x_(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(M(g_,`Using user provided OnlineComponentProvider`),await y_(e,e._uninitializedComponentsProvider._online)):(M(g_,`Using default OnlineComponentProvider`),await y_(e,new m_))),e._onlineComponents}function S_(e){return x_(e).then((e=>e.syncEngine))}async function C_(e){let t=await x_(e),n=t.eventManager;return n.onListen=Hg.bind(null,t.syncEngine),n.onUnlisten=Kg.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Ug.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=qg.bind(null,t.syncEngine),n}function w_(e,t,n={}){let r=new ql;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){let a=new h_({next:s=>{a.Nu(),t.enqueueAndForget((()=>Og(e,o)));let c=s.docs.has(n);!c&&s.fromCache?i.reject(new L(I.UNAVAILABLE,`Failed to get document because the client is offline.`)):c&&s.fromCache&&r&&r.source===`server`?i.reject(new L(I.UNAVAILABLE,`Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)`)):i.resolve(s)},error:e=>i.reject(e)}),o=new Pg(df(n.path),a,{includeMetadataChanges:!0,Ka:!0});return Dg(e,o)}(await C_(e),e.asyncQueue,t,n,r))),r.promise}function T_(e,t){let n=new ql;return e.asyncQueue.enqueueAndForget((async()=>Jg(await S_(e),t,n))),n.promise}function E_(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var D_=`ComponentProvider`,O_=new Map;function k_(e,t,n,r,i){return new sd(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,E_(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}var A_=`firestore.googleapis.com`,j_=!0,M_=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(I.INVALID_ARGUMENT,`Can't provide ssl option if host option is not set`);this.host=A_,this.ssl=j_}else this.host=e.host,this.ssl=e.ssl??j_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=km;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Nm)throw new L(I.INVALID_ARGUMENT,`cacheSizeBytes must be at least 1048576`);this.cacheSizeBytes=e.cacheSizeBytes}mu(`experimentalForceLongPolling`,e.experimentalForceLongPolling,`experimentalAutoDetectLongPolling`,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=E_(e.experimentalLongPollingOptions??{}),function(e){if(e.timeoutSeconds!==void 0){if(isNaN(e.timeoutSeconds))throw new L(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new L(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new L(I.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},N_=class{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type=`firestore-lite`,this._persistenceKey=`(lite)`,this._settings=new M_({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask=`notTerminated`}get app(){if(!this._app)throw new L(I.FAILED_PRECONDITION,`Firestore was not initialized using the Firebase SDK. 'app' is not available`);return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==`notTerminated`}_setSettings(e){if(this._settingsFrozen)throw new L(I.FAILED_PRECONDITION,`Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.`);this._settings=new M_(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(e){if(!e)return new Yl;switch(e.type){case`firstParty`:return new $l(e.sessionIndex||`0`,e.iamToken||null,e.authTokenFactory||null);case`provider`:return e.client;default:throw new L(I.INVALID_ARGUMENT,`makeAuthCredentialsProvider failed due to invalid credential type`)}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask===`notTerminated`&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask===`notTerminated`?await this._terminate():this._terminateTask=`notTerminated`}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=O_.get(e);t&&(M(D_,`Removing Datastore`),O_.delete(e),t.terminate())}(this),Promise.resolve()}};function P_(e,t,n,r={}){e=vu(e,N_);let i=ne(t),a=e._getSettings(),o={...a,emulatorOptions:e._getEmulatorOptions()},s=`${t}:${n}`;i&&(re(`https://${s}`),le(`Firestore`,!0)),a.host!==A_&&a.host!==s&&Wl(`Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.`);let c={...a,host:s,ssl:i,emulatorOptions:r};if(!Te(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,n;if(typeof r.mockUserToken==`string`)t=r.mockUserToken,n=j.MOCK_USER;else{t=ie(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new L(I.INVALID_ARGUMENT,`mockUserToken must contain 'sub' or 'user_id' field!`);n=new j(i)}e._authCredentials=new Xl(new Jl(t,n))}}var F_=class e{constructor(e,t,n){this.converter=t,this._query=n,this.type=`query`,this.firestore=e}withConverter(t){return new e(this.firestore,t,this._query)}},I_=class e{constructor(e,t,n){this.converter=t,this._key=n,this.type=`document`,this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new L_(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new e(this.firestore,t,this._key)}toJSON(){return{type:e._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,n,r){if(yu(n,e._jsonSchema))return new e(t,r||null,new B(z.fromString(n.referencePath)))}};I_._jsonSchemaVersion=`firestore/documentReference/1.0`,I_._jsonSchema={type:V(`string`,I_._jsonSchemaVersion),referencePath:V(`string`)};var L_=class e extends F_{constructor(e,t,n){super(e,t,df(n)),this._path=n,this.type=`collection`}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new I_(this.firestore,null,new B(e))}withConverter(t){return new e(this.firestore,t,this._path)}};function R_(e,t,...n){if(e=y(e),arguments.length===1&&(t=ru.newId()),pu(`doc`,`path`,t),e instanceof N_){let r=z.fromString(t,...n);return hu(r),new I_(e,null,new B(r))}{if(!(e instanceof I_||e instanceof L_))throw new L(I.INVALID_ARGUMENT,`Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore`);let r=e._path.child(z.fromString(t,...n));return hu(r),new I_(e.firestore,e instanceof L_?e.converter:null,new B(r))}}var z_=`AsyncQueue`,B_=class{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Nh(this,`async_queue_retry`),this._c=()=>{let e=jh();e&&M(z_,`Visibility state changed to `+e.visibilityState),this.M_.w_()},this.ac=e;let t=jh();t&&typeof t.addEventListener==`function`&&t.addEventListener(`visibilitychange`,this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=jh();t&&typeof t.removeEventListener==`function`&&t.removeEventListener(`visibilitychange`,this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));let t=new ql;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Mu(e))throw e;M(z_,`Operation failed with retryable error: `+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){let t=this.ac.then((()=>(this.rc=!0,e().catch((e=>{throw this.nc=e,this.rc=!1,Ul(`INTERNAL UNHANDLED ERROR: `,V_(e)),e})).then((e=>(this.rc=!1,e))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=yg.createAndSchedule(this,e,t,n,(e=>this.hc(e)));return this.tc.push(r),r}uc(){this.nc&&N(47125,{Pc:V_(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(let t of this.tc)if(t.skipDelay(),e!==`all`&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function V_(e){let t=e.message||``;return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+`
`+e.stack),t}var H_=class extends N_{constructor(e,t,n,r){super(e,t,n,r),this.type=`firestore`,this._queue=new B_,this._persistenceKey=r?.name||`[DEFAULT]`}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new B_(e),this._firestoreClient=void 0,await e}}};function U_(e,t){let n=typeof e==`object`?e:cn(),r=typeof e==`string`?e:t||cd,i=nn(n,`firestore`).getImmediate({identifier:r});if(!i._initialized){let e=ee(`firestore`);e&&P_(i,...e)}return i}function W_(e){if(e._terminated)throw new L(I.FAILED_PRECONDITION,`The client has already been terminated.`);return e._firestoreClient||G_(e),e._firestoreClient}function G_(e){let t=e._freezeSettings(),n=k_(e._databaseId,e._app?.options.appId||``,e._persistenceKey,e._app?.options.apiKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new __(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}var K_=class e{constructor(e){this._byteString=e}static fromBase64String(t){try{return new e(Xu.fromBase64String(t))}catch(e){throw new L(I.INVALID_ARGUMENT,`Failed to construct data from Base64 string: `+e)}}static fromUint8Array(t){return new e(Xu.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return`Bytes(base64: `+this.toBase64()+`)`}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:e._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(yu(t,e._jsonSchema))return e.fromBase64String(t.bytes)}};K_._jsonSchemaVersion=`firestore/bytes/1.0`,K_._jsonSchema={type:V(`string`,K_._jsonSchemaVersion),bytes:V(`string`)};var q_=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(I.INVALID_ARGUMENT,`Invalid field name at argument $(i + 1). Field names must not be empty.`);this._internalPath=new fu(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}},J_=class{constructor(e){this._methodName=e}},Y_=class e{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(I.INVALID_ARGUMENT,`Latitude must be a number between -90 and 90, but was: `+e);if(!isFinite(t)||t<-180||t>180)throw new L(I.INVALID_ARGUMENT,`Longitude must be a number between -180 and 180, but was: `+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return R(this._lat,e._lat)||R(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:e._jsonSchemaVersion}}static fromJSON(t){if(yu(t,e._jsonSchema))return new e(t.latitude,t.longitude)}};Y_._jsonSchemaVersion=`firestore/geoPoint/1.0`,Y_._jsonSchema={type:V(`string`,Y_._jsonSchemaVersion),latitude:V(`number`),longitude:V(`number`)};var X_=class e{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:e._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(yu(t,e._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e==`number`)))return new e(t.vectorValues);throw new L(I.INVALID_ARGUMENT,`Expected 'vectorValues' field to be a number array`)}}};X_._jsonSchemaVersion=`firestore/vectorValue/1.0`,X_._jsonSchema={type:V(`string`,X_._jsonSchemaVersion),vectorValues:V(`object`)};var Z_=/^__.*__$/,Q_=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask===null?new dp(e,this.data,t,this.fieldTransforms):new fp(e,this.data,this.fieldMask,t,this.fieldTransforms)}},$_=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new fp(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ev(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw N(40011,{dataSource:e})}}var tv=class e{constructor(e,t,n,r,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,i===void 0&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new e({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){let t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return gv(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError(`Document fields must not be empty`);if(ev(this.dataSource)&&Z_.test(e))throw this.createError(`Document fields cannot begin and end with "__"`)}},nv=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Mh(e)}createContext(e,t,n,r=!1){return new tv({dataSource:e,methodName:t,targetDoc:n,path:fu.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function rv(e){let t=e._freezeSettings(),n=Mh(e._databaseId);return new nv(e._databaseId,!!t.ignoreUndefinedProperties,n)}function iv(e,t,n,r,i,a={}){let o=e.createContext(a.merge||a.mergeFields?2:0,t,n,i);fv(`Data must be an object, but it was:`,o,r);let s=uv(r,o),c,l;if(a.merge)c=new Ju(o.fieldMask),l=o.fieldTransforms;else if(a.mergeFields){let e=[];for(let r of a.mergeFields){let i=pv(t,r,n);if(!o.contains(i))throw new L(I.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);_v(e,i)||e.push(i)}c=new Ju(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new Q_(new Nd(s),c,l)}var av=class e extends J_{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(t){return t instanceof e}},ov=class e extends J_{_toFieldTransform(e){return new ep(e.path,new Kf)}isEqual(t){return t instanceof e}};function sv(e,t,n,r){let i=e.createContext(1,t,n);fv(`Data must be an object, but it was:`,i,r);let a=[],o=Nd.empty();return Uu(r,((e,r)=>{let s=hv(t,e,n);r=y(r);let c=i.childContextForFieldPath(s);if(r instanceof av)a.push(s);else{let e=lv(r,c);e!=null&&(a.push(s),o.set(s,e))}})),new $_(o,new Ju(a),i.fieldTransforms)}function cv(e,t,n,r,i,a){let o=e.createContext(1,t,n),s=[pv(t,r,n)],c=[i];if(a.length%2!=0)throw new L(I.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<a.length;e+=2)s.push(pv(t,a[e])),c.push(a[e+1]);let l=[],u=Nd.empty();for(let e=s.length-1;e>=0;--e)if(!_v(l,s[e])){let t=s[e],n=c[e];n=y(n);let r=o.childContextForFieldPath(t);if(n instanceof av)l.push(t);else{let e=lv(n,r);e!=null&&(l.push(t),u.set(t,e))}}return new $_(u,new Ju(l),o.fieldTransforms)}function lv(e,t){if(dv(e=y(e)))return fv(`Unsupported field value:`,t,e),uv(e,t);if(e instanceof J_)return function(e,t){if(!ev(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError(`Nested arrays are not supported`);return function(e,t){let n=[],r=0;for(let i of e){let e=lv(i,t.childContextForArray(r));e??={nullValue:`NULL_VALUE`},n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if((e=y(e))===null)return{nullValue:`NULL_VALUE`};if(typeof e==`number`)return Vf(t.serializer,e);if(typeof e==`boolean`)return{booleanValue:e};if(typeof e==`string`)return{stringValue:e};if(e instanceof Date){let n=H.fromDate(e);return{timestampValue:Gp(t.serializer,n)}}if(e instanceof H){let n=new H(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Gp(t.serializer,n)}}if(e instanceof Y_)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof K_)return{bytesValue:Kp(t.serializer,e._byteString)};if(e instanceof I_){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Yp(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof X_)return function(e,t){let n=e instanceof X_?e.toArray():e;return{mapValue:{fields:{[dd]:{stringValue:md},[hd]:{arrayValue:{values:n.map((e=>{if(typeof e!=`number`)throw t.createError(`VectorValues must only contain numeric values.`);return zf(t.serializer,e)}))}}}}}}(e,t);if(xm(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${_u(e)}`)}(e,t)}function uv(e,t){let n={};return Wu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Uu(e,((e,r)=>{let i=lv(r,t.childContextForField(e));i!=null&&(n[e]=i)})),{mapValue:{fields:n}}}function dv(e){return!(typeof e!=`object`||!e||e instanceof Array||e instanceof Date||e instanceof H||e instanceof Y_||e instanceof K_||e instanceof I_||e instanceof J_||e instanceof X_||xm(e))}function fv(e,t,n){if(!dv(n)||!gu(n)){let r=_u(n);throw r===`an object`?t.createError(e+` a custom object`):t.createError(e+` `+r)}}function pv(e,t,n){if((t=y(t))instanceof q_)return t._internalPath;if(typeof t==`string`)return hv(e,t);throw gv(`Field path arguments must be of type string or `,e,!1,void 0,n)}var mv=RegExp(`[~\\*/\\[\\]]`);function hv(e,t,n){if(t.search(mv)>=0)throw gv(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new q_(...t.split(`.`))._internalPath}catch{throw gv(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function gv(e,t,n,r,i){let a=r&&!r.isEmpty(),o=i!==void 0,s=`Function ${t}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=`. `;let c=``;return(a||o)&&(c+=` (found`,a&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=`)`),new L(I.INVALID_ARGUMENT,s+e+c)}function _v(e,t){return e.some((e=>e.isEqual(t)))}var vv=class{convertValue(e,t=`none`){switch(gd(e)){case 0:return null;case 1:return e.booleanValue;case 2:return q(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($u(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw N(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t=`none`){let n={};return Uu(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){let t=e.fields?.[hd].arrayValue?.values?.map((e=>q(e.doubleValue)));return new X_(t)}convertGeoPoint(e){return new Y_(q(e.latitude),q(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case`previous`:let n=ad(e);return n==null?null:this.convertValue(n,t);case`estimate`:return this.convertTimestamp(od(e));default:return null}}convertTimestamp(e){let t=Qu(e);return new H(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=z.fromString(e);P(bm(n),9688,{name:e});let r=new ld(n.get(1),n.get(3)),i=new B(n.popFirst(5));return r.isEqual(t)||Ul(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}},yv=class extends vv{constructor(e){super(),this.firestore=e}convertBytes(e){return new K_(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new I_(this.firestore,null,t)}};function bv(){return new ov(`serverTimestamp`)}var xv=`@firebase/firestore`,Sv=`4.10.0`,Cv=class{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new I_(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new wv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(pv(`DocumentSnapshot.get`,e));if(t!==null)return this._userDataWriter.convertValue(t)}}},wv=class extends Cv{data(){return super.data()}};function Tv(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}var Ev=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Dv=class e extends Cv{constructor(e,t,n,r,i,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Ov(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(pv(`DocumentSnapshot.get`,e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(I.FAILED_PRECONDITION,`DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().`);let t=this._document,n={};return n.type=e._jsonSchemaVersion,n.bundle=``,n.bundleSource=`DocumentSnapshot`,n.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,`previous`),n.bundle=(this._firestore,this.ref.path,`NOT SUPPORTED`),n)}};Dv._jsonSchemaVersion=`firestore/documentSnapshot/1.0`,Dv._jsonSchema={type:V(`string`,Dv._jsonSchemaVersion),bundleSource:V(`string`,`DocumentSnapshot`),bundleName:V(`string`),bundle:V(`string`)};var Ov=class extends Dv{data(e={}){return super.data(e)}},kv=class e{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ev(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Ov(this._firestore,this._userDataWriter,n.key,n,new Ev(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(I.INVALID_ARGUMENT,`To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().`);return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{let r=new Ov(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Ev(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:`added`,doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||e.type!==3)).map((t=>{let r=new Ov(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Ev(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return t.type!==0&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),t.type!==1&&(n=n.add(t.doc),a=n.indexOf(t.doc.key)),{type:Av(t.type),doc:r,oldIndex:i,newIndex:a}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(I.FAILED_PRECONDITION,`QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().`);let t={};t.type=e._jsonSchemaVersion,t.bundleSource=`QuerySnapshot`,t.bundleName=ru.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let n=[],r=[],i=[];return this.docs.forEach((e=>{e._document!==null&&(n.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,`previous`)),i.push(e.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,`NOT SUPPORTED`),t}};function Av(e){switch(e){case 0:return`added`;case 2:case 3:return`modified`;case 1:return`removed`;default:return N(61501,{type:e})}}kv._jsonSchemaVersion=`firestore/querySnapshot/1.0`,kv._jsonSchema={type:V(`string`,kv._jsonSchemaVersion),bundleSource:V(`string`,`QuerySnapshot`),bundleName:V(`string`),bundle:V(`string`)};function jv(e){e=vu(e,I_);let t=vu(e.firestore,H_);return w_(W_(t),e._key).then((n=>Fv(t,e,n)))}function Mv(e,t,n){e=vu(e,I_);let r=vu(e.firestore,H_),i=Tv(e.converter,t,n);return Pv(r,[iv(rv(r),`setDoc`,e._key,i,e.converter!==null,n).toMutation(e._key,rp.none())])}function Nv(e,t,n,...r){e=vu(e,I_);let i=vu(e.firestore,H_),a=rv(i),o;return o=typeof(t=y(t))==`string`||t instanceof q_?cv(a,`updateDoc`,e._key,t,n,r):sv(a,`updateDoc`,e._key,t),Pv(i,[o.toMutation(e._key,rp.exists(!0))])}function Pv(e,t){return T_(W_(e),t)}function Fv(e,t,n){let r=n.docs.get(t._key);return new Dv(e,new yv(e),t._key,r,new Ev(n.hasPendingWrites,n.fromCache),t.converter)}(function(e,t=!0){Bl(on),tn(new Re(`firestore`,((e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider(`app`).getImmediate(),a=new H_(new Zl(e.getProvider(`auth-internal`)),new tu(i,e.getProvider(`app-check-internal`)),ud(i,n),i);return r={useFetchStreams:t,...r},a._setSettings(r),a}),`PUBLIC`).setMultipleInstances(!0)),ln(xv,Sv,e),ln(xv,Sv,`esm2020`)})();export{U_ as a,zi as c,eo as d,Qi as f,R_ as i,ls as l,Mv as n,bv as o,sn as p,Nv as r,vl as s,jv as t,Zi as u};